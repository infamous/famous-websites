!function t(e,i,s){function r(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(n)return n(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){var i=e[o][1][t];return r(i?i:t)},c,c.exports,t,e,i,s)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<s.length;o++)r(s[o]);return r}({1:[function(t,e,i){"use strict";function s(t){this._node=t,this._projectionType=s.ORTHOGRAPHIC_PROJECTION,this._focalDepth=0,this._near=0,this._far=0,this._requestingUpdate=!1,this._id=t.addComponent(this),this._viewTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._viewDirty=!1,this._perspectiveDirty=!1,this.setFlat()}s.FRUSTUM_PROJECTION=0,s.PINHOLE_PROJECTION=1,s.ORTHOGRAPHIC_PROJECTION=2,s.prototype.toString=function(){return"Camera"},s.prototype.getValue=function(){return{component:this.toString(),projectionType:this._projectionType,focalDepth:this._focalDepth,near:this._near,far:this._far}},s.prototype.setValue=function(t){return this.toString()===t.component?(this.set(t.projectionType,t.focalDepth,t.near,t.far),!0):!1},s.prototype.set=function(t,e,i,s){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._projectionType=t,this._focalDepth=e,this._near=i,this._far=s},s.prototype.setDepth=function(t){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=s.PINHOLE_PROJECTION,this._focalDepth=t,this._near=0,this._far=0,this},s.prototype.setFrustum=function(t,e){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=s.FRUSTUM_PROJECTION,this._focalDepth=0,this._near=t,this._far=e,this},s.prototype.setFlat=function(){return this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0),this._perspectiveDirty=!0,this._projectionType=s.ORTHOGRAPHIC_PROJECTION,this._focalDepth=0,this._near=0,this._far=0,this},s.prototype.onUpdate=function(){this._requestingUpdate=!1;var t=this._node.getLocation();if(this._node.sendDrawCommand("WITH").sendDrawCommand(t),this._perspectiveDirty)switch(this._perspectiveDirty=!1,this._projectionType){case s.FRUSTUM_PROJECTION:this._node.sendDrawCommand("FRUSTUM_PROJECTION"),this._node.sendDrawCommand(this._near),this._node.sendDrawCommand(this._far);break;case s.PINHOLE_PROJECTION:this._node.sendDrawCommand("PINHOLE_PROJECTION"),this._node.sendDrawCommand(this._focalDepth);break;case s.ORTHOGRAPHIC_PROJECTION:this._node.sendDrawCommand("ORTHOGRAPHIC_PROJECTION")}this._viewDirty&&(this._viewDirty=!1,this._node.sendDrawCommand("CHANGE_VIEW_TRANSFORM"),this._node.sendDrawCommand(this._viewTransform[0]),this._node.sendDrawCommand(this._viewTransform[1]),this._node.sendDrawCommand(this._viewTransform[2]),this._node.sendDrawCommand(this._viewTransform[3]),this._node.sendDrawCommand(this._viewTransform[4]),this._node.sendDrawCommand(this._viewTransform[5]),this._node.sendDrawCommand(this._viewTransform[6]),this._node.sendDrawCommand(this._viewTransform[7]),this._node.sendDrawCommand(this._viewTransform[8]),this._node.sendDrawCommand(this._viewTransform[9]),this._node.sendDrawCommand(this._viewTransform[10]),this._node.sendDrawCommand(this._viewTransform[11]),this._node.sendDrawCommand(this._viewTransform[12]),this._node.sendDrawCommand(this._viewTransform[13]),this._node.sendDrawCommand(this._viewTransform[14]),this._node.sendDrawCommand(this._viewTransform[15]))},s.prototype.onTransformChange=function(t){var e=t;this._viewDirty=!0,this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0);var i=e[0],s=e[1],r=e[2],n=e[3],o=e[4],a=e[5],h=e[6],u=e[7],c=e[8],p=e[9],l=e[10],d=e[11],f=e[12],m=e[13],y=e[14],v=e[15],g=i*a-s*o,_=i*h-r*o,b=i*u-n*o,x=s*h-r*a,w=s*u-n*a,I=r*u-n*h,C=c*m-p*f,T=c*y-l*f,M=c*v-d*f,E=p*y-l*m,A=p*v-d*m,z=l*v-d*y,R=1/(g*z-_*A+b*E+x*M-w*T+I*C);this._viewTransform[0]=(a*z-h*A+u*E)*R,this._viewTransform[1]=(r*A-s*z-n*E)*R,this._viewTransform[2]=(m*I-y*w+v*x)*R,this._viewTransform[3]=(l*w-p*I-d*x)*R,this._viewTransform[4]=(h*M-o*z-u*T)*R,this._viewTransform[5]=(i*z-r*M+n*T)*R,this._viewTransform[6]=(y*b-f*I-v*_)*R,this._viewTransform[7]=(c*I-l*b+d*_)*R,this._viewTransform[8]=(o*A-a*M+u*C)*R,this._viewTransform[9]=(s*M-i*A-n*C)*R,this._viewTransform[10]=(f*w-m*b+v*g)*R,this._viewTransform[11]=(p*b-c*w-d*g)*R,this._viewTransform[12]=(a*T-o*E-h*C)*R,this._viewTransform[13]=(i*E-s*T+r*C)*R,this._viewTransform[14]=(m*_-f*x-y*g)*R,this._viewTransform[15]=(c*x-p*_+l*g)*R},e.exports=s},{}],2:[function(t,e,i){"use strict";function s(t,e){this.node=t,this.id=t.addComponent(this),this._events=new h,this.last1=new u,this.last2=new u,this.delta1=new u,this.delta2=new u,this.velocity1=new u,this.velocity2=new u,this.dist=0,this.diff12=new u,this.center=new u,this.centerDelta=new u,this.centerVelocity=new u,this.pointer1={position:this.last1,delta:this.delta1,velocity:this.velocity1},this.pointer2={position:this.last2,delta:this.delta2,velocity:this.velocity2},this.event={status:null,time:0,pointers:[],center:this.center,centerDelta:this.centerDelta,centerVelocity:this.centerVelocity,points:0,current:0},this.trackedPointerIDs=[-1,-1],this.timeOfPointer=0,this.multiTap=0,this.mice=[],this.gestures=[],this.options={},this.trackedGestures={};var i,s;if(e)for(i=0,s=e.length;s>i;i++)this.on(e[i],e[i].callback);t.addUIEvent("touchstart"),t.addUIEvent("mousedown"),t.addUIEvent("touchmove"),t.addUIEvent("mousemove"),t.addUIEvent("touchend"),t.addUIEvent("mouseup"),t.addUIEvent("mouseleave")}function r(t){var e;if(t.targetTouches?e=t.targetTouches:(this.mice[0]=t,e=this.mice,t.identifier=1),!e[0]||!e[1]||this.trackedPointerIDs[0]!==e[0].identifier||this.trackedPointerIDs[1]!==e[1].identifier){this.event.time=Date.now();var i,s;this.trackedPointerIDs[0]!==e[0].identifier&&(this.trackedGestures.tap&&(i=this.options.tap&&this.options.tap.threshold||250,this.event.time-this.timeOfPointer<i?this.event.taps++:this.event.taps=1,this.timeOfPointer=this.event.time,this.multiTap=1),this.event.current=1,this.event.points=1,s=e[0].identifier,this.trackedPointerIDs[0]=s,this.last1.set(e[0].pageX,e[0].pageY),this.velocity1.clear(),this.delta1.clear(),this.event.pointers.push(this.pointer1)),e[1]&&this.trackedPointerIDs[1]!==e[1].identifier&&(this.trackedGestures.tap&&(i=this.options.tap&&this.options.tap.threshold||250,this.event.time-this.timeOfPointer<i&&(this.multiTap=2)),this.event.current=2,this.event.points=2,s=e[1].identifier,this.trackedPointerIDs[1]=s,this.last2.set(e[1].pageX,e[1].pageY),this.velocity2.clear(),this.delta2.clear(),u.add(this.last1,this.last2,this.center).scale(.5),this.centerDelta.clear(),this.centerVelocity.clear(),u.subtract(this.last2,this.last1,this.diff12),this.dist=this.diff12.length(),this.trackedGestures.pinch&&(this.event.scale=this.event.scale||1,this.event.scaleDelta=0,this.event.scaleVelocity=0),this.trackedGestures.rotate&&(this.event.rotation=this.event.rotation||0,this.event.rotationDelta=0,this.event.rotationVelocity=0),this.event.pointers.push(this.pointer2)),this.event.status="start",1===this.event.points&&(this.center.copy(this.last1),this.centerDelta.clear(),this.centerVelocity.clear(),this.trackedGestures.pinch&&(this.event.scale=1,this.event.scaleDelta=0,this.event.scaleVelocity=0),this.trackedGestures.rotate&&(this.event.rotation=0,this.event.rotationDelta=0,this.event.rotationVelocity=0)),this.triggerGestures()}}function n(t){var e;if(t.targetTouches)e=t.targetTouches;else{if(!this.event.current)return;this.mice[0]=t,e=this.mice,t.identifier=1}var i=Date.now(),s=i-this.event.time;if(0!==s){var r=1e3/s;if(this.event.time=i,this.event.current=1,this.event.points=1,this.trackedPointerIDs[0]===e[0].identifier&&(c.set(e[0].pageX,e[0].pageY),u.subtract(c,this.last1,this.delta1),u.scale(this.delta1,r,this.velocity1),this.last1.copy(c)),e[1]){if(this.event.current=2,this.event.points=2,c.set(e[1].pageX,e[1].pageY),u.subtract(c,this.last2,this.delta2),u.scale(this.delta2,r,this.velocity2),this.last2.copy(c),u.add(this.last1,this.last2,c).scale(.5),u.subtract(c,this.center,this.centerDelta),u.add(this.velocity1,this.velocity2,this.centerVelocity).scale(.5),this.center.copy(c),u.subtract(this.last2,this.last1,c),this.trackedGestures.rotate){var n=c.dot(this.diff12),o=c.cross(this.diff12),a=-Math.atan2(o,n);this.event.rotation+=a,this.event.rotationDelta=a,this.event.rotationVelocity=a*r}var h=c.length(),p=h/this.dist;this.diff12.copy(c),this.dist=h,this.trackedGestures.pinch&&(this.event.scale*=p,p-=1,this.event.scaleDelta=p,this.event.scaleVelocity=p*r)}this.event.status="move",1===this.event.points&&(this.center.copy(this.last1),this.centerDelta.copy(this.delta1),this.centerVelocity.copy(this.velocity1),this.trackedGestures.pinch&&(this.event.scale=1,this.event.scaleDelta=0,this.event.scaleVelocity=0),this.trackedGestures.rotate&&(this.event.rotation=0,this.event.rotationDelta=0,this.event.rotationVelocity=0)),this.triggerGestures()}}function o(t){var e;if(t.targetTouches)e=t.targetTouches;else{if(!this.event.current)return;this.mice.pop(),e=this.mice}if(!e[0]||!e[1]||this.trackedPointerIDs[0]!==e[0].identifier||this.trackedPointerIDs[1]!==e[1].identifier){var i;if(this.event.status="end",!e[0])return this.event.current=0,this.trackedPointerIDs[0]=-1,this.trackedPointerIDs[1]=-1,this.triggerGestures(),this.event.pointers.pop(),void this.event.pointers.pop();this.trackedPointerIDs[0]!==e[0].identifier&&(this.trackedPointerIDs[0]=-1,i=e[0].identifier,this.trackedPointerIDs[0]=i,this.last1.set(e[0].pageX,e[0].pageY),this.velocity1.clear(),this.delta1.clear()),e[1]?this.trackedPointerIDs[1]!==e[1].identifier&&(this.trackedPointerIDs[1]=-1,this.event.points=2,i=e[1].identifier,this.trackedPointerIDs[1]=i,this.last2.set(e[1].pageX,e[1].pageY),this.velocity2.clear(),this.delta2.clear(),u.add(this.last1,this.last2,this.center).scale(.5),this.centerDelta.clear(),this.centerVelocity.clear(),u.subtract(this.last2,this.last1,this.diff12),this.dist=this.diff12.length()):(this.event.current=1,this.trackedPointerIDs[1]=-1,this.triggerGestures(),this.event.points=1,this.event.pointers.pop())}}function a(){this.event.current&&(this.event.status="end",this.event.current=0,this.trackedPointerIDs[0]=-1,this.triggerGestures(),this.event.pointers.pop())}var h=t("../utilities/CallbackStore"),u=t("../math/Vec2"),c=new u,p={drag:!0,tap:!0,rotate:!0,pinch:!0};s.prototype.onReceive=function(t,e){switch(t){case"touchstart":case"mousedown":r.call(this,e);break;case"touchmove":case"mousemove":n.call(this,e);break;case"touchend":case"mouseup":o.call(this,e);break;case"mouseleave":a.call(this,e)}},s.prototype.toString=function(){return"GestureHandler"},s.prototype.on=function(t,e){var i=t.event||t;p[i]&&(this.trackedGestures[i]=!0,this.gestures.push(i),t.event&&(this.options[i]=t),this._events.on(i,e))},s.prototype.triggerGestures=function(){for(var t=this.event,e=0,i=this.gestures.length;i>e;e++){var s=this.gestures[e];switch(s){case"rotate":case"pinch":2===t.points&&this.trigger(s,t);break;case"tap":if("start"===t.status)if(this.options.tap){var r=this.options.tap.points||1;this.multiTap>=r&&t.points>=r&&this.trigger(s,t)}else this.trigger(s,t);break;default:this.trigger(s,t)}}},s.prototype.trigger=function(t,e){this._events.trigger(t,e)},e.exports=s},{"../math/Vec2":28,"../utilities/CallbackStore":68}],3:[function(t,e,i){"use strict";function s(){"undefined"!=typeof self&&self.window!==self&&this._enterWorkerMode()}s.prototype._enterWorkerMode=function(){this._workerMode=!0;var t=this;self.addEventListener("message",function(e){t.onMessage(e.data)})},s.prototype.onMessage=null,s.prototype.sendMessage=function(t){this._workerMode?self.postMessage(t):this.onmessage(t)},s.prototype.onmessage=null,s.prototype.postMessage=function(t){return this.onMessage(t)},e.exports=s},{}],4:[function(t,e,i){"use strict";function s(){this._time=0,this._frame=0,this._timerQueue=[],this._updatingIndex=0,this._scale=1,this._scaledTime=this._time}s.prototype.setScale=function(t){return this._scale=t,this},s.prototype.getScale=function(){return this._scale},s.prototype.step=function(t){this._frame++,this._scaledTime=this._scaledTime+(t-this._time)*this._scale,this._time=t;for(var e=0;e<this._timerQueue.length;e++)this._timerQueue[e](this._scaledTime)&&this._timerQueue.splice(e,1);return this},s.prototype.now=function(){return this._scaledTime},s.prototype.getTime=s.prototype.now,s.prototype.getFrame=function(){return this._frame},s.prototype.setTimeout=function(t,e){var i=Array.prototype.slice.call(arguments,2),s=this._time,r=function(r){return r-s>=e?(t.apply(null,i),!0):!1};return this._timerQueue.push(r),r},s.prototype.setInterval=function(t,e){var i=Array.prototype.slice.call(arguments,2),s=this._time,r=function(r){return r-s>=e&&(t.apply(null,i),s=r),!1};return this._timerQueue.push(r),r},s.prototype.clearTimer=function(t){var e=this._timerQueue.indexOf(t);return-1!==e&&this._timerQueue.splice(e,1),this},e.exports=s},{}],5:[function(t,e,i){"use strict";function s(t){if(!t)throw new Error("Dispatch needs to be instantiated on a node");this._context=t,this._queue=[]}function r(t,e){e.length=0;var i,s=0,r=t.length;for(i=0;r>i;i++)"/"===t[i]&&(e.push(t.substring(s,i)),s=i+1);return i-s>0&&e.push(t.substring(s,i)),e}var n=t("./Event");s.prototype.lookupNode=function(t){if(!t)throw new Error("lookupNode must be called with a path");var e=this._queue;if(r(t,e),e[0]!==this._context.getSelector())return void 0;var i,s=this._context.getChildren(),n=1;for(e[0]=this._context;n<e.length;){if(i=s[e[n]],e[n]=i,!i)return void 0;s=i.getChildren(),n++}return i},s.prototype.dispatch=function(t,e){if(!t)throw new Error("dispatch requires an event name as it's first argument");var i,s,r,n,o=this._queue;for(o.length=0,o.push(this._context);o.length;)for(i=o.shift(),i.onReceive&&i.onReceive(t,e),n=i.getChildren(),s=0,r=n.length;r>s;s++)o.push(n[s])},s.prototype.dispatchUIEvent=function(t,e,i){if(!t)throw new Error("dispatchUIEvent needs a valid path to dispatch to");if(!e)throw new Error("dispatchUIEvent needs an event name as its second argument");var s,r=this._queue;for(n.call(i),i.node=this.lookupNode(t);r.length&&(s=r.pop(),s.onReceive&&s.onReceive(e,i),!i.propagationStopped););},e.exports=s},{"./Event":6}],6:[function(t,e,i){"use strict";function s(){this.propagationStopped=!1,this.stopPropagation=r}function r(){this.propagationStopped=!0}e.exports=s},{}],7:[function(t,e,i){"use strict";function s(){var t=this;this._updateQueue=[],this._nextUpdateQueue=[],this._scenes={},this._messages=l,this._inUpdate=!1,this._clock=new r,this._channel=new o,this._channel.onMessage=function(e){t.handleMessage(e)}}var r=t("./Clock"),n=t("./Scene"),o=t("./Channel"),a=t("../renderers/UIManager"),h=t("../renderers/Compositor"),u=t("../render-loops/RequestAnimationFrameLoop"),c=["ENGINE","START"],p=["ENGINE","STOP"],l=["TIME",null];s.prototype.init=function(t){return this.compositor=t&&t.compositor||new h,this.renderLoop=t&&t.renderLoop||new u,this.uiManager=new a(this.getChannel(),this.compositor,this.renderLoop),this},s.prototype.setChannel=function(t){return this._channel=t,this},s.prototype.getChannel=function(){return this._channel},s.prototype._update=function(){this._inUpdate=!0;var t,e=this._clock.now(),i=this._nextUpdateQueue,s=this._updateQueue;for(this._messages[1]=e;i.length;)s.unshift(i.pop());for(;s.length;)t=s.shift(),t&&t.onUpdate&&t.onUpdate(e);this._inUpdate=!1},s.prototype.requestUpdate=function(t){if(!t)throw new Error("requestUpdate must be called with a class to be updated");this._inUpdate?this.requestUpdateOnNextTick(t):this._updateQueue.push(t)},s.prototype.requestUpdateOnNextTick=function(t){this._nextUpdateQueue.push(t)},s.prototype.handleMessage=function(t){if(!t)throw new Error("onMessage must be called with an array of messages");for(var e;t.length>0;)switch(e=t.shift()){case"WITH":this.handleWith(t);break;case"FRAME":this.handleFrame(t);break;default:throw new Error("received unknown command: "+e)}return this},s.prototype.handleWith=function(t){var e=t.shift(),i=t.shift();switch(i){case"TRIGGER":var s=t.shift(),r=t.shift();this.getContext(e).getDispatch().dispatchUIEvent(e,s,r);break;default:throw new Error("received unknown command: "+i)}return this},s.prototype.handleFrame=function(t){if(!t)throw new Error("handleFrame must be called with an array of messages");if(!t.length)throw new Error("FRAME must be sent with a time");return this.step(t.shift()),this},s.prototype.step=function(t){if(null==t)throw new Error("step must be called with a time");return this._clock.step(t),this._update(),this._messages.length&&(this._channel.sendMessage(this._messages),this._messages.length=2),this},s.prototype.getContext=function(t){if(!t)throw new Error("getContext must be called with a selector");var e=t.indexOf("/");return t=-1===e?t:t.substring(0,e),this._scenes[t]},s.prototype.getClock=function(){return this._clock},s.prototype.message=function(t){return this._messages.push(t),this},s.prototype.createScene=function(t){return t=t||"body",this._scenes[t]&&this._scenes[t].dismount(),this._scenes[t]=new n(t,this),this._scenes[t]},s.prototype.startEngine=function(){return this._channel.sendMessage(c),this},s.prototype.stopEngine=function(){return this._channel.sendMessage(p),this},e.exports=new s},{"../render-loops/RequestAnimationFrameLoop":63,"../renderers/Compositor":64,"../renderers/UIManager":66,"./Channel":3,"./Clock":4,"./Scene":9}],8:[function(t,e,i){"use strict";function s(){this._calculatedValues={transform:new Float32Array(h),size:new Float32Array(3)},this._requestingUpdate=!1,this._inUpdate=!1,this._updateQueue=[],this._nextUpdateQueue=[],this._freedComponentIndicies=[],this._components=[],this._freedChildIndicies=[],this._children=[],this._parent=null,this._globalUpdater=null,this._lastEulerX=0,this._lastEulerY=0,this._lastEulerZ=0,this._lastEuler=!1,this.value=new s.Spec}var r=t("./Transform"),n=t("./Size"),o=new r,a=new n,h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[1,1,1],c=[0,0,0,1];s.RELATIVE_SIZE=n.RELATIVE,s.ABSOLUTE_SIZE=n.ABSOLUTE,s.RENDER_SIZE=n.RENDER,s.DEFAULT_SIZE=n.DEFAULT,s.Spec=function(){this.location=null,this.showState={mounted:!1,shown:!1,opacity:1},this.offsets={mountPoint:new Float32Array(3),align:new Float32Array(3),origin:new Float32Array(3)},this.vectors={position:new Float32Array(3),rotation:new Float32Array(c),scale:new Float32Array(u)},this.size={sizeMode:new Float32Array([n.RELATIVE,n.RELATIVE,n.RELATIVE]),proportional:new Float32Array(u),differential:new Float32Array(3),absolute:new Float32Array(3),render:new Float32Array(3)},this.UIEvents=[]},s.prototype.getLocation=function(){return this.value.location},s.prototype.getId=s.prototype.getLocation,s.prototype.emit=function(t,e){for(var i=this;i!==i.getParent();)i=i.getParent();return i.getDispatch().dispatch(t,e),this},s.prototype.sendDrawCommand=function(t){return this._globalUpdater.message(t),this},s.prototype.getValue=function(){for(var t=this._children.length,e=this._components.length,i=0,s={location:this.value.location,spec:this.value,components:new Array(e),children:new Array(t)};t>i;i++)this._children[i]&&this._children[i].getValue&&(s.children[i]=this._children[i].getValue());for(i=0;e>i;i++)this._components[i]&&this._components[i].getValue&&(s.components[i]=this._components[i].getValue());return s},s.prototype.getComputedValue=function(){for(var t=this._children.length,e={location:this.value.location,computedValues:this._calculatedValues,children:new Array(t)},i=0;t>i;i++)e.children[i]=this._children[i].getComputedValue();return e},s.prototype.getChildren=function(){return this._children},s.prototype.getParent=function(){return this._parent},s.prototype.requestUpdate=function(t){return this._inUpdate||!this.isMounted()?this.requestUpdateOnNextTick(t):(this._updateQueue.push(t),this._requestingUpdate||this._requestUpdate(),this)},s.prototype.requestUpdateOnNextTick=function(t){return this._nextUpdateQueue.push(t),this},s.prototype.getUpdater=function(){return this._globalUpdater},s.prototype.isMounted=function(){return this.value.showState.mounted},s.prototype.isShown=function(){return this.value.showState.shown},s.prototype.getOpacity=function(){return this.value.showState.opacity},s.prototype.getMountPoint=function(){return this.value.offsets.mountPoint},s.prototype.getAlign=function(){return this.value.offsets.align},s.prototype.getOrigin=function(){return this.value.offsets.origin},s.prototype.getPosition=function(){return this.value.vectors.position},s.prototype.getRotation=function(){return this.value.vectors.rotation},s.prototype.getScale=function(){return this.value.vectors.scale},s.prototype.getSizeMode=function(){return this.value.size.sizeMode},s.prototype.getProportionalSize=function(){return this.value.size.proportional},s.prototype.getDifferentialSize=function(){return this.value.size.differential},s.prototype.getAbsoluteSize=function(){return this.value.size.absolute},s.prototype.getRenderSize=function(){return this.value.size.render},s.prototype.getSize=function(){return this._calculatedValues.size},s.prototype.getTransform=function(){return this._calculatedValues.transform},s.prototype.getUIEvents=function(){return this.value.UIEvents},s.prototype.addChild=function(t){var e=t?this._children.indexOf(t):-1;if(t=t?t:new s,-1===e&&(e=this._freedChildIndicies.length?this._freedChildIndicies.pop():this._children.length,this._children[e]=t,this.isMounted()&&t.onMount)){var i=this.getId(),r=i+"/"+e;t.onMount(this,r)}return t},s.prototype.removeChild=function(t){var e=this._children.indexOf(t),i=-1!==e;return i&&(this._freedChildIndicies.push(e),this._children[e]=null,this.isMounted()&&t.onDismount&&t.onDismount()),i},s.prototype.addComponent=function(t){var e=this._components.indexOf(t);return-1===e&&(e=this._freedComponentIndicies.length?this._freedComponentIndicies.pop():this._components.length,this._components[e]=t,this.isMounted()&&t.onMount&&t.onMount(this,e),this.isShown()&&t.onShow&&t.onShow()),e},s.prototype.getComponent=function(t){return this._components[t]},s.prototype.removeComponent=function(t){var e=this._components.indexOf(t);return-1!==e&&(this._freedComponentIndicies.push(e),this.isShown()&&t.onHide&&t.onHide(),this.isMounted()&&t.onDismount&&t.onDismount(),this._components[e]=null),t},s.prototype.addUIEvent=function(t){var e,i=this.getUIEvents(),s=this._components,r=-1!==i.indexOf(t);if(!r){i.push(t);for(var n=0,o=s.length;o>n;n++)e=s[n],e&&e.onAddUIEvent&&e.onAddUIEvent(t)}},s.prototype._requestUpdate=function(t){(t||!this._requestingUpdate&&this._globalUpdater)&&(this._globalUpdater.requestUpdate(this),this._requestingUpdate=!0)},s.prototype._vecOptionalSet=function(t,e,i){return null!=i&&t[e]!==i?(t[e]=i,this._requestingUpdate||this._requestUpdate(),!0):!1},s.prototype.show=function(){var t,e=0,i=this._components,s=i.length;for(this.value.showState.shown=!0;s>e;e++)t=i[e],t&&t.onShow&&t.onShow();for(e=0,i=this._children,s=i.length;s>e;e++)t=i[e],t&&t.onParentShow&&t.onParentShow();return this},s.prototype.hide=function(){var t,e=0,i=this._components,s=i.length;for(this.value.showState.shown=!1;s>e;e++)t=i[e],t&&t.onHide&&t.onHide();for(e=0,i=this._children,s=i.length;s>e;e++)t=i[e],t&&t.onParentHide&&t.onParentHide();return this},s.prototype.setAlign=function(t,e,i){var s=this.value.offsets.align,r=!1;if(r=this._vecOptionalSet(s,0,t)||r,r=this._vecOptionalSet(s,1,e)||r,null!=i&&(r=this._vecOptionalSet(s,2,i-.5)||r),r){var n,o=0,a=this._components,h=a.length;for(t=s[0],e=s[1],i=s[2];h>o;o++)n=a[o],n&&n.onAlignChange&&n.onAlignChange(t,e,i)}return this},s.prototype.setMountPoint=function(t,e,i){var s=this.value.offsets.mountPoint,r=!1;if(r=this._vecOptionalSet(s,0,t)||r,r=this._vecOptionalSet(s,1,e)||r,null!=i&&(r=this._vecOptionalSet(s,2,i-.5)||r),r){var n,o=0,a=this._components,h=a.length;for(t=s[0],e=s[1],i=s[2];h>o;o++)n=a[o],n&&n.onMountPointChange&&n.onMountPointChange(t,e,i)}return this},s.prototype.setOrigin=function(t,e,i){var s=this.value.offsets.origin,r=!1;if(r=this._vecOptionalSet(s,0,t)||r,r=this._vecOptionalSet(s,1,e)||r,null!=i&&(r=this._vecOptionalSet(s,2,i-.5)||r),r){var n,o=0,a=this._components,h=a.length;for(t=s[0],e=s[1],i=s[2];h>o;o++)n=a[o],n&&n.onOriginChange&&n.onOriginChange(t,e,i)}return this},s.prototype.setPosition=function(t,e,i){var s=this.value.vectors.position,r=!1;if(r=this._vecOptionalSet(s,0,t)||r,r=this._vecOptionalSet(s,1,e)||r,r=this._vecOptionalSet(s,2,i)||r){var n,o=0,a=this._components,h=a.length;for(t=s[0],e=s[1],i=s[2];h>o;o++)n=a[o],n&&n.onPositionChange&&n.onPositionChange(t,e,i)}return this},s.prototype.setRotation=function(t,e,i,s){var r,n,o,a,h=this.value.vectors.rotation,u=!1;if(null!=s)r=t,n=e,o=i,a=s,this._lastEulerX=null,this._lastEulerY=null,this._lastEulerZ=null,this._lastEuler=!1;else{if(null==t||null==e||null==i)if(this._lastEuler)t=null==t?this._lastEulerX:t,e=null==e?this._lastEulerY:e,i=null==i?this._lastEulerZ:i;else{var c=-2*(h[1]*h[2]-h[3]*h[0]);Math.abs(c)>.99999?(e=null==e?.5*Math.PI*c:e,t=null==t?Math.atan2(-h[0]*h[2]+h[3]*h[1],.5-h[1]*h[1]-h[2]*h[2]):t,i=null==i?0:i):(e=null==e?Math.asin(c):e,t=null==t?Math.atan2(h[0]*h[2]+h[3]*h[1],.5-h[0]*h[0]-h[1]*h[1]):t,i=null==i?Math.atan2(h[0]*h[1]+h[3]*h[2],.5-h[0]*h[0]-h[2]*h[2]):i)}var p=.5*t,l=.5*e,d=.5*i,f=Math.sin(p),m=Math.sin(l),y=Math.sin(d),v=Math.cos(p),g=Math.cos(l),_=Math.cos(d),b=m*y,x=g*y,w=m*_,I=g*_;r=f*I+v*b,n=v*w-f*x,o=v*x+f*w,a=v*I-f*b,this._lastEuler=!0,this._lastEulerX=t,this._lastEulerY=e,this._lastEulerZ=i}if(u=this._vecOptionalSet(h,0,r)||u,u=this._vecOptionalSet(h,1,n)||u,u=this._vecOptionalSet(h,2,o)||u,u=this._vecOptionalSet(h,3,a)||u){var C,T=0,M=this._components,E=M.length;for(t=h[0],e=h[1],i=h[2],s=h[3];E>T;T++)C=M[T],C&&C.onRotationChange&&C.onRotationChange(t,e,i,s)}return this},s.prototype.setScale=function(t,e,i){var s=this.value.vectors.scale,r=!1;if(r=this._vecOptionalSet(s,0,t)||r,r=this._vecOptionalSet(s,1,e)||r,r=this._vecOptionalSet(s,2,i)||r){var n,o=0,a=this._components,h=a.length;for(t=s[0],e=s[1],i=s[2];h>o;o++)n=a[o],n&&n.onScaleChange&&n.onScaleChange(t,e,i)}return this},s.prototype.setOpacity=function(t){if(t!==this.value.showState.opacity){this.value.showState.opacity=t,this._requestingUpdate||this._requestUpdate();for(var e,i=0,s=this._components,r=s.length;r>i;i++)e=s[i],e&&e.onOpacityChange&&e.onOpacityChange(t)}return this},s.prototype.setSizeMode=function(t,e,i){var s=this.value.size.sizeMode,r=!1;if(null!=t&&(r=this._resolveSizeMode(s,0,t)||r),null!=e&&(r=this._resolveSizeMode(s,1,e)||r),null!=i&&(r=this._resolveSizeMode(s,2,i)||r),r){var n,o=0,a=this._components,h=a.length;for(t=s[0],e=s[1],i=s[2];h>o;o++)n=a[o],n&&n.onSizeModeChange&&n.onSizeModeChange(t,e,i)}return this},s.prototype._resolveSizeMode=function(t,e,i){if(i.constructor!==String)return this._vecOptionalSet(t,e,i);switch(i.toLowerCase()){case"relative":case"default":return this._vecOptionalSet(t,e,0);case"absolute":return this._vecOptionalSet(t,e,1);case"render":return this._vecOptionalSet(t,e,2);default:throw new Error("unknown size mode: "+i)}},s.prototype.setProportionalSize=function(t,e,i){var s=this.value.size.proportional,r=!1;if(r=this._vecOptionalSet(s,0,t)||r,r=this._vecOptionalSet(s,1,e)||r,r=this._vecOptionalSet(s,2,i)||r){var n,o=0,a=this._components,h=a.length;for(t=s[0],e=s[1],i=s[2];h>o;o++)n=a[o],n&&n.onProportionalSizeChange&&n.onProportionalSizeChange(t,e,i)}return this},s.prototype.setDifferentialSize=function(t,e,i){var s=this.value.size.differential,r=!1;if(r=this._vecOptionalSet(s,0,t)||r,r=this._vecOptionalSet(s,1,e)||r,r=this._vecOptionalSet(s,2,i)||r){var n,o=0,a=this._components,h=a.length;for(t=s[0],e=s[1],i=s[2];h>o;o++)n=a[o],n&&n.onDifferentialSizeChange&&n.onDifferentialSizeChange(t,e,i)}return this},s.prototype.setAbsoluteSize=function(t,e,i){var s=this.value.size.absolute,r=!1;if(r=this._vecOptionalSet(s,0,t)||r,r=this._vecOptionalSet(s,1,e)||r,r=this._vecOptionalSet(s,2,i)||r){var n,o=0,a=this._components,h=a.length;for(t=s[0],e=s[1],i=s[2];h>o;o++)n=a[o],n&&n.onAbsoluteSizeChange&&n.onAbsoluteSizeChange(t,e,i)}return this},s.prototype._transformChanged=function(t){for(var e,i=0,s=this._components,r=s.length;r>i;i++)e=s[i],e&&e.onTransformChange&&e.onTransformChange(t);for(i=0,s=this._children,r=s.length;r>i;i++)e=s[i],e&&e.onParentTransformChange&&e.onParentTransformChange(t)},s.prototype._sizeChanged=function(t){for(var e,i=0,s=this._components,r=s.length;r>i;i++)e=s[i],e&&e.onSizeChange&&e.onSizeChange(t);for(i=0,s=this._children,r=s.length;r>i;i++)e=s[i],e&&e.onParentSizeChange&&e.onParentSizeChange(t)},s.prototype.getFrame=function(){return this._globalUpdater.getFrame()},s.prototype.getComponents=function(){return this._components},s.prototype.update=function(t){this._inUpdate=!0;for(var e,i=this._nextUpdateQueue,s=this._updateQueue;i.length;)s.unshift(i.pop());for(;s.length;)e=this._components[s.shift()],e&&e.onUpdate&&e.onUpdate(t);var r=this.getSize(),n=this.getTransform(),h=this.getParent(),u=h.getSize(),c=h.getTransform(),p=a.fromSpecWithParent(u,this,r),l=o.fromSpecWithParent(c,this.value,r,u,n);return l&&this._transformChanged(n),p&&this._sizeChanged(r),this._inUpdate=!1,this._requestingUpdate=!1,this.isMounted()?this._nextUpdateQueue.length&&(this._globalUpdater.requestUpdateOnNextTick(this),this._requestingUpdate=!0):(this._parent=null,this.value.location=null,this._globalUpdater=null),this},s.prototype.mount=function(t,e){if(this.isMounted())return this;var i,s=0,r=this._components,n=r.length;for(this._parent=t,this._globalUpdater=t.getUpdater(),this.value.location=e,this.value.showState.mounted=!0;n>s;s++)i=r[s],i&&i.onMount&&i.onMount(this,s);for(s=0,r=this._children,n=r.length;n>s;s++)i=r[s],i&&i.onParentMount&&i.onParentMount(this,e,s);return this._requestingUpdate||this._requestUpdate(!0),this},s.prototype.dismount=function(){if(!this.isMounted())return this;var t,e=0,i=this._components,s=i.length;for(this.value.showState.mounted=!1,this._parent.removeChild(this);s>e;e++)t=i[e],t&&t.onDismount&&t.onDismount();for(e=0,i=this._children,s=i.length;s>e;e++)t=i[e],t&&t.onParentDismount&&t.onParentDismount();return this._requestingUpdate||this._requestUpdate(),this},s.prototype.onParentMount=function(t,e,i){return this.mount(t,e+"/"+i)},s.prototype.onParentDismount=function(){return this.dismount()},s.prototype.receive=function(t,e){for(var i,s=0,r=this._components,n=r.length;n>s;s++)i=r[s],i&&i.onReceive&&i.onReceive(t,e);return this},s.prototype._requestUpdateWithoutArgs=function(){this._requestingUpdate||this._requestUpdate()},s.prototype.onUpdate=s.prototype.update,s.prototype.onParentShow=s.prototype.show,s.prototype.onParentHide=s.prototype.hide,s.prototype.onParentTransformChange=s.prototype._requestUpdateWithoutArgs,s.prototype.onParentSizeChange=s.prototype._requestUpdateWithoutArgs,s.prototype.onShow=s.prototype.show,s.prototype.onHide=s.prototype.hide,s.prototype.onMount=s.prototype.mount,s.prototype.onDismount=s.prototype.dismount,s.prototype.onReceive=s.prototype.receive,e.exports=s},{"./Size":10,"./Transform":11}],9:[function(t,e,i){"use strict";function s(t,e){if(!t)throw new Error("Scene needs to be created with a DOM selector");if(!e)throw new Error("Scene needs to be created with a class like Famous");n.call(this),this._updater=e,this._dispatch=new r(this),this._selector=t,this.onMount(this,t),this._updater.message("NEED_SIZE_FOR").message(t),this.show()}var r=t("./Dispatch"),n=t("./Node"),o=t("./Size");s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.getUpdater=function(){return this._updater},s.prototype.getSelector=function(){return this._selector},s.prototype.getDispatch=function(){return this._dispatch},s.prototype.onReceive=function(t,e){if("CONTEXT_RESIZE"===t){if(e.length<2)throw new Error("CONTEXT_RESIZE's payload needs to be at least a pair of pixel sizes");
this.setSizeMode(o.ABSOLUTE,o.ABSOLUTE,o.ABSOLUTE),this.setAbsoluteSize(e[0],e[1],e[2]?e[2]:0)}},e.exports=s},{"./Dispatch":5,"./Node":8,"./Size":10}],10:[function(t,e,i){"use strict";function s(){this._size=new Float32Array(3)}s.RELATIVE=0,s.ABSOLUTE=1,s.RENDER=2,s.DEFAULT=s.RELATIVE,s.prototype.fromSpecWithParent=function(t,e,i){for(var r,n,o=e.getValue().spec,a=e.getComponents(),h=o.size.sizeMode,u=!1,c=a.length,p=0;3>p;p++){switch(h[p]){case s.RELATIVE:r=i[p],i[p]=t[p]*o.size.proportional[p]+o.size.differential[p];break;case s.ABSOLUTE:r=i[p],i[p]=o.size.absolute[p];break;case s.RENDER:var l,d;for(n=0;c>n;n++)d=a[n],d&&d.getRenderSize&&(l=d.getRenderSize()[p],r=i[p],i[p]=i[p]<l||0===i[p]?l:i[p])}u=u||r!==i[p]}return u},e.exports=s},{}],11:[function(t,e,i){"use strict";function s(){this._matrix=new Float32Array(16)}s.prototype.get=function(){return this._matrix},s.prototype.fromSpecWithParent=function(t,e,i,s,r){r=r?r:this._matrix;var n=r[0],o=r[1],a=r[2],h=r[4],u=r[5],c=r[6],p=r[8],l=r[9],d=r[10],f=r[12],m=r[13],y=r[14],v=t[0],g=t[1],_=t[2],b=t[4],x=t[5],w=t[6],I=t[8],C=t[9],T=t[10],M=t[12],E=t[13],A=t[14],z=e.vectors.position[0],R=e.vectors.position[1],S=e.vectors.position[2],D=e.vectors.rotation[0],O=e.vectors.rotation[1],P=e.vectors.rotation[2],L=e.vectors.rotation[3],V=e.vectors.scale[0],U=e.vectors.scale[1],F=e.vectors.scale[2],k=e.offsets.align[0]*s[0],G=e.offsets.align[1]*s[1],B=e.offsets.align[2]*s[2],N=e.offsets.mountPoint[0]*i[0],q=e.offsets.mountPoint[1]*i[1],W=e.offsets.mountPoint[2]*i[2],H=e.offsets.origin[0]*i[0],j=e.offsets.origin[1]*i[1],K=e.offsets.origin[2]*i[2],Q=L*D,Y=L*O,X=L*P,Z=D*D,J=O*O,$=P*P,tt=D*O,et=D*P,it=O*P,st=(1-2*(J+$))*V,rt=2*(tt+X)*V,nt=2*(et-Y)*V,ot=2*(tt-X)*U,at=(1-2*(Z+$))*U,ht=2*(it+Q)*U,ut=2*(et+Y)*F,ct=2*(it-Q)*F,pt=(1-2*(Z+J))*F,lt=k+z-N+H-(st*H+ot*j+ut*K),dt=G+R-q+j-(rt*H+at*j+ct*K),ft=B+S-W+K-(nt*H+ht*j+pt*K);return r[0]=v*st+b*rt+I*nt,r[1]=g*st+x*rt+C*nt,r[2]=_*st+w*rt+T*nt,r[3]=0,r[4]=v*ot+b*at+I*ht,r[5]=g*ot+x*at+C*ht,r[6]=_*ot+w*at+T*ht,r[7]=0,r[8]=v*ut+b*ct+I*pt,r[9]=g*ut+x*ct+C*pt,r[10]=_*ut+w*ct+T*pt,r[11]=0,r[12]=v*lt+b*dt+I*ft+M,r[13]=g*lt+x*dt+C*ft+E,r[14]=_*lt+w*dt+T*ft+A,r[15]=1,n!==r[0]||o!==r[1]||a!==r[2]||h!==r[4]||u!==r[5]||c!==r[6]||p!==r[8]||l!==r[9]||d!==r[10]||f!==r[12]||m!==r[13]||y!==r[14]},e.exports=s},{}],12:[function(t,e,i){"use strict";function s(t,e){if(!t)throw new Error("DOMElement must be instantiated on a node");if(this._node=t,this._requestingUpdate=!1,this._renderSized=!1,this._requestRenderSize=!1,this._changeQueue=[],this._UIEvents=t.getUIEvents().slice(0),this._classes=["famous-dom-element"],this._requestingEventListeners=[],this._styles={},this.setProperty("display",t.isShown()?"none":"block"),this.onOpacityChange(t.getOpacity()),this._attributes={},this._content="",this._tagName=e&&e.tagName?e.tagName:"div",this._id=t.addComponent(this),this._renderSize=[0,0,0],this._callbacks=new r,e){var i,s;if(e.classes)for(i=0;i<e.classes.length;i++)this.addClass(e.classes[i]);if(e.attributes)for(s in e.attributes)this.setAttribute(s,e.attributes[s]);if(e.properties)for(s in e.properties)this.setProperty(s,e.properties[s]);e.id&&this.setId(e.id),e.content&&this.setContent(e.content),e.cutout===!1&&this.setCutoutState(e.cutout)}}var r=t("../utilities/CallbackStore"),n=2;s.prototype.getValue=function(){return{classes:this._classes,styles:this._styles,attributes:this._attributes,content:this._content,id:this._attributes.id,tagName:this._tagName}},s.prototype.onUpdate=function(){var t=this._node,e=this._changeQueue,i=e.length;if(i&&t){for(t.sendDrawCommand("WITH"),t.sendDrawCommand(t.getLocation());i--;)t.sendDrawCommand(e.shift());this._requestRenderSize&&(t.sendDrawCommand("DOM_RENDER_SIZE"),t.sendDrawCommand(t.getLocation()),this._requestRenderSize=!1)}this._requestingUpdate=!1},s.prototype.onMount=function(t,e){this._node=t,this._id=e,this._UIEvents=t.getUIEvents().slice(0),this.draw(),this.setAttribute("data-fa-path",t.getLocation())},s.prototype.onDismount=function(){this.setProperty("display","none"),this.setAttribute("data-fa-path",""),this._initialized=!1},s.prototype.onShow=function(){this.setProperty("display","block")},s.prototype.onHide=function(){this.setProperty("display","none")},s.prototype.setCutoutState=function(t){this._changeQueue.push("GL_CUTOUT_STATE",t),this._initialized&&this._requestUpdate()},s.prototype.onTransformChange=function(t){this._changeQueue.push("CHANGE_TRANSFORM");for(var e=0,i=t.length;i>e;e++)this._changeQueue.push(t[e]);this.onUpdate()},s.prototype.onSizeChange=function(t){var e=this._node.getSizeMode(),i=e[0]!==n,s=e[1]!==n;return this._initialized&&this._changeQueue.push("CHANGE_SIZE",i?t[0]:i,s?t[1]:s),this._requestingUpdate||this._requestUpdate(),this},s.prototype.onOpacityChange=function(t){return this.setProperty("opacity",t)},s.prototype.onAddUIEvent=function(t){return-1===this._UIEvents.indexOf(t)?(this._subscribe(t),this._UIEvents.push(t)):this._inDraw&&this._subscribe(t),this},s.prototype._subscribe=function(t){this._initialized&&this._changeQueue.push("SUBSCRIBE",t,!0),this._requestingUpdate||this._requestUpdate()},s.prototype.onSizeModeChange=function(t,e,i){(t===n||e===n||i===n)&&(this._renderSized=!0,this._requestRenderSize=!0),this.onSizeChange(this._node.getSize())},s.prototype.getRenderSize=function(){return this._renderSize},s.prototype._requestUpdate=function(){this._requestingUpdate||(this._node.requestUpdate(this._id),this._requestingUpdate=!0)},s.prototype.init=function(){this._changeQueue.push("INIT_DOM",this._tagName),this._initialized=!0,this.onTransformChange(this._node.getTransform()),this.onSizeChange(this._node.getSize()),this._requestingUpdate||this._requestUpdate()},s.prototype.setId=function(t){return this.setAttribute("id",t),this},s.prototype.addClass=function(t){return this._classes.indexOf(t)<0?(this._initialized&&this._changeQueue.push("ADD_CLASS",t),this._classes.push(t),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0),this):(this._inDraw&&(this._initialized&&this._changeQueue.push("ADD_CLASS",t),this._requestingUpdate||this._requestUpdate()),this)},s.prototype.removeClass=function(t){var e=this._classes.indexOf(t);return 0>e?this:(this._changeQueue.push("REMOVE_CLASS",t),this._classes.splice(e,1),this._requestingUpdate||this._requestUpdate(),this)},s.prototype.hasClass=function(t){return-1!==this._classes.indexOf(t)},s.prototype.setAttribute=function(t,e){return(this._attributes[t]!==e||this._inDraw)&&(this._attributes[t]=e,this._initialized&&this._changeQueue.push("CHANGE_ATTRIBUTE",t,e),this._requestUpdate||this._requestUpdate()),this},s.prototype.setProperty=function(t,e){return(this._styles[t]!==e||this._inDraw)&&(this._styles[t]=e,this._initialized&&this._changeQueue.push("CHANGE_PROPERTY",t,e),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0)),this},s.prototype.setContent=function(t){return(this._content!==t||this._inDraw)&&(this._content=t,this._initialized&&this._changeQueue.push("CHANGE_CONTENT",t),this._requestingUpdate||this._requestUpdate(),this._renderSized&&(this._requestRenderSize=!0)),this},s.prototype.on=function(t,e){return this._callbacks.on(t,e)},s.prototype.onReceive=function(t,e){"resize"===t&&(this._renderSize[0]=e.val[0],this._renderSize[1]=e.val[1],this._requestingUpdate||this._requestUpdate()),this._callbacks.trigger(t,e)},s.prototype.draw=function(){var t,e,i;for(this._inDraw=!0,this.init(),e=0,i=this._classes.length;i>e;e++)this.addClass(this._classes[e]);this._content&&this.setContent(this._content);for(t in this._styles)this._styles[t]&&this.setProperty(t,this._styles[t]);for(t in this._attributes)this._attributes[t]&&this.setAttribute(t,this._attributes[t]);for(e=0,i=this._UIEvents.length;i>e;e++)this.onAddUIEvent(this._UIEvents[e]);this._inDraw=!1},e.exports=s},{"../utilities/CallbackStore":68}],13:[function(t,e,i){"use strict";function s(t,e,i){var s=this;t.classList.add("famous-dom-renderer"),u=u||a("transform"),this._compositor=i,this._target=null,this._parent=null,this._path=null,this._children=[],this._root=new n(t,e),this._boundTriggerEvent=function(t){return s._triggerEvent(t)},this._selector=e,this._elements={},this._elements[e]=this._root,this.perspectiveTransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._VPtransform=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._size=[null,null]}function r(t){for(var e=[],i=t.target;i!==document.body;)e.push(i),i=i.parentNode;return e}var n=t("./ElementCache"),o=t("./Math"),a=t("../utilities/vendorPrefix"),h=t("./events/EventMap"),u=null;s.prototype.subscribe=function(t,e){if(this._assertTargetLoaded(),this._target.preventDefault[t]=e,this._target.subscribe[t]=!0,!this._target.listeners[t]&&!this._root.listeners[t]){var i=h[t][1]?this._root:this._target;i.listeners[t]=this._boundTriggerEvent,i.element.addEventListener(t,this._boundTriggerEvent)}},s.prototype._triggerEvent=function(t){for(var e=t.path?t.path:r(t),i=0;i<e.length;i++)if(e[i].dataset){var s=e[i].dataset.faPath;if(s&&this._elements[s]&&this._elements[s].subscribe[t.type]){t.stopPropagation(),this._elements[s].preventDefault[t.type]&&t.preventDefault();var n=h[t.type][0];this._compositor.sendEvent(s,t.type,new n(t));break}}},s.prototype.getSizeOf=function(t){var e=this._elements[t];if(!e)return null;var i={val:e.size};return this._compositor.sendEvent(t,"resize",i),i},s.prototype.getSize=function(){return this._size[0]=this._root.element.offsetWidth,this._size[1]=this._root.element.offsetHeight,this._size},s.prototype._getSize=s.prototype.getSize,s.prototype.draw=function(t){t.perspectiveDirty&&(this.perspectiveDirty=!0,this.perspectiveTransform[0]=t.perspectiveTransform[0],this.perspectiveTransform[1]=t.perspectiveTransform[1],this.perspectiveTransform[2]=t.perspectiveTransform[2],this.perspectiveTransform[3]=t.perspectiveTransform[3],this.perspectiveTransform[4]=t.perspectiveTransform[4],this.perspectiveTransform[5]=t.perspectiveTransform[5],this.perspectiveTransform[6]=t.perspectiveTransform[6],this.perspectiveTransform[7]=t.perspectiveTransform[7],this.perspectiveTransform[8]=t.perspectiveTransform[8],this.perspectiveTransform[9]=t.perspectiveTransform[9],this.perspectiveTransform[10]=t.perspectiveTransform[10],this.perspectiveTransform[11]=t.perspectiveTransform[11],this.perspectiveTransform[12]=t.perspectiveTransform[12],this.perspectiveTransform[13]=t.perspectiveTransform[13],this.perspectiveTransform[14]=t.perspectiveTransform[14],this.perspectiveTransform[15]=t.perspectiveTransform[15]),(t.viewDirty||t.perspectiveDirty)&&(o.multiply(this._VPtransform,this.perspectiveTransform,t.viewTransform),this._root.element.style[u]=this._stringifyMatrix(this._VPtransform))},s.prototype._assertPathLoaded=function(){if(!this._path)throw new Error("path not loaded")},s.prototype._assertParentLoaded=function(){if(!this._parent)throw new Error("parent not loaded")},s.prototype._assertChildrenLoaded=function(){if(!this._children)throw new Error("children not loaded")},s.prototype._assertTargetLoaded=function(){if(!this._target)throw new Error("No target loaded")},s.prototype.findParent=function(){this._assertPathLoaded();for(var t,e=this._path;!t&&e.length;)e=e.substring(0,e.lastIndexOf("/")),t=this._elements[e];return this._parent=t,t},s.prototype.findChildren=function(t){this._assertPathLoaded();var e,i=this._path+"/",s=Object.keys(this._elements),r=0;for(t=t?t:this._children,this._children.length=0;r<s.length;)-1===s[r].indexOf(i)||s[r]===i?s.splice(r,1):r++;var n,o=0;for(r=0;r<s.length;r++)for(n=s[r],o=0;o<s.length;o++)r!==o&&-1!==s[o].indexOf(n)&&(s.splice(o,1),r--);for(r=0,e=s.length;e>r;r++)t[r]=this._elements[s[r]];return t},s.prototype.findTarget=function(){return this._target=this._elements[this._path],this._target},s.prototype.loadPath=function(t){return this._path=t,this._path},s.prototype.insertEl=function(t){if(!this._target||this._target.element.tagName.toLowerCase()!==t.toLowerCase()){this.findParent(),this.findChildren(),this._assertParentLoaded(),this._assertChildrenLoaded(),this._target&&this._parent.element.removeChild(this._target.element),this._target=new n(document.createElement(t),this._path),this._parent.element.appendChild(this._target.element),this._elements[this._path]=this._target;for(var e=0,i=this._children.length;i>e;e++)this._target.element.appendChild(this._children[e].element)}},s.prototype.setProperty=function(t,e){this._assertTargetLoaded(),this._target.element.style[t]=e},s.prototype.setSize=function(t,e){this._assertTargetLoaded(),this.setWidth(t),this.setHeight(e)},s.prototype.setWidth=function(t){this._assertTargetLoaded();var e=this._target.content;t===!1?(this._target.explicitWidth=!0,e&&(e.style.width=""),t=e?e.offsetWidth:0,this._target.element.style.width=t+"px"):(this._target.explicitWidth=!1,e&&(e.style.width=t+"px"),this._target.element.style.width=t+"px"),this._target.size[0]=t},s.prototype.setHeight=function(t){this._assertTargetLoaded();var e=this._target.content;t===!1?(this._target.explicitHeight=!0,e&&(e.style.height=""),t=e?e.offsetHeight:0,this._target.element.style.height=t+"px"):(this._target.explicitHeight=!1,e&&(e.style.height=t+"px"),this._target.element.style.height=t+"px"),this._target.size[1]=t},s.prototype.setAttribute=function(t,e){this._assertTargetLoaded(),this._target.element.setAttribute(t,e)},s.prototype.setContent=function(t){this._assertTargetLoaded(),this.findChildren(),this._target.content||(this._target.content=document.createElement("div"),this._target.content.classList.add("famous-dom-element-content"),this._target.element.insertBefore(this._target.content,this._target.element.firstChild)),this._target.content.innerHTML=t,this.setSize(this._target.explicitWidth?!1:this._target.size[0],this._target.explicitHeight?!1:this._target.size[1])},s.prototype.setMatrix=function(t){this._assertTargetLoaded(),this.findParent();var e,i,s=this._target.worldTransform,r=!1;if(t)for(e=0,i=16;i>e;e++)r=r?r:s[e]===t[e],s[e]=t[e];else r=!0;if(r){o.invert(this._target.invertedParent,this._parent.worldTransform),o.multiply(this._target.finalTransform,this._target.invertedParent,s);var n=this.findChildren([]),a=this._path,h=this._target;for(e=0,i=n.length;i>e;e++)this._target=n[e],this._path=this._target.path,this.setMatrix();this._path=a,this._target=h}this._target.element.style[u]=this._stringifyMatrix(this._target.finalTransform)},s.prototype.addClass=function(t){this._assertTargetLoaded(),this._target.element.classList.add(t)},s.prototype.removeClass=function(t){this._assertTargetLoaded(),this._target.element.classList.remove(t)},s.prototype._stringifyMatrix=function(t){var e="matrix3d(";return e+=t[0]<1e-6&&t[0]>-1e-6?"0,":t[0]+",",e+=t[1]<1e-6&&t[1]>-1e-6?"0,":t[1]+",",e+=t[2]<1e-6&&t[2]>-1e-6?"0,":t[2]+",",e+=t[3]<1e-6&&t[3]>-1e-6?"0,":t[3]+",",e+=t[4]<1e-6&&t[4]>-1e-6?"0,":t[4]+",",e+=t[5]<1e-6&&t[5]>-1e-6?"0,":t[5]+",",e+=t[6]<1e-6&&t[6]>-1e-6?"0,":t[6]+",",e+=t[7]<1e-6&&t[7]>-1e-6?"0,":t[7]+",",e+=t[8]<1e-6&&t[8]>-1e-6?"0,":t[8]+",",e+=t[9]<1e-6&&t[9]>-1e-6?"0,":t[9]+",",e+=t[10]<1e-6&&t[10]>-1e-6?"0,":t[10]+",",e+=t[11]<1e-6&&t[11]>-1e-6?"0,":t[11]+",",e+=t[12]<1e-6&&t[12]>-1e-6?"0,":t[12]+",",e+=t[13]<1e-6&&t[13]>-1e-6?"0,":t[13]+",",e+=t[14]<1e-6&&t[14]>-1e-6?"0,":t[14]+",",e+=t[15]+")"},e.exports=s},{"../utilities/vendorPrefix":72,"./ElementCache":14,"./Math":15,"./events/EventMap":18}],14:[function(t,e,i){"use strict";function s(t,e){this.element=t,this.path=e,this.content=null,this.size=new Int16Array(3),this.explicitHeight=!1,this.explicitWidth=!1,this.worldTransform=new Float32Array(r),this.invertedParent=new Float32Array(r),this.finalTransform=new Float32Array(r),this.postRenderSize=new Float32Array(2),this.listeners={},this.preventDefault={},this.subscribe={}}var r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];e.exports=s},{}],15:[function(t,e,i){"use strict";function s(t,e){var i=e[0],s=e[1],r=e[2],n=e[3],o=e[4],a=e[5],h=e[6],u=e[7],c=e[8],p=e[9],l=e[10],d=e[11],f=e[12],m=e[13],y=e[14],v=e[15],g=i*a-s*o,_=i*h-r*o,b=i*u-n*o,x=s*h-r*a,w=s*u-n*a,I=r*u-n*h,C=c*m-p*f,T=c*y-l*f,M=c*v-d*f,E=p*y-l*m,A=p*v-d*m,z=l*v-d*y,R=g*z-_*A+b*E+x*M-w*T+I*C;return R?(R=1/R,t[0]=(a*z-h*A+u*E)*R,t[1]=(r*A-s*z-n*E)*R,t[2]=(m*I-y*w+v*x)*R,t[3]=(l*w-p*I-d*x)*R,t[4]=(h*M-o*z-u*T)*R,t[5]=(i*z-r*M+n*T)*R,t[6]=(y*b-f*I-v*_)*R,t[7]=(c*I-l*b+d*_)*R,t[8]=(o*A-a*M+u*C)*R,t[9]=(s*M-i*A-n*C)*R,t[10]=(f*w-m*b+v*g)*R,t[11]=(p*b-c*w-d*g)*R,t[12]=(a*T-o*E-h*C)*R,t[13]=(i*E-s*T+r*C)*R,t[14]=(m*_-f*x-y*g)*R,t[15]=(c*x-p*_+l*g)*R,t):null}function r(t,e,i){var s,r,n,o,a=e[0],h=e[1],u=e[2],c=e[3],p=e[4],l=e[5],d=e[6],f=e[7],m=e[8],y=e[9],v=e[10],g=e[11],_=e[12],b=e[13],x=e[14],w=e[15],I=i[0],C=i[1],T=i[2],M=i[3],E=i[4],A=i[5],z=i[6],R=i[7],S=i[8],D=i[9],O=i[10],P=i[11],L=i[12],V=i[13],U=i[14],F=i[15],k=!1;return s=I*a+C*p+T*m+M*_,r=I*h+C*l+T*y+M*b,n=I*u+C*d+T*v+M*x,o=I*c+C*f+T*g+M*w,k=k?k:s===t[0]||r===t[1]||n===t[2]||o===t[3],t[0]=s,t[1]=r,t[2]=n,t[3]=o,I=E,C=A,T=z,M=R,s=I*a+C*p+T*m+M*_,r=I*h+C*l+T*y+M*b,n=I*u+C*d+T*v+M*x,o=I*c+C*f+T*g+M*w,k=k?k:s===t[4]||r===t[5]||n===t[6]||o===t[7],t[4]=s,t[5]=r,t[6]=n,t[7]=o,I=S,C=D,T=O,M=P,s=I*a+C*p+T*m+M*_,r=I*h+C*l+T*y+M*b,n=I*u+C*d+T*v+M*x,o=I*c+C*f+T*g+M*w,k=k?k:s===t[8]||r===t[9]||n===t[10]||o===t[11],t[8]=s,t[9]=r,t[10]=n,t[11]=o,I=L,C=V,T=U,M=F,s=I*a+C*p+T*m+M*_,r=I*h+C*l+T*y+M*b,n=I*u+C*d+T*v+M*x,o=I*c+C*f+T*g+M*w,k=k?k:s===t[12]||r===t[13]||n===t[14]||o===t[15],t[12]=s,t[13]=r,t[14]=n,t[15]=o,t}e.exports={multiply:r,invert:s}},{}],16:[function(t,e,i){"use strict";function s(t){r.call(this,t),this.data=t.data}var r=t("./UIEvent");s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return"CompositionEvent"},e.exports=s},{"./UIEvent":24}],17:[function(t,e,i){"use strict";function s(t){this.type=t.type,this.defaultPrevented=t.defaultPrevented,this.timeStamp=t.timeStamp;var e=t.target.constructor;(e===HTMLInputElement||e===HTMLTextAreaElement||e===HTMLSelectElement)&&(this.value=t.target.value)}s.prototype.toString=function(){return"Event"},e.exports=s},{}],18:[function(t,e,i){"use strict";var s=t("./CompositionEvent"),r=t("./Event"),n=t("./FocusEvent"),o=t("./InputEvent"),a=t("./KeyboardEvent"),h=t("./MouseEvent"),u=t("./TouchEvent"),c=t("./UIEvent"),p=t("./WheelEvent"),l={change:[r,!0],submit:[r,!0],abort:[r,!1],beforeinput:[o,!0],blur:[n,!1],click:[h,!0],compositionend:[s,!0],compositionstart:[s,!0],compositionupdate:[s,!0],dblclick:[h,!0],focus:[n,!1],focusin:[n,!0],focusout:[n,!0],input:[o,!0],keydown:[a,!0],keyup:[a,!0],load:[r,!1],mousedown:[h,!0],mouseenter:[h,!1],mouseleave:[h,!1],mousemove:[h,!1],mouseout:[h,!0],mouseover:[h,!0],mouseup:[h,!0],resize:[c,!1],scroll:[c,!1],select:[r,!0],unload:[r,!1],wheel:[p,!0],touchcancel:[u,!0],touchend:[u,!0],touchmove:[u,!0],touchstart:[u,!0]};e.exports=l},{"./CompositionEvent":16,"./Event":17,"./FocusEvent":19,"./InputEvent":20,"./KeyboardEvent":21,"./MouseEvent":22,"./TouchEvent":23,"./UIEvent":24,"./WheelEvent":25}],19:[function(t,e,i){"use strict";function s(t){r.call(this,t)}var r=t("./UIEvent");s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return"FocusEvent"},e.exports=s},{"./UIEvent":24}],20:[function(t,e,i){"use strict";function s(t){r.call(this,t),this.inputType=t.inputType,this.data=t.data,this.isComposing=t.isComposing,this.targetRange=t.targetRange}var r=t("./UIEvent");s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return"InputEvent"},e.exports=s},{"./UIEvent":24}],21:[function(t,e,i){"use strict";function s(t){r.call(this,t),this.DOM_KEY_LOCATION_STANDARD=0,this.DOM_KEY_LOCATION_LEFT=1,this.DOM_KEY_LOCATION_RIGHT=2,this.DOM_KEY_LOCATION_NUMPAD=3,this.key=t.key,this.code=t.code,this.location=t.location,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.repeat=t.repeat,this.isComposing=t.isComposing,this.keyCode=t.keyCode}var r=t("./UIEvent");s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return"KeyboardEvent"},e.exports=s},{"./UIEvent":24}],22:[function(t,e,i){"use strict";function s(t){r.call(this,t),this.screenX=t.screenX,this.screenY=t.screenY,this.clientX=t.clientX,this.clientY=t.clientY,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.altKey=t.altKey,this.metaKey=t.metaKey,this.button=t.button,this.buttons=t.buttons,this.pageX=t.pageX,this.pageY=t.pageY,this.x=t.x,this.y=t.y,this.offsetX=t.offsetX,this.offsetY=t.offsetY}var r=t("./UIEvent");s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return"MouseEvent"},e.exports=s},{"./UIEvent":24}],23:[function(t,e,i){"use strict";function s(t){this.identifier=t.identifier,this.screenX=t.screenX,this.screenY=t.screenY,this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY}function r(t){if(!t)return a;for(var e=[],i=0;i<t.length;i++)e[i]=new s(t[i]);return e}function n(t){o.call(this,t),this.touches=r(t.touches),this.targetTouches=r(t.targetTouches),this.changedTouches=r(t.changedTouches),this.altKey=t.altKey,this.metaKey=t.metaKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey}var o=t("./UIEvent"),a=[];n.prototype=Object.create(o.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return"TouchEvent"},e.exports=n},{"./UIEvent":24}],24:[function(t,e,i){"use strict";function s(t){r.call(this,t),this.detail=t.detail}var r=t("./Event");s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return"UIEvent"},e.exports=s},{"./Event":17}],25:[function(t,e,i){"use strict";function s(t){r.call(this,t),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaZ=t.deltaZ,this.deltaMode=t.deltaMode}var r=t("./MouseEvent");s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return"WheelEvent"},e.exports=s},{"./MouseEvent":22}],26:[function(t,e,i){"use strict";function s(t){this.values=t||[1,0,0,0,1,0,0,0,1]}s.prototype.get=function(){return this.values},s.prototype.set=function(t){return this.values=t,this},s.prototype.copy=function(t){var e=this.values,i=t.values;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},s.prototype.vectorMultiply=function(t,e){var i=this.values,s=t.x,r=t.y,n=t.z;return e.x=i[0]*s+i[1]*r+i[2]*n,e.y=i[3]*s+i[4]*r+i[5]*n,e.z=i[6]*s+i[7]*r+i[8]*n,e},s.prototype.multiply=function(t){var e=this.values,i=t.values,s=e[0],r=e[1],n=e[2],o=e[3],a=e[4],h=e[5],u=e[6],c=e[7],p=e[8],l=i[0],d=i[1],f=i[2],m=i[3],y=i[4],v=i[5],g=i[6],_=i[7],b=i[8];return e[0]=s*l+r*m+n*g,e[1]=s*d+r*y+n*_,e[2]=s*f+r*v+n*b,e[3]=o*l+a*m+h*g,e[4]=o*d+a*y+h*_,e[5]=o*f+a*v+h*b,e[6]=u*l+c*m+p*g,e[7]=u*d+c*y+p*_,e[8]=u*f+c*v+p*b,this},s.prototype.transpose=function(){var t=this.values,e=t[1],i=t[2],s=t[3],r=t[5],n=t[6],o=t[7];return t[1]=s,t[2]=n,t[3]=e,t[5]=o,t[6]=i,t[7]=r,this},s.prototype.getDeterminant=function(){var t=this.values,e=t[3],i=t[4],s=t[5],r=t[6],n=t[7],o=t[8],a=t[0]*(i*o-s*n)-t[1]*(e*o-s*r)+t[2]*(e*n-i*r);return a},s.prototype.inverse=function(){var t=this.values,e=t[0],i=t[1],s=t[2],r=t[3],n=t[4],o=t[5],a=t[6],h=t[7],u=t[8],c=e*(n*u-o*h)-i*(r*u-o*a)+s*(r*h-n*a);return Math.abs(c)<1e-40?null:(c=1/c,t[0]=(n*u-o*h)*c,t[3]=(-r*u+o*a)*c,t[6]=(r*h-n*a)*c,t[1]=(-i*u+s*h)*c,t[4]=(e*u-s*a)*c,t[7]=(-e*h+i*a)*c,t[2]=(i*o-s*n)*c,t[5]=(-e*o+s*r)*c,t[8]=(e*n-i*r)*c,this)},s.clone=function(t){return new s(t.values.slice())},s.inverse=function(t,e){var i=t.values,s=e.values,r=i[0],n=i[1],o=i[2],a=i[3],h=i[4],u=i[5],c=i[6],p=i[7],l=i[8],d=r*(h*l-u*p)-n*(a*l-u*c)+o*(a*p-h*c);return Math.abs(d)<1e-40?null:(d=1/d,s[0]=(h*l-u*p)*d,s[3]=(-a*l+u*c)*d,s[6]=(a*p-h*c)*d,s[1]=(-n*l+o*p)*d,s[4]=(r*l-o*c)*d,s[7]=(-r*p+n*c)*d,s[2]=(n*u-o*h)*d,s[5]=(-r*u+o*a)*d,s[8]=(r*h-n*a)*d,e)},s.transpose=function(t,e){var i=t.values,s=e.values,r=i[0],n=i[1],o=i[2],a=i[3],h=i[4],u=i[5],c=i[6],p=i[7],l=i[8];return s[0]=r,s[1]=a,s[2]=c,s[3]=n,s[4]=h,s[5]=p,s[6]=o,s[7]=u,s[8]=l,e},s.add=function(t,e,i){var s=t.values,r=e.values,n=i.values,o=s[0],a=s[1],h=s[2],u=s[3],c=s[4],p=s[5],l=s[6],d=s[7],f=s[8],m=r[0],y=r[1],v=r[2],g=r[3],_=r[4],b=r[5],x=r[6],w=r[7],I=r[8];return n[0]=o+m,n[1]=a+y,n[2]=h+v,n[3]=u+g,n[4]=c+_,n[5]=p+b,n[6]=l+x,n[7]=d+w,n[8]=f+I,i},s.subtract=function(t,e,i){var s=t.values,r=e.values,n=i.values,o=s[0],a=s[1],h=s[2],u=s[3],c=s[4],p=s[5],l=s[6],d=s[7],f=s[8],m=r[0],y=r[1],v=r[2],g=r[3],_=r[4],b=r[5],x=r[6],w=r[7],I=r[8];return n[0]=o-m,n[1]=a-y,n[2]=h-v,n[3]=u-g,n[4]=c-_,n[5]=p-b,n[6]=l-x,n[7]=d-w,n[8]=f-I,i},s.multiply=function(t,e,i){var s=t.values,r=e.values,n=i.values,o=s[0],a=s[1],h=s[2],u=s[3],c=s[4],p=s[5],l=s[6],d=s[7],f=s[8],m=r[0],y=r[1],v=r[2],g=r[3],_=r[4],b=r[5],x=r[6],w=r[7],I=r[8];return n[0]=o*m+a*g+h*x,n[1]=o*y+a*_+h*w,n[2]=o*v+a*b+h*I,n[3]=u*m+c*g+p*x,n[4]=u*y+c*_+p*w,n[5]=u*v+c*b+p*I,n[6]=l*m+d*g+f*x,n[7]=l*y+d*_+f*w,n[8]=l*v+d*b+f*I,i},e.exports=s},{}],27:[function(t,e,i){"use strict";function s(t,e,i,s){this.w=t||1,this.x=e||0,this.y=i||0,this.z=s||0}var r=Math.sin,n=Math.cos,o=Math.asin,a=Math.acos,h=Math.atan2,u=Math.sqrt;s.prototype.multiply=function(t){var e=this.x,i=this.y,s=this.z,r=this.w,n=t.x,o=t.y,a=t.z,h=t.w||0;return this.w=r*h-e*n-i*o-s*a,this.x=e*h+n*r+o*s-i*a,this.y=i*h+o*r+e*a-n*s,this.z=s*h+a*r+n*i-e*o,this},s.prototype.leftMultiply=function(t){var e=t.x,i=t.y,s=t.z,r=t.w||0,n=this.x,o=this.y,a=this.z,h=this.w;return this.w=r*h-e*n-i*o-s*a,this.x=e*h+n*r+o*s-i*a,this.y=i*h+o*r+e*a-n*s,this.z=s*h+a*r+n*i-e*o,this},s.prototype.rotateVector=function(t,e){var i=this.w,s=-this.x,r=-this.y,n=-this.z,o=t.x,a=t.y,h=t.z,u=-s*o-r*a-n*h,c=o*i+a*n-r*h,p=a*i+s*h-o*n,l=h*i+o*r-s*a,d=i,f=-s,m=-r,y=-n;return e.x=c*d+f*u+m*l-p*y,e.y=p*d+m*u+c*y-f*l,e.z=l*d+y*u+f*p-c*m,e},s.prototype.invert=function(){return this.w=-this.w,this.x=-this.x,this.y=-this.y,this.z=-this.z,this},s.prototype.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},s.prototype.length=function(){var t=this.w,e=this.x,i=this.y,s=this.z;return u(t*t+e*e+i*i+s*s)},s.prototype.normalize=function(){var t=this.w,e=this.x,i=this.y,s=this.z,r=u(t*t+e*e+i*i+s*s);return 0===r?this:(r=1/r,this.w*=r,this.x*=r,this.y*=r,this.z*=r,this)},s.prototype.set=function(t,e,i,s){return null!=t&&(this.w=t),null!=e&&(this.x=e),null!=i&&(this.y=i),null!=s&&(this.z=s),this},s.prototype.copy=function(t){return this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z,this},s.prototype.clear=function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},s.prototype.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},s.prototype.slerp=function(t,e,i){var s,n,o,h,u,c=this.w,p=this.x,l=this.y,d=this.z,f=t.w,m=t.x,y=t.y,v=t.z;return n=c*f+p*m+l*y+d*v,1-n>1e-5?(s=a(n),o=r(s),h=r((1-e)*s)/o,u=r(e*s)/o):(h=1-e,u=e),i.w=c*h+f*u,i.x=p*h+m*u,i.y=l*h+y*u,i.z=d*h+v*u,i},s.prototype.toMatrix=function(t){var e=this.w,i=this.x,s=this.y,r=this.z,n=i*i,o=s*s,a=r*r,h=i*s,u=i*r,c=s*r;return t.set([1-2*(o+a),2*(h-e*r),2*(u+e*s),2*(h+e*r),1-2*(n+a),2*(c-e*i),2*(u-e*s),2*(c+e*i),1-2*(n+o)])},s.prototype.toEuler=function(t){var e=this.w,i=this.x,s=this.y,r=this.z,n=i*i,a=s*s,u=r*r,c=2*(i*r+s*e);return c=-1>c?-1:c>1?1:c,t.x=h(2*(i*e-s*r),1-2*(n+a)),t.y=o(c),t.z=h(2*(r*e-i*s),1-2*(a+u)),t},s.prototype.fromEuler=function(t,e,i){var s=.5*t,o=.5*e,a=.5*i,h=r(s),u=r(o),c=r(a),p=n(s),l=n(o),d=n(a);return this.w=p*l*d-h*u*c,this.x=h*l*d+p*u*c,this.y=p*u*d-h*l*c,this.z=p*l*c+h*u*d,this},s.prototype.fromAngleAxis=function(t,e,i,s){var o=u(e*e+i*i+s*s);if(0===o)this.w=1,this.x=this.y=this.z=0;else{o=1/o;var a=.5*t,h=r(a);this.w=n(a),this.x=h*e*o,this.y=h*i*o,this.z=h*s*o}return this},s.multiply=function(t,e,i){var s=t.w||0,r=t.x,n=t.y,o=t.z,a=e.w||0,h=e.x,u=e.y,c=e.z;return i.w=s*a-r*h-n*u-o*c,i.x=r*a+h*s+u*o-n*c,i.y=n*a+u*s+r*c-h*o,i.z=o*a+c*s+h*n-r*u,i},s.normalize=function(t,e){var i=t.w,s=t.x,r=t.y,n=t.z,o=u(i*i+s*s+r*r+n*n);return 0===o?this:(o=1/o,e.w*=o,e.x*=o,e.y*=o,e.z*=o,e)},s.conjugate=function(t,e){return e.w=t.w,e.x=-t.x,e.y=-t.y,e.z=-t.z,e},s.clone=function(t){return new s(t.w,t.x,t.y,t.z)},s.dot=function(t,e){return t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z},e.exports=s},{}],28:[function(t,e,i){"use strict";var s=function(t,e){t instanceof Array||t instanceof Float32Array?(this.x=t[0]||0,this.y=t[1]||0):(this.x=t||0,this.y=e||0)};s.prototype.set=function(t,e){return null!=t&&(this.x=t),null!=e&&(this.y=e),this},s.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},s.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},s.prototype.scale=function(t){return t instanceof s?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*=t),this},s.prototype.rotate=function(t){var e=this.x,i=this.y,s=Math.cos(t),r=Math.sin(t);return this.x=e*s-i*r,this.y=e*r+i*s,this},s.prototype.dot=function(t){return this.x*t.x+this.y*t.y},s.prototype.cross=function(t){return this.x*t.y-this.y*t.x},s.prototype.invert=function(){return this.x*=-1,this.y*=-1,this},s.prototype.map=function(t){return this.x=t(this.x),this.y=t(this.y),this},s.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},s.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},s.prototype.clear=function(){return this.x=0,this.y=0,this},s.prototype.isZero=function(){return 0!==this.x||0!==this.y?!1:!0},s.prototype.toArray=function(){return[this.x,this.y]},s.normalize=function(t,e){var i=t.x,s=t.y,r=Math.sqrt(i*i+s*s)||1;return r=1/r,e.x=t.x*r,e.y=t.y*r,e},s.clone=function(t){return new s(t.x,t.y)},s.add=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i},s.subtract=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i},s.scale=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i},s.dot=function(t,e){return t.x*e.x+t.y*e.y},s.cross=function(t,e){return t.x*e.y-t.y*e.x},e.exports=s},{}],29:[function(t,e,i){"use strict";var s=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};s.prototype.set=function(t,e,i){return null!=t&&(this.x=t),null!=e&&(this.y=e),null!=i&&(this.z=i),this},s.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},s.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},s.prototype.rotateX=function(t){var e=this.y,i=this.z,s=Math.cos(t),r=Math.sin(t);return this.y=e*s-i*r,this.z=e*r+i*s,this},s.prototype.rotateY=function(t){var e=this.x,i=this.z,s=Math.cos(t),r=Math.sin(t);return this.x=i*r+e*s,this.z=i*s-e*r,this},s.prototype.rotateZ=function(t){var e=this.x,i=this.y,s=Math.cos(t),r=Math.sin(t);return this.x=e*s-i*r,this.y=e*r+i*s,this},s.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},s.prototype.cross=function(t){var e=this.x,i=this.y,s=this.z,r=t.x,n=t.y,o=t.z;return this.x=i*o-s*n,this.y=s*r-e*o,this.z=e*n-i*r,this},s.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},s.prototype.invert=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},s.prototype.map=function(t){return this.x=t(this.x),this.y=t(this.y),this.z=t(this.z),this},s.prototype.length=function(){var t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i)},s.prototype.lengthSq=function(){var t=this.x,e=this.y,i=this.z;return t*t+e*e+i*i},s.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},s.prototype.clear=function(){return this.x=0,this.y=0,this.z=0,this},s.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},s.prototype.toArray=function(){return[this.x,this.y,this.z]},s.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,s=Math.sqrt(t*t+e*e+i*i)||1;return s=1/s,this.x*=s,this.y*=s,this.z*=s,this},s.prototype.applyRotation=function(t){var e=t.w,i=-t.x,s=-t.y,r=-t.z,n=this.x,o=this.y,a=this.z,h=-i*n-s*o-r*a,u=n*e+o*r-s*a,c=o*e+i*a-n*r,p=a*e+n*s-i*o,l=e,d=-i,f=-s,m=-r;return this.x=u*l+d*h+f*p-c*m,this.y=c*l+f*h+u*m-d*p,this.z=p*l+m*h+d*c-u*f,this},s.prototype.applyMatrix=function(t){
var e=t.get(),i=this.x,s=this.y,r=this.z;return this.x=e[0]*i+e[1]*s+e[2]*r,this.y=e[3]*i+e[4]*s+e[5]*r,this.z=e[6]*i+e[7]*s+e[8]*r,this},s.normalize=function(t,e){var i=t.x,s=t.y,r=t.z,n=Math.sqrt(i*i+s*s+r*r)||1;return n=1/n,e.x=i*n,e.y=s*n,e.z=r*n,e},s.applyRotation=function(t,e,i){var s=e.w,r=-e.x,n=-e.y,o=-e.z,a=t.x,h=t.y,u=t.z,c=-r*a-n*h-o*u,p=a*s+h*o-n*u,l=h*s+r*u-a*o,d=u*s+a*n-r*h,f=s,m=-r,y=-n,v=-o;return i.x=p*f+m*c+y*d-l*v,i.y=l*f+y*c+p*v-m*d,i.z=d*f+v*c+m*l-p*y,i},s.clone=function(t){return new s(t.x,t.y,t.z)},s.add=function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i},s.subtract=function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i},s.scale=function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i.z=t.z*e,i},s.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},s.cross=function(t,e,i){var s=t.x,r=t.y,n=t.z,o=e.x,a=e.y,h=e.z;return i.x=r*h-n*a,i.y=n*o-s*h,i.z=s*a-r*o,i},s.project=function(t,e,i){var s=t.x,r=t.y,n=t.z,o=e.x,a=e.y,h=e.z,u=s*o+r*a+n*h;return u/=o*o+a*a+h*h,i.x=o*u,i.y=a*u,i.z=h*u,i},e.exports=s},{}],30:[function(t,e,i){e.exports={Mat33:t("./Mat33"),Quaternion:t("./Quaternion"),Vec2:t("./Vec2"),Vec3:t("./Vec3")}},{"./Mat33":26,"./Quaternion":27,"./Vec2":28,"./Vec3":29}],31:[function(t,e,i){function s(){throw new Error("You should bundle your code using `glslify` as a transform.")}e.exports=s},{}],32:[function(t,e,i){function s(t,e,i,s){return{vertex:t,fragment:e,uniforms:i,attributes:s}}e.exports=s},{}],33:[function(t,e,i){"use strict";function s(t,e,i){var s=v;return l.cross(t,e,s),l.cross(s,i,s),s}function r(t,e){for(var i,s,r,n,o=-(1/0),a=0;a<t.length;a++)r=t[a],s=l.dot(r,e),s>o&&(i=r,o=s,n=a);return{vertex:i,index:n}}function n(t,e,i){this.distance=t,this.normal=e,this.vertexIndices=i}function o(){this.vertices=[],this.numVertices=0,this.features=[],this.numFeatures=0,this.lastVertexIndex=0,this._IDPool={vertices:[],features:[]}}function a(t,e,i,s){for(var r=t[i].vertex,n=t[s].vertex,o=0,a=e.length;a>o;o++){var h=e[o];if(h){var u=t[h[0]].vertex,c=t[h[1]].vertex;if(r===u&&n===c||r===c&&n===u)return void(e[o]=null)}}e.push([i,s])}function h(t,e){e=e||1e3;var i,s,r=u(t,e),n=[];for(i=0,s=r.features.length;s>i;i++){var o=r.features[i];o&&n.push(o.vertexIndices)}var a=p(r.vertices,n),h=a.centroid,c=[];for(i=0,s=r.vertices.length;s>i;i++)c.push(l.subtract(r.vertices[i].vertex,h,new l));var d=[];for(i=0,s=c.length;s>i;i++)d.push(l.normalize(c[i],new l));var f={},m={};for(i=0;i<n.length;i++){var y=n[i][0],v=n[i][1],g=n[i][2];m[y]=m[y]||{},m[v]=m[v]||{},m[g]=m[g]||{},f[y]=f[y]||[],f[v]=f[v]||[],f[g]=f[g]||[],m[y][v]||(m[y][v]=1,f[y].push(v)),m[y][g]||(m[y][g]=1,f[y].push(g)),m[v][y]||(m[v][y]=1,f[v].push(y)),m[v][g]||(m[v][g]=1,f[v].push(g)),m[g][y]||(m[g][y]=1,f[g].push(y)),m[g][v]||(m[g][v]=1,f[g].push(v))}this.indices=n,this.vertices=c,this.normals=d,this.polyhedralProperties=a,this.graph=f}function u(t,e){var i=new o;i.addVertex(r(t,new l(1,0,0))),i.addVertex(r(t,new l(-1,0,0)));var n,a,h,u,c,p,d=i.vertices[0].vertex,f=i.vertices[1].vertex,m=l.subtract(f,d,x),y=-(1/0);for(c=0;c<t.length;c++)if(a=t[c],a!==d&&a!==f){var v=l.subtract(a,d,g);n=l.dot(v,s(m,v,m)),n=0>n?-1*n:n,n>y&&(y=n,h=a,u=c)}i.addVertex({vertex:h,index:u});var _=h,b=l.subtract(_,d,w),M=l.cross(m,b,new l);for(M.normalize(),y=-(1/0),c=0;c<t.length;c++)a=t[c],a!==d&&a!==f&&a!==_&&(n=l.dot(l.subtract(a,d,g),M),n=0>n?-1*n:n,n>y&&(y=n,h=a,u=c));i.addVertex({vertex:h,index:u});var E=h,A=l.subtract(E,d,I),z=l.subtract(_,f,C),R=l.subtract(E,f,T),S=l.cross(b,A,new l),D=l.cross(m,A,new l),O=l.cross(z,R,new l);S.normalize(),D.normalize(),O.normalize(),l.dot(M,A)>0&&M.invert(),l.dot(S,m)>0&&S.invert(),l.dot(D,b)>0&&D.invert(),l.dot(O,m)<0&&O.invert();var P=0,L=1,V=2,U=3;i.addFeature(null,M,[P,L,V]),i.addFeature(null,S,[P,V,U]),i.addFeature(null,D,[P,L,U]),i.addFeature(null,O,[L,V,U]);var F={};for(c=0,p=i.vertices.length;p>c;c++)F[i.vertices[c].index]=!0;var k=d.x+f.x+_.x+E.x,G=d.y+f.y+_.y+E.y,B=d.z+f.z+_.z+E.z,N=new l(k,G,B);N.scale(.25);for(var q=i.features,W=0;W++<e;){var H=null;for(c=0,p=q.length;p>c;c++)if(q[c]&&!q[c].done){H=q[c],h=null,u=null,d=i.vertices[H.vertexIndices[0]].vertex;var j=r(t,H.normal);h=j.vertex,u=j.index;var K=l.dot(l.subtract(h,d,g),H.normal);.001>K||F[u]?H.done=!0:(F[u]=!0,i.addVertex(j),i.reshape(N))}if(null===H)break}return i}function c(t,e,i,s,r){var n=t+e;s[0]=n+i;var o=t*t,a=o+e*n;s[1]=a+i*s[0],s[2]=t*o+e*a+i*s[1],r[0]=s[1]+t*(s[0]+t),r[1]=s[1]+e*(s[0]+e),r[2]=s[1]+i*(s[0]+i)}function p(t,e){var i,s,r=[0,0,0,0,0,0,0,0,0,0],n=[],o=[],a=[],h=[],u=[],p=[];for(i=0,s=e.length;s>i;i++){var f=t[e[i][0]].vertex,m=t[e[i][1]].vertex,y=t[e[i][2]].vertex,v=l.subtract(m,f,x),g=l.subtract(y,f,w),_=v.cross(g);l.dot(f,_)<0&&_.invert();var b=_.x,I=_.y,C=_.z,T=f.x,M=f.y,E=f.z,A=m.x,z=m.y,R=m.z,S=y.x,D=y.y,O=y.z;c(T,A,S,n,h),c(M,z,D,o,u),c(E,R,O,a,p),r[0]+=b*n[0],r[1]+=b*n[1],r[2]+=I*o[1],r[3]+=C*a[1],r[4]+=b*n[2],r[5]+=I*o[2],r[6]+=C*a[2],r[7]+=b*(M*h[0]+z*h[1]+D*h[2]),r[8]+=I*(E*u[0]+R*u[1]+O*u[2]),r[9]+=C*(T*p[0]+A*p[1]+S*p[2])}r[0]/=6,r[1]/=24,r[2]/=24,r[3]/=24,r[4]/=60,r[5]/=60,r[6]/=60,r[7]/=120,r[8]/=120,r[9]/=120;var P=1/0,L=-(1/0),V=1/0,U=-(1/0),F=1/0,k=-(1/0);for(i=0,s=t.length;s>i;i++){var G=t[i].vertex;G.x<P&&(P=G.x),G.x>L&&(L=G.x),G.y<V&&(V=G.y),G.y>U&&(U=G.y),G.z<F&&(F=G.z),G.z>k&&(k=G.z)}var B=[L-P,U-V,k-F],N=r[0],q=new l(r[1],r[2],r[3]);q.scale(1/N);var W=new d([r[4],r[7],r[9],r[7],r[5],r[8],r[9],r[8],r[6]]);return{size:B,volume:N,centroid:q,eulerTensor:W}}var l=t("../math/Vec3"),d=t("../math/Mat33"),f=t("../utilities/ObjectManager");f.register("DynamicGeometry",o),f.register("DynamicGeometryFeature",n);var m=f.requestDynamicGeometryFeature,y=f.freeDynamicGeometryFeature,v=new l,g=new l,_=new l,b=new l,x=new l,w=new l,I=new l,C=new l,T=new l;n.prototype.reset=function(t,e,i){return this.distance=t,this.normal=e,this.vertexIndices=i,this},o.prototype.reset=function(){return this.vertices=[],this.numVertices=0,this.features=[],this.numFeatures=0,this.lastVertexIndex=0,this._IDPool={vertices:[],features:[]},this},o.prototype.addVertex=function(t){var e=this._IDPool.vertices.length?this._IDPool.vertices.pop():this.vertices.length;this.vertices[e]=t,this.lastVertexIndex=e,this.numVertices++},o.prototype.removeVertex=function(t){var e=this.vertices[t];return this.vertices[t]=null,this._IDPool.vertices.push(t),this.numVertices--,e},o.prototype.addFeature=function(t,e,i){var s=this._IDPool.features.length?this._IDPool.features.pop():this.features.length;this.features[s]=m().reset(t,e,i),this.numFeatures++},o.prototype.removeFeature=function(t){var e=this.features[t];this.features[t]=null,this._IDPool.features.push(t),this.numFeatures--,y(e)},o.prototype.getLastVertex=function(){return this.vertices[this.lastVertexIndex]},o.prototype.getFeatureClosestToOrigin=function(){for(var t=1/0,e=null,i=this.features,s=0,r=i.length;r>s;s++){var n=i[s];n&&n.distance<t&&(t=n.distance,e=n)}return e},o.prototype.reshape=function(t){var e,i,s,r,n,o=this.vertices,h=this.getLastVertex().vertex,u=this.features,c=[];for(s=0,n=u.length;n>s;s++)u[s]&&(i=u[s].vertexIndices,e=o[i[0]].vertex,l.dot(u[s].normal,l.subtract(h,e,_))>-.001&&(a(o,c,i[0],i[1]),a(o,c,i[1],i[2]),a(o,c,i[2],i[0]),this.removeFeature(s)));var p=h,d=this.lastVertexIndex;for(r=0,n=c.length;n>r;r++)if(c[r]){var f=c[r][0],m=c[r][1],y=o[f].vertex,v=o[m].vertex,b=l.subtract(y,p,x),I=l.subtract(v,p,w),C=l.cross(b,I,new l);if(C.normalize(),t){var T=l.subtract(t,p,g);l.dot(C,T)>-.001&&C.invert(),this.addFeature(null,C,[d,f,m])}else{var M=l.dot(C,p);0>M&&(C.invert(),M*=-1),this.addFeature(M,C,[d,f,m])}}},o.prototype.simplexContainsOrigin=function(t,e){var i=this.vertices.length,r=this.lastVertexIndex,n=r-1,o=r-2,a=r-3;n=0>n?n+i:n,o=0>o?o+i:o,a=0>a?a+i:a;var h,u,c,p,d,f,m,y,v,g,_,M,E,A=this.vertices[r].vertex,z=this.vertices[n].vertex,R=this.vertices[o].vertex,S=this.vertices[a].vertex,D=l.scale(A,-1,b),O=l.subtract(z,A,x);if(4===i){if(h=l.subtract(R,A,w),u=l.subtract(S,A,I),d=l.cross(O,h,new l),f=l.cross(h,u,new l),m=l.cross(O,u,new l),d.normalize(),f.normalize(),m.normalize(),l.dot(d,u)>0&&d.invert(),l.dot(f,O)>0&&f.invert(),l.dot(m,h)>0&&m.invert(),v=l.dot(d,D),g=l.dot(f,D),_=l.dot(m,D),.001>v&&.001>_&&.001>g)return c=l.subtract(R,z,C),p=l.subtract(S,z,T),y=l.cross(c,p,new l),y.normalize(),l.dot(y,O)<=0&&y.invert(),M=-1*l.dot(y,z),this.addFeature(-v,d,[r,n,o]),this.addFeature(-g,f,[r,o,a]),this.addFeature(-_,m,[r,a,n]),this.addFeature(-M,y,[n,o,a]),!0;v>=.001?(E=this.removeVertex(a),t.copy(d)):g>=.001?(E=this.removeVertex(n),t.copy(f)):(E=this.removeVertex(o),t.copy(m))}else 3===i?(h=l.subtract(R,A,w),l.cross(O,h,t),l.dot(t,D)<=0&&t.invert()):t.copy(s(O,D,O));return E&&e&&e(E),!1},e.exports={DynamicGeometry:o,ConvexHull:h}},{"../math/Mat33":26,"../math/Vec3":29,"../utilities/ObjectManager":69}],34:[function(t,e,i){"use strict";function s(t){this.events=new p,t=t||{},this.bodies=[],this.forces=[],this.constraints=[],this.step=t.step||1e3/60,this.iterations=t.iterations||10,this._indexPools={bodies:[],forces:[],constraints:[]},this._entityMaps={bodies:{},forces:{},constraints:{}},this.speed=t.speed||1,this.time=0,this.delta=0,this.origin=t.origin||new l,this.orientation=t.orientation?t.orientation.normalize():new d,this.frameDependent=t.frameDependent||!1,this.transformBuffers={position:[0,0,0],rotation:[0,0,0,1]}}function r(t,e,i){var s=t._entityMaps[i];if(null==s[e._ID]){var r=t[i],n=t._indexPools[i];n.length?s[e._ID]=n.pop():s[e._ID]=r.length,r[s[e._ID]]=e}}function n(t,e,i){var s=t._entityMaps[i],r=s[e._ID];null!=r&&(t._indexPools[i].push(r),t[i][r]=null,s[e._ID]=null)}function o(t,e){t.momentum.add(l.scale(t.force,e,y)),t.angularMomentum.add(l.scale(t.torque,e,y)),l.scale(t.momentum,t.inverseMass,t.velocity),t.inverseInertia.vectorMultiply(t.angularMomentum,t.angularVelocity),t.force.clear(),t.torque.clear()}function a(t,e){if(0!==t.restrictions){var i=t.restrictions,s=null,r=null,n=null,o=null,a=null,h=null;32&i&&(s=0),16&i&&(r=0),8&i&&(n=0),4&i&&(o=0),2&i&&(a=0),1&i&&(h=0),(null!==s||null!==r||null!==n)&&t.setVelocity(s,r,n),(null!==o||null!==a||null!==h)&&t.setAngularVelocity(o,a,h)}t.position.add(l.scale(t.velocity,e,y));var u=t.angularVelocity,c=t.orientation,p=u.x,d=u.y,f=u.z,m=c.w,v=c.x,g=c.y,_=c.z,b=.5*e;c.w+=(-p*v-d*g-f*_)*b,c.x+=(p*m+d*_-f*g)*b,c.y+=(d*m+f*v-p*_)*b,c.z+=(f*m+p*g-d*v)*b,c.normalize(),t.updateInertia()}var h=t("./bodies/Particle"),u=t("./constraints/Constraint"),c=t("./forces/Force"),p=t("../utilities/CallbackStore"),l=t("../math/Vec3"),d=t("../math/Quaternion"),f=new l,m=new d,y=new l;s.prototype.on=function(t,e){return this.events.on(t,e),this},s.prototype.off=function(t,e){return this.events.off(t,e),this},s.prototype.trigger=function(t,e){return this.events.trigger(t,e),this},s.prototype.setOrigin=function(t,e,i){return this.origin.set(t,e,i),this},s.prototype.setOrientation=function(t,e,i,s){return this.orientation.set(t,e,i,s).normalize(),this},s.prototype.add=function(){for(var t=0,e=arguments.length;e>t;t++){var i=arguments[t];if(i instanceof Array)for(var s=0,r=i.length;r>s;s++){var n=i[s];this.add(n)}else i instanceof h?this.addBody(i):i instanceof u?this.addConstraint(i):i instanceof c&&this.addForce(i)}return this},s.prototype.remove=function(){for(var t=0,e=arguments.length;e>t;t++){var i=arguments[t];if(i instanceof Array)for(var s=0,r=i.length;r>s;s++){var n=i[s];this.add(n)}else i instanceof h?this.removeBody(i):i instanceof u?this.removeConstraint(i):i instanceof c&&this.removeForce(i)}return this},s.prototype.addBody=function(t){r(this,t,"bodies")},s.prototype.addForce=function(t){r(this,t,"forces")},s.prototype.addConstraint=function(t){r(this,t,"constraints")},s.prototype.removeBody=function(t){n(this,t,"bodies")},s.prototype.removeForce=function(t){n(this,t,"forces")},s.prototype.removeConstraint=function(t){n(this,t,"constraints")},s.prototype.update=function(t){0===this.time&&(this.time=t);var e=this.bodies,i=this.forces,s=this.constraints,r=this.frameDependent,n=this.step,h=.001*n,u=this.speed,c=this.delta;c+=(t-this.time)*u,this.time=t;for(var p,l,d,f,m;c>n;){for(this.events.trigger("prestep",t),p=0,l=i.length;l>p;p++)d=i[p],null!==d&&d.update(t,h);for(p=0,l=e.length;l>p;p++)f=e[p],null!==f&&o(f,h);for(p=0,l=s.length;l>p;p++)m=s[p],null!==m&&m.update(t,h);for(var y=0,v=this.iterations;v>y;y++)for(p=0,l=s.length;l>p;p++)m=s[p],null!==m&&m.resolve(t,h);for(p=0,l=e.length;l>p;p++)f=e[p],null!==f&&a(f,h);this.events.trigger("poststep",t),r?c=0:c-=n}this.delta=c},s.prototype.getTransform=function(t){var e=this.origin,i=this.orientation,s=this.transformBuffers,r=t.position,n=t.orientation,o=n,a=r;return 1!==i.w&&(o=d.multiply(n,i,m),a=i.rotateVector(r,f)),s.position[0]=e.x+a.x,s.position[1]=e.y+a.y,s.position[2]=e.z+a.z,s.rotation[0]=o.x,s.rotation[1]=o.y,s.rotation[2]=o.z,s.rotation[3]=o.w,s},e.exports=s},{"../math/Quaternion":27,"../math/Vec3":29,"../utilities/CallbackStore":68,"./bodies/Particle":36,"./constraints/Constraint":43,"./forces/Force":54}],35:[function(t,e,i){"use strict";function s(t){o.call(this,t),this.normals=[new r(0,1,0),new r(1,0,0),new r(0,0,1)],this.type=2}var r=t("../../math/Vec3"),n=t("./convexBodyFactory"),o=n([new r(-100,-100,-100),new r(100,-100,-100),new r(-100,-100,100),new r(100,-100,100),new r(-100,100,-100),new r(100,100,-100),new r(-100,100,100),new r(100,100,100)]);s.prototype=Object.create(o.prototype),s.prototype.constructor=s,e.exports=s},{"../../math/Vec3":29,"./convexBodyFactory":39}],36:[function(t,e,i){"use strict";function s(t){this.events=new a,t=t||{},this.position=t.position||new r,this.orientation=t.orientation||new n,this.velocity=new r,this.momentum=new r,this.angularVelocity=new r,this.angularMomentum=new r,this.mass=t.mass||1,this.inverseMass=1/this.mass,this.force=new r,this.torque=new r,this.restitution=null!=t.restitution?t.restitution:.4,this.friction=null!=t.friction?t.friction:.2,this.inverseInertia=new o([0,0,0,0,0,0,0,0,0]),this.localInertia=new o([0,0,0,0,0,0,0,0,0]),this.localInverseInertia=new o([0,0,0,0,0,0,0,0,0]),this.size=t.size||[0,0,0];var e=t.velocity;e&&this.setVelocity(e.x,e.y,e.z),this.restrictions=0,this.setRestrictions.apply(this,t.restrictions||[]),this.collisionMask=t.collisionMask||1,this.collisionGroup=t.collisionGroup||1,this.type=1,this._ID=c++}var r=t("../../math/Vec3"),n=t("../../math/Quaternion"),o=t("../../math/Mat33"),a=t("../../utilities/CallbackStore"),h=new r,u=new o,c=0;s.prototype.on=function(t,e){return this.events.on(t,e),this},s.prototype.off=function(t,e){return this.events.off(t,e),this},s.prototype.trigger=function(t,e){return this.events.trigger(t,e),this},s.prototype.getRestrictions=function(){var t="",e="",i=this.restrictions;return 32&i&&(t+="x"),16&i&&(t+="y"),8&i&&(t+="z"),4&i&&(e+="x"),2&i&&(e+="y"),1&i&&(e+="z"),[t,e]},s.prototype.setRestrictions=function(t,e){return t=t||"",e=e||"",this.restrictions=0,t.indexOf("x")>-1&&(this.restrictions|=32),t.indexOf("y")>-1&&(this.restrictions|=16),t.indexOf("z")>-1&&(this.restrictions|=8),e.indexOf("x")>-1&&(this.restrictions|=4),e.indexOf("y")>-1&&(this.restrictions|=2),e.indexOf("z")>-1&&(this.restrictions|=1),this},s.prototype.getMass=function(){return this.mass},s.prototype.setMass=function(t){return this.mass=t,this.inverseMass=1/t,this},s.prototype.getInverseMass=function(){return this.inverseMass},s.prototype.updateLocalInertia=function(){return this.localInertia.set([0,0,0,0,0,0,0,0,0]),this.localInverseInertia.set([0,0,0,0,0,0,0,0,0]),this},s.prototype.updateInertia=function(){var t=this.localInverseInertia,e=this.orientation;if(t[0]===t[4]&&t[4]===t[8]||1===e.w)return this;var i=e.toMatrix(u);return o.multiply(i,this.inverseInertia,this.inverseInertia),o.multiply(this.localInverseInertia,i.transpose(),this.inverseInertia),this},s.prototype.getPosition=function(){return this.position},s.prototype.setPosition=function(t,e,i){return this.position.set(t,e,i),this},s.prototype.getVelocity=function(){return this.velocity},s.prototype.setVelocity=function(t,e,i){return this.velocity.set(t,e,i),r.scale(this.velocity,this.mass,this.momentum),this},s.prototype.getMomentum=function(){return this.momentum},s.prototype.setMomentum=function(t,e,i){return this.momentum.set(t,e,i),r.scale(this.momentum,this.inverseMass,this.velocity),this},s.prototype.getOrientation=function(){return this.orientation},s.prototype.setOrientation=function(t,e,i,s){return this.orientation.set(t,e,i,s).normalize(),this.updateInertia(),this},s.prototype.getAngularVelocity=function(){return this.angularVelocity},s.prototype.setAngularVelocity=function(t,e,i){this.angularVelocity.set(t,e,i);var s=o.inverse(this.inverseInertia,u);return s?s.vectorMultiply(this.angularVelocity,this.angularMomentum):this.angularMomentum.clear(),this},s.prototype.getAngularMomentum=function(){return this.angularMomentum},s.prototype.setAngularMomentum=function(t,e,i){return this.angularMomentum.set(t,e,i),this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity),this},s.prototype.getForce=function(){return this.force},s.prototype.setForce=function(t,e,i){return this.force.set(t,e,i),this},s.prototype.getTorque=function(){return this.torque},s.prototype.setTorque=function(t,e,i){return this.torque.set(t,e,i),this},s.prototype.applyForce=function(t){return this.force.add(t),this},s.prototype.applyTorque=function(t){return this.torque.add(t),this},s.prototype.applyImpulse=function(t){return this.momentum.add(t),r.scale(this.momentum,this.inverseMass,this.velocity),this},s.prototype.applyAngularImpulse=function(t){return this.angularMomentum.add(t),this.inverseInertia.vectorMultiply(this.angularMomentum,this.angularVelocity),this},s.prototype.support=function(){return h},s.prototype.updateShape=function(){},e.exports=s},{"../../math/Mat33":26,"../../math/Quaternion":27,"../../math/Vec3":29,"../../utilities/CallbackStore":68}],37:[function(t,e,i){"use strict";function s(t){r.call(this,t);var e=t.radius||1;this.radius=e,this.size=[2*e,2*e,2*e],this.updateLocalInertia(),this.inverseInertia.copy(this.localInverseInertia);var i=t.angularVelocity;i&&this.setAngularVelocity(i.x,i.y,i.z),this.type=4}var r=t("./Particle"),n=t("../../math/Vec3"),o=new n;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.getRadius=function(){return this.radius},s.prototype.setRadius=function(t){return this.radius=t,this.size=[2*this.radius,2*this.radius,2*this.radius],this},s.prototype.updateLocalInertia=function(){var t=this.mass,e=this.radius,i=t*e*e;this.localInertia.set([.4*i,0,0,0,.4*i,0,0,0,.4*i]),this.localInverseInertia.set([2.5/i,0,0,0,2.5/i,0,0,0,2.5/i])},s.prototype.support=function(t){return n.scale(t,this.radius,o)},e.exports=s},{"../../math/Vec3":29,"./Particle":36}],38:[function(t,e,i){"use strict";function s(t){r.call(this,t);var e=this.normal=new n,i=this.direction=t.direction;switch(i){case s.DOWN:e.set(0,1,0);break;case s.UP:e.set(0,-1,0);break;case s.LEFT:e.set(-1,0,0);break;case s.RIGHT:e.set(1,0,0);break;case s.FORWARD:e.set(0,0,-1);break;case s.BACKWARD:e.set(0,0,1)}this.invNormal=n.clone(e,new n).invert(),this.mass=1/0,this.inverseMass=0,this.type=8}var r=t("./Particle"),n=t("../../math/Vec3");s.DOWN=0,s.UP=1,s.LEFT=2,s.RIGHT=3,s.FORWARD=4,s.BACKWARD=5,s.prototype=Object.create(r.prototype),s.prototype.constructor=s,e.exports=s},{"../../math/Vec3":29,"./Particle":36}],39:[function(t,e,i){"use strict";function s(t){function e(e){n.call(this,e);var i=t.polyhedralProperties.size,s=e.size||i,h=s[0]/i[0],u=s[1]/i[1],c=s[2]/i[2];this._scale=[h,u,c];var p=new o([h,0,0,0,u,0,0,0,c]);this.hull=t,this.vertices=[];for(var l=0,d=t.vertices.length;d>l;l++)this.vertices.push(p.vectorMultiply(t.vertices[l],new a));r.call(this,p),this.inverseInertia.copy(this.localInverseInertia),this.updateInertia();var f=e.angularVelocity;f&&this.setAngularVelocity(f.x,f.y,f.z)}if(!(t instanceof u)){if(!(t instanceof Array))throw new Error("convexBodyFactory requires a ConvexHull object or an array of Vec3's as input.");t=new u(t)}return e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.setSize=function(e,i,s){var r=t.polyhedralProperties.size;this.size[0]=e,this.size[1]=i,this.size[2]=s;var n=e/r[0],a=i/r[1],h=s/r[2];this._scale=[n,a,h];for(var u=new o([n,0,0,0,a,0,0,0,h]),c=this.vertices,p=0,l=t.vertices.length;l>p;p++)u.vectorMultiply(t.vertices[p],c[p]);return this},e.prototype.updateLocalInertia=function(){var t=this._scale[0],e=this._scale[1],i=this._scale[2],s=new o([t,0,0,0,e,0,0,0,i]);return r.call(this,s),this},e.prototype.support=function(t){for(var e,i,s,r=this.vertices,n=-(1/0),o=0,h=r.length;h>o;o++)e=r[o],i=a.dot(e,t),i>n&&(s=e,n=i);return s},e.prototype.updateShape=function(){for(var t=this.vertices,e=this.orientation,i=this.hull.vertices,s=this._scale[0],r=this._scale[1],n=this._scale[2],o=c,h=0,u=t.length;u>h;h++)o.copy(i[h]),o.x*=s,o.y*=r,o.z*=n,a.applyRotation(o,e,t[h]);return this},e}function r(t){var e=this.hull.polyhedralProperties,i=t.get(),s=i[0]*i[4]*i[8],r=e.eulerTensor,n=new o;o.multiply(t,r,n),o.multiply(n,t,n);var a=n.get(),h=a[0],u=a[4],c=a[8],p=a[1],l=a[7],d=a[2],f=e.volume*s,m=this.mass,y=m/f,v=u+c,g=h+c,_=h+u,b=-p,x=-l,w=-d,I=e.centroid;v-=f*(I.y*I.y+I.z*I.z),g-=f*(I.z*I.z+I.x*I.x),_-=f*(I.x*I.x+I.y*I.y),b+=f*I.x*I.y,x+=f*I.y*I.z,w+=f*I.z*I.x,v*=y*s,g*=y*s,_*=y*s,b*=y*s,x*=y*s,w*=y*s;var C=[v,b,w,b,g,x,w,x,_];this.localInertia.set(C),o.inverse(this.localInertia,this.localInverseInertia)}var n=t("./Particle"),o=t("../../math/Mat33"),a=t("../../math/Vec3"),h=t("../Geometry"),u=h.ConvexHull,c=new a;e.exports=s},{"../../math/Mat33":26,"../../math/Vec3":29,"../Geometry":33,"./Particle":36}],40:[function(t,e,i){"use strict";function s(t,e,i){this.a=t,this.b=e,r.call(this,i),this.effectiveInertia=new o,this.angularImpulse=new n,this.error=0}var r=t("./Constraint"),n=t("../../math/Vec3"),o=t("../../math/Mat33"),a=new n;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.cosAngle=this.cosAngle||this.a.orientation.dot(this.b.orientation)},s.prototype.update=function(){var t=this.a,e=this.b,i=t.orientation,s=e.orientation,r=i.dot(s),n=2*(r-this.cosAngle);this.error=n;var a=this.angularImpulse;e.applyAngularImpulse(a),t.applyAngularImpulse(a.invert()),o.add(t.inverseInertia,e.inverseInertia,this.effectiveInertia),this.effectiveInertia.inverse(),a.clear()},s.prototype.resolve=function(){var t=this.a,e=this.b,i=a,s=t.angularVelocity,r=e.angularVelocity;n.subtract(s,r,i),i.scale(1+this.error);var o=i.applyMatrix(this.effectiveInertia);e.applyAngularImpulse(o),t.applyAngularImpulse(o.invert()),o.invert(),this.angularImpulse.add(o)},e.exports=s},{"../../math/Mat33":26,"../../math/Vec3":29,"./Constraint":43}],41:[function(t,e,i){"use strict";function s(t,e,i){this.a=t,this.b=e,r.call(this,i),this.impulse=new n,this.angImpulseA=new n,this.angImpulseB=new n,this.error=new n,this.effMassMatrix=new o}var r=t("./Constraint"),n=t("../../math/Vec3"),o=t("../../math/Mat33"),a=t("../../math/Quaternion"),h=new n,u=new n,c=new n,p=new n,l=new n;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.init=function(){var t=this.anchor,e=this.a,i=this.b,s=a.conjugate(e.orientation,new a),r=a.conjugate(i.orientation,new a);this.rA=n.subtract(t,e.position,new n),this.rB=n.subtract(t,i.position,new n),this.bodyRA=s.rotateVector(this.rA,new n),this.bodyRB=r.rotateVector(this.rB,new n)},s.prototype.update=function(t,e){var i=this.a,s=this.b,r=i.orientation.rotateVector(this.bodyRA,this.rA),a=s.orientation.rotateVector(this.bodyRB,this.rB),h=new o([0,r.z,-r.y,-r.z,0,r.x,r.y,-r.x,0]),c=new o([0,a.z,-a.y,-a.z,0,a.x,a.y,-a.x,0]),p=o.multiply(h,i.inverseInertia,new o).multiply(h.transpose()),l=o.multiply(c,s.inverseInertia,new o).multiply(c.transpose()),d=o.add(p,l,p),f=n.add(i.position,this.rA,this.anchor),m=n.add(s.position,this.rB,u);n.subtract(m,f,this.error),this.error.scale(.2/e);var y=i.inverseMass,v=s.inverseMass,g=new o([y+v,0,0,0,y+v,0,0,0,y+v]);o.add(d,g,this.effMassMatrix),this.effMassMatrix.inverse();var _=this.impulse,b=this.angImpulseA,x=this.angImpulseB;s.applyImpulse(_),s.applyAngularImpulse(x),_.invert(),i.applyImpulse(_),i.applyAngularImpulse(b),_.clear(),b.clear(),x.clear()},s.prototype.resolve=function(){var t=this.a,e=this.b,i=this.rA,s=this.rB,r=n.add(t.velocity,n.cross(t.angularVelocity,i,l),c),o=n.add(e.velocity,n.cross(e.angularVelocity,s,l),p),a=r.subtract(o).subtract(this.error).applyMatrix(this.effMassMatrix),d=n.cross(s,a,h),f=n.cross(i,a,u).invert();e.applyImpulse(a),e.applyAngularImpulse(d),a.invert(),t.applyImpulse(a),t.applyAngularImpulse(f),a.invert(),this.impulse.add(a),this.angImpulseA.add(f),this.angImpulseB.add(d)},e.exports=s},{"../../math/Mat33":26,"../../math/Quaternion":27,"../../math/Vec3":29,"./Constraint":43}],42:[function(t,e,i){"use strict";function s(t,e,i){return e>t?e:t>i?i:t}function r(t,e,i,s,r,n){this.penetration=t,this.normal=e,this.worldContactA=i,this.worldContactB=s,this.localContactA=r,this.localContactB=n}function n(t,e){this.targets=[],t&&(this.targets=this.targets.concat(t)),p.call(this,e)}function o(t,e,i){var s=e.position,r=i.position,n=c.subtract(r,s,new c),o=n.length(),a=e.radius+i.radius,h=n.scale(1/o),u=a-o;if(!(0>u)){var p=c.scale(h,e.radius,new c),l=c.scale(h,-i.radius,new c),d=c.add(s,p,new c),f=c.add(r,l,new c),m=_().reset(u,h,d,f,p,l);t.contactManifoldTable.registerContact(e,i,m)}}function a(t,e,i){if(e.type===I){var r=i;i=e,e=r}var n=e.position,o=i.position,a=c.subtract(o,n,b),h=e.orientation,u=i.radius,p=e.size,l=.5*p[0],d=.5*p[1],f=.5*p[2],m=e.normals,y=h.rotateVector(m[1],new c),v=h.rotateVector(m[0],new c),g=h.rotateVector(m[2],new c),x=new c;x.x=s(c.dot(a,y),-l,l),x.y=s(c.dot(a,v),-d,d),x.z=s(c.dot(a,g),-f,f),x.applyRotation(h);var w=c.add(n,x,new c),C=c.subtract(w,o,w),T=C.length(),M=u-T;if(!(0>M)){var E=c.scale(C,-1/T,new c),A=x,z=C,R=c.add(n,A,new c),S=c.add(o,z,new c),D=_().reset(M,E,R,S,A,z);t.contactManifoldTable.registerContact(e,i,D)}}function h(t,e,i){var s=m(e,i);if(s){var r=y(e,i,s);null!==r&&t.contactManifoldTable.registerContact(e,i,r)}}function u(t,e,i){if(e.type===C){var s=i;i=e,e=s}var r=e.position,n=i.position,o=i.normal,a=i.invNormal,h=e.support(a),u=c.add(r,h,new c),p=c.subtract(u,n,b),l=c.dot(p,a);if(!(0>l)){var d=c.scale(o,l,new c).add(u),f=c.subtract(d,i.position,new c),m=_().reset(l,a,u,d,h,f);t.contactManifoldTable.registerContact(e,i,m)}}var c=t("../../math/Vec3"),p=t("./Constraint"),l=t("./collision/SweepAndPrune"),d=t("./collision/BruteForce"),f=t("./collision/ConvexCollisionDetection"),m=f.gjk,y=f.epa,v=t("./collision/ContactManifold"),g=t("../../utilities/ObjectManager");g.register("CollisionData",r);var _=g.requestCollisionData,b=new c;r.prototype.reset=function(t,e,i,s,r,n){return this.penetration=t,this.normal=e,this.worldContactA=i,this.worldContactB=s,this.localContactA=r,this.localContactB=n,this},n.prototype=Object.create(p.prototype),n.prototype.constructor=n,n.prototype.init=function(){if(this.broadPhase){var t=this.broadphase;t instanceof Function&&(this.broadPhase=new t(this.targets))}else this.broadPhase=new l(this.targets);this.contactManifoldTable=this.contactManifoldTable||new v},n.prototype.update=function(t,e){if(this.contactManifoldTable.update(e),0!==this.targets.length){var i,s;for(i=0,s=this.targets.length;s>i;i++)this.targets[i].updateShape();var r,n=this.broadPhase.update();for(i=0,s=n.length;s>i;i++)r=n[i],r&&this.applyNarrowPhase(r);this.contactManifoldTable.prepContacts(e)}},n.prototype.resolve=function(t,e){this.contactManifoldTable.resolveManifolds(e)},n.prototype.addTarget=function(t){this.targets.push(t),this.broadPhase.add(t)},n.prototype.removeTarget=function(t){var e=this.targets.indexOf(t);0>e||(this.targets.splice(e,1),this.broadPhase.remove(t))};var x=1,w=2,I=4,C=8,T=x|x,M=w|w,E=w|x,A=I|I,z=w|I,R=x|I,S=x|C,D=w|C,O=I|C,P={};P[T]=h,P[M]=h,P[E]=h,P[R]=h,P[A]=o,P[z]=a,P[S]=u,P[D]=u,P[O]=u,n.prototype.applyNarrowPhase=function(t){for(var e=0,i=t.length;i>e;e++)for(var s=e+1;i>s;s++){var r=t[e],n=t[s];if(0!==(r.collisionMask&n.collisionGroup&&r.collisionGroup&n.collisionMask)){var o=r.type|n.type;P[o]&&P[o](this,r,n)}}},n.SweepAndPrune=l,n.BruteForce=d.BruteForce,n.BruteForceAABB=d.BruteForceAABB,e.exports=n},{"../../math/Vec3":29,"../../utilities/ObjectManager":69,"./Constraint":43,"./collision/BruteForce":49,"./collision/ContactManifold":50,"./collision/ConvexCollisionDetection":51,"./collision/SweepAndPrune":52}],43:[function(t,e,i){"use strict";function s(t){t=t||{},this.setOptions(t),this._ID=r++}var r=0;s.prototype.setOptions=function(t){for(var e in t)this[e]=t[e];this.init(t)},s.prototype.init=function(t){},s.prototype.update=function(t,e){},s.prototype.resolve=function(t,e){},e.exports=s},{}],44:[function(t,e,i){"use strict";function s(t,e){t?t instanceof Array?this.targets=t:this.targets=[t]:this.targets=[],r.call(this,e),this.impulses={},this.normals={},this.velocityBiases={},this.divisors={}}var r=t("./Constraint"),n=t("../../math/Vec3"),o=new n,a=new n,h=1e-7,u=Math.PI;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.equation1=this.equation1||function(){return 0},this.equation2=this.equation2||function(t,e,i){return i},this.period=this.period||1,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*u*u/(this.period*this.period),this.damping=4*u*this.dampingRatio/this.period},s.prototype.update=function(t,e){for(var i=this.targets,s=this.normals,r=this.velocityBiases,u=this.divisors,c=this.impulses,p=o,l=a,d=this.equation1,f=this.equation2,m=this.damping,y=this.stiffness,v=0,g=i.length;g>v;v++){var _=i[v],b=_._ID;if(!_.immune){var x,w,I=_.position,C=_.mass;if(0===this.period)x=0,w=1;else{var T=m*C,M=y*C;x=1/(e*(T+e*M)),w=e*M/(T+e*M)}var E=I.x,A=I.y,z=I.z,R=d(E,A,z),S=(d(E+h,A,z)-R)/h,D=(d(E,A+h,z)-R)/h,O=(d(E,A,z+h)-R)/h,P=f(E,A,z),L=(f(E+h,A,z)-P)/h,V=(f(E,A+h,z)-P)/h,U=(f(E,A,z+h)-P)/h;l.set(S+L,D+V,O+U),l.normalize();var F=w*(R+P)/e,k=x+1/C,G=c[b]||0;n.scale(l,G,p),_.applyImpulse(p),s[b]=s[b]||new n,s[b].copy(l),r[b]=F,u[b]=k,c[b]=0}}},s.prototype.resolve=function(){for(var t=this.targets,e=this.normals,i=this.velocityBiases,s=this.divisors,r=this.impulses,a=o,h=0,u=t.length;u>h;h++){var c=t[h],p=c._ID;if(!c.immune){var l=c.velocity,d=e[p],f=-(n.dot(d,l)+i[p])/s[p];n.scale(d,f,a),c.applyImpulse(a),r[p]+=f}}},e.exports=s},{"../../math/Vec3":29,"./Constraint":43}],45:[function(t,e,i){"use strict";function s(t,e,i){this.a=t,this.b=e,r.call(this,i),this.impulse=0,this.distance=0,this.normal=new n,this.velocityBias=0,this.divisor=0}var r=t("./Constraint"),n=t("../../math/Vec3"),o=new n,a=new n,h=new n,u=new n,c=new n,p=Math.PI;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.direction=this.direction||n.subtract(this.b.position,this.a.position,new n),this.direction.normalize(),this.minLength=this.minLength||0,this.period=this.period||.2,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*p*p/(this.period*this.period),this.damping=4*p*this.dampingRatio/this.period},s.prototype.update=function(t,e){var i=this.a,s=this.b,r=o,h=u,p=a,l=c,d=i.position,f=i.inverseMass,m=s.position,y=s.inverseMass,v=this.direction;n.subtract(m,d,h),n.scale(v,n.dot(v,h),l);var g=l.add(d);n.subtract(m,g,r);var _=r.length();r.normalize();var b,x,w=f+y,I=1/w;if(0===this.period)b=0,x=1;else{var C=this.damping*I,T=this.stiffness*I;b=1/(e*(C+e*T)),x=e*T/(C+e*T)}var M=x*_/e,E=b+w,A=this.impulse;n.scale(r,A,p),s.applyImpulse(p),i.applyImpulse(p.invert()),this.normal.copy(r),this.distance=_,this.velocityBias=M,this.divisor=E,this.impulse=0},s.prototype.resolve=function(){var t=this.a,e=this.b,i=a,s=h,r=this.minLength,o=this.distance;if(!(Math.abs(o)<r)){var u=t.velocity,c=e.velocity,p=this.normal;n.subtract(c,u,s);var l=-(n.dot(p,s)+this.velocityBias)/this.divisor;n.scale(p,l,i),e.applyImpulse(i),t.applyImpulse(i.invert()),this.impulse+=l}},e.exports=s},{"../../math/Vec3":29,"./Constraint":43}],46:[function(t,e,i){
"use strict";function s(t,e,i){this.a=t,this.b=e,r.call(this,i),this.impulse=0,this.distance=0,this.normal=new n,this.velocityBias=0,this.divisor=0}var r=t("./Constraint"),n=t("../../math/Vec3"),o=new n,a=new n,h=new n,u=new n,c=Math.PI;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.length=this.length||n.subtract(this.b.position,this.a.position,u).length(),this.minLength=this.minLength||0,this.period=this.period||.2,this.dampingRatio=this.dampingRatio||.5,this.stiffness=4*c*c/(this.period*this.period),this.damping=4*c*this.dampingRatio/this.period},s.prototype.update=function(t,e){var i=this.a,s=this.b,r=o,h=u,c=a,p=this.length,l=i.position,d=i.inverseMass,f=s.position,m=s.inverseMass;n.subtract(f,l,h);var y=h.length();n.scale(h,1/y,r);var v,g,_=y-p,b=d+m,x=1/b;if(0===this.period)v=0,g=1;else{var w=this.damping*x,I=this.stiffness*x;v=1/(e*(w+e*I)),g=e*I/(w+e*I)}var C=g*_/e,T=v+b,M=this.impulse;n.scale(r,M,c),s.applyImpulse(c),i.applyImpulse(c.invert()),this.normal.copy(r),this.distance=_,this.velocityBias=C,this.divisor=T,this.impulse=0},s.prototype.resolve=function(){var t=this.a,e=this.b,i=a,s=h,r=this.minLength,o=this.distance;if(!(Math.abs(o)<r)){var u=t.getVelocity(),c=e.getVelocity(),p=this.normal;n.subtract(c,u,s);var l=-(n.dot(p,s)+this.velocityBias)/this.divisor;n.scale(p,l,i),e.applyImpulse(i),t.applyImpulse(i.invert()),this.impulse+=l}},e.exports=s},{"../../math/Vec3":29,"./Constraint":43}],47:[function(t,e,i){"use strict";function s(t,e,i){this.a=t,this.b=e,r.call(this,i),this.impulse=new n,this.angImpulseA=new n,this.angImpulseB=new n,this.error=new n,this.errorRot=[0,0],this.effMassMatrix=new o,this.effMassMatrixRot=[]}var r=t("./Constraint"),n=t("../../math/Vec3"),o=t("../../math/Mat33"),a=t("../../math/Quaternion"),h=new n,u=new n,c=new n,p=new n,l=new n,d=new n,f=new n,m=new n;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.init=function(){var t=this.anchor,e=this.axis.normalize(),i=this.a,s=this.b,r=a.conjugate(i.orientation,new a),o=a.conjugate(s.orientation,new a);this.rA=n.subtract(t,i.position,new n),this.rB=n.subtract(t,s.position,new n),this.bodyRA=r.rotateVector(this.rA,new n),this.bodyRB=o.rotateVector(this.rB,new n),this.axisA=n.clone(e),this.axisB=n.clone(e),this.axisBTangent1=new n,this.axisBTangent2=new n,this.t1xA=new n,this.t2xA=new n,this.bodyAxisA=r.rotateVector(e,new n),this.bodyAxisB=o.rotateVector(e,new n)},s.prototype.update=function(t,e){var i=this.a,s=this.b,r=i.orientation.rotateVector(this.bodyAxisA,this.axisA),a=s.orientation.rotateVector(this.bodyAxisB,this.axisB);this.axis.copy(a);var l=a,d=this.axisBTangent1,f=this.axisBTangent2;l.x>=.57735?d.set(l.y,-l.x,0):d.set(0,l.z,-l.y),d.normalize(),n.cross(l,d,f);var m=n.cross(d,r,this.t1xA),y=n.cross(f,r,this.t2xA),v=i.orientation.rotateVector(this.bodyRA,this.rA),g=s.orientation.rotateVector(this.bodyRB,this.rB),_=new o([0,v.z,-v.y,-v.z,0,v.x,v.y,-v.x,0]),b=new o([0,g.z,-g.y,-g.z,0,g.x,g.y,-g.x,0]),x=o.multiply(_,i.inverseInertia,new o).multiply(_.transpose()),w=o.multiply(b,s.inverseInertia,new o).multiply(b.transpose()),I=o.add(x,w,x),C=n.add(i.position,this.rA,this.anchor),T=n.add(s.position,this.rB,h),M=1/e;n.subtract(T,C,this.error),this.error.scale(.2*M);var E=i.inverseMass,A=s.inverseMass,z=new o([E+A,0,0,0,E+A,0,0,0,E+A]);o.add(I,z,this.effMassMatrix),this.effMassMatrix.inverse();var R=i.inverseInertia.vectorMultiply(m,h),S=i.inverseInertia.vectorMultiply(y,u),D=s.inverseInertia.vectorMultiply(m,c),O=s.inverseInertia.vectorMultiply(y,p),P=n.dot(m,R)+n.dot(m,D),L=n.dot(m,S)+n.dot(m,O),V=n.dot(y,R)+n.dot(y,D),U=n.dot(y,S)+n.dot(y,O),F=1/(P*U-L*V);this.effMassMatrixRot[0]=U*F,this.effMassMatrixRot[1]=-V*F,this.effMassMatrixRot[2]=-L*F,this.effMassMatrixRot[3]=P*F,this.errorRot[0]=.2*n.dot(r,d)*M,this.errorRot[1]=.2*n.dot(r,f)*M;var k=this.impulse.scale(.5),G=this.angImpulseA.scale(.5),B=this.angImpulseB.scale(.5);s.applyImpulse(k),s.applyAngularImpulse(B),k.invert(),i.applyImpulse(k),i.applyAngularImpulse(G),k.clear(),G.clear(),B.clear()},s.prototype.resolve=function(){var t=this.a,e=this.b,i=this.rA,s=this.rB,r=this.t1xA,o=this.t2xA,a=t.angularVelocity,y=e.angularVelocity,v=n.add(t.velocity,n.cross(a,i,f),l),g=n.add(e.velocity,n.cross(y,s,f),d),_=v.subtract(g).subtract(this.error).applyMatrix(this.effMassMatrix),b=n.subtract(y,a,m),x=this.errorRot,w=n.dot(r,b)+x[0],I=n.dot(o,b)+x[1],C=this.effMassMatrixRot,T=-(C[0]*w+C[1]*I),M=-(C[2]*w+C[3]*I),E=n.scale(r,T,u).add(n.scale(o,M,c)),A=n.cross(s,_,h).add(E),z=n.cross(i,_,p).invert().subtract(E);e.applyImpulse(_),e.applyAngularImpulse(A),_.invert(),t.applyImpulse(_),t.applyAngularImpulse(z),_.invert(),this.impulse.add(_),this.angImpulseA.add(z),this.angImpulseB.add(A)},e.exports=s},{"../../math/Mat33":26,"../../math/Quaternion":27,"../../math/Vec3":29,"./Constraint":43}],48:[function(t,e,i){"use strict";function s(t){this._body=t,this._ID=t._ID,this.position=null,this.vertices={x:[],y:[],z:[]},this.update()}var r=4,n=8,o=0,a=1,h=2,u=3,c=4,p=5;s.prototype.update=function(){var t=this._body,e=this.position=t.position,i=1/0,s=-(1/0),l=1/0,d=-(1/0),f=1/0,m=-(1/0),y=t.type;if(y===r)s=d=m=t.radius,i=l=f=-t.radius;else if(y===n){var v=t.direction;switch(s=d=m=1e6,i=l=f=-1e6,v){case o:d=25,l=-1e3;break;case a:d=1e3,l=-25;break;case h:s=25,i=-1e3;break;case u:s=1e3,i=-25;break;case c:m=25,f=-1e3;break;case p:m=1e3,f=-25}}else if(t.vertices)for(var g=t.vertices,_=0,b=g.length;b>_;_++){var x=g[_];x.x<i&&(i=x.x),x.x>s&&(s=x.x),x.y<l&&(l=x.y),x.y>d&&(d=x.y),x.z<f&&(f=x.z),x.z>m&&(m=x.z)}else s=d=m=25,i=l=f=-25;var w=this.vertices;w.x[0]=i+e.x,w.x[1]=s+e.x,w.y[0]=l+e.y,w.y[1]=d+e.y,w.z[0]=f+e.z,w.z[1]=m+e.z},s.checkOverlap=function(t,e){var i=t.vertices,s=e.vertices,r=i.x[0],n=i.x[1],o=s.x[0],a=s.x[1];if(r>=o&&a>=r||o>=r&&n>=o){var h=i.y[0],u=i.y[1],c=s.y[0],p=s.y[1];if(h>=c&&p>=h||c>=h&&u>=c){var l=i.z[0],d=i.z[1],f=s.z[0],m=s.z[1];if(l>=f&&m>=l||f>=l&&d>=f)return!0}}return!1},s.vertexThreshold=100,e.exports=s},{}],49:[function(t,e,i){"use strict";function s(t){this._volumes=[],this._entityRegistry={};for(var e=0;e<t.length;e++)this.add(t[e])}function r(t){this.targets=t}var n=t("./AABB");s.prototype.add=function(t){var e=new n(t);this._entityRegistry[t._ID]=t,this._volumes.push(e)},s.prototype.update=function(){for(var t=this._volumes,e=this._entityRegistry,i=0,s=t.length;s>i;i++)t[i].update();for(var r=[],o=0,a=t.length;a>o;o++)for(var h=o+1;a>h;h++)n.checkOverlap(t[o],t[h])&&r.push([e[o],e[h]]);return r},r.prototype.add=function(t){this.targets.push(t)},r.prototype.update=function(){return[this.targets]},e.exports.BruteForceAABB=s,e.exports.BruteForce=r},{"./AABB":48}],50:[function(t,e,i){"use strict";function s(t,e,i){return e>t?e:t>i?i:t}function r(){this.manifolds=[],this.collisionMatrix={},this._IDPool=[]}function n(t,e,i,s){this.lowID=t,this.highID=e,this.contacts=[],this.numContacts=0,this.bodyA=i,this.bodyB=s,this.lru=0}function o(t,e,i){this.bodyA=t,this.bodyB=e,this.data=i,this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,this.impulse=new a,this.angImpulseA=new a,this.angImpulseB=new a,i&&this.init()}var a=t("../../../math/Vec3"),h=t("../../../utilities/ObjectManager");h.register("Manifold",n),h.register("Contact",o);var u=h.requestManifold,c=h.requestContact,p=h.freeManifold,l=h.freeContact,d=new a,f=new a,m=new a,y=new a,v=new a,g=new a,_=new a,b=new a,x=new a,w=new a,I=new a,C=new a,T=new a,M=new a,E=new a;r.prototype.addManifold=function(t,e,i,s){var r=this.collisionMatrix;r[t]=r[t]||{};var n=this._IDPool.length?this._IDPool.pop():this.manifolds.length;this.collisionMatrix[t][e]=n;var o=u().reset(t,e,i,s);return this.manifolds[n]=o,o},r.prototype.removeManifold=function(t,e){var i=this.collisionMatrix;this.manifolds[e]=null,i[t.lowID][t.highID]=null,this._IDPool.push(e),p(t)},r.prototype.update=function(t){for(var e=this.manifolds,i=0,s=e.length;s>i;i++){var r=e[i];if(r){var n=r.update(t);n||(this.removeManifold(r,i),r.bodyA.events.trigger("collision:end",r),r.bodyB.events.trigger("collision:end",r))}}},r.prototype.prepContacts=function(t){for(var e=this.manifolds,i=0,s=e.length;s>i;i++){var r=e[i];if(r)for(var n=r.contacts,o=0,a=n.length;a>o;o++){var h=n[o];h&&h.update(t)}}},r.prototype.resolveManifolds=function(){for(var t=this.manifolds,e=0,i=t.length;i>e;e++){var s=t[e];s&&s.resolveContacts()}},r.prototype.registerContact=function(t,e,i){var s,r;t._ID<e._ID?(s=t._ID,r=e._ID):(s=e._ID,r=t._ID);var n,o=this.manifolds,a=this.collisionMatrix;a[s]&&null!=a[s][r]?(n=o[a[s][r]],n.contains(i),n.addContact(t,e,i)):(n=this.addManifold(s,r,t,e),n.addContact(t,e,i),t.events.trigger("collision:start",n),e.events.trigger("collision:start",n))};var A=10;n.prototype.reset=function(t,e,i,s){return this.lowID=t,this.highID=e,this.contacts=[],this.numContacts=0,this.bodyA=i,this.bodyB=s,this.lru=0,this},n.prototype.addContact=function(t,e,i){var s=this.lru;this.contacts[s]&&this.removeContact(this.contacts[s],s),this.contacts[s]=c().reset(t,e,i),this.lru=(this.lru+1)%4,this.numContacts++},n.prototype.removeContact=function(t,e){this.contacts[e]=null,this.numContacts--,h.freeCollisionData(t.data),t.data=null,l(t)},n.prototype.contains=function(t){for(var e=t.worldContactA,i=t.worldContactB,s=this.contacts,r=0,n=s.length;n>r;r++){var o=s[r];if(o){var h=o.data,u=a.subtract(h.worldContactA,e,M).length(),c=a.subtract(h.worldContactB,i,E).length();if(A>u||A>c)return this.removeContact(o,r),!0}}return!1},n.prototype.update=function(){for(var t=this.contacts,e=this.bodyA,i=this.bodyB,s=e.position,r=i.position,n=0,o=t.length;o>n;n++){var h=t[n];if(h){var u=h.data,c=u.normal,p=u.localContactA,l=u.localContactB,d=u.worldContactA,f=u.worldContactB,m=a.add(s,p,I),y=a.add(r,l,C),v=a.dot(a.subtract(y,m,T),c)>0,g=a.subtract(d,m,M),_=a.subtract(f,y,E);(g.length()>=A||_.length()>=A||v)&&this.removeContact(h,n)}}return this.numContacts?!0:!1},n.prototype.resolveContacts=function(){for(var t=this.contacts,e=0,i=t.length;i>e;e++)t[e]&&t[e].resolve()},o.prototype.reset=function(t,e,i){return this.bodyA=t,this.bodyB=e,this.data=i,this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,this.impulse.clear(),this.angImpulseA.clear(),this.angImpulseB.clear(),this.init(),this},o.prototype.init=function(){var t=this.data,e=t.normal,i=new a;e.x>=.57735?i.set(e.y,-e.x,0):i.set(0,e.z,-e.y),i.normalize();var s=a.cross(e,i,new a);this.tangent1=i,this.tangent2=s;var r=this.bodyA,n=this.bodyB,o=t.localContactA,h=t.localContactB,u=r.inverseMass+n.inverseMass,c=a.cross(o,e,g),p=a.cross(h,e,_);this.effNormalMass=1/(u+a.dot(c,r.inverseInertia.vectorMultiply(c,d))+a.dot(p,n.inverseInertia.vectorMultiply(p,d)));var l=a.cross(o,i,g),f=a.cross(h,i,_);this.effTangentialMass1=1/(u+a.dot(l,r.inverseInertia.vectorMultiply(l,d))+a.dot(f,n.inverseInertia.vectorMultiply(f,d)));var m=a.cross(o,s,g),y=a.cross(h,s,_);this.effTangentialMass2=1/(u+a.dot(m,r.inverseInertia.vectorMultiply(m,d))+a.dot(y,n.inverseInertia.vectorMultiply(y,d))),this.restitution=Math.min(r.restitution,n.restitution),this.friction=r.friction*n.friction},o.prototype.update=function(t){var e=this.data,i=this.bodyA,s=this.bodyB,r=e.localContactA,n=e.localContactB,o=e.normal,h=a.add(i.velocity,a.cross(i.angularVelocity,r,v),m),u=a.add(s.velocity,a.cross(s.angularVelocity,n,v),y),c=u.subtract(h),p=a.dot(c,o),l=.15,d=1.5,f=20,g=Math.abs(p)<f?0:this.restitution;this.velocityBias=-l*Math.max(e.penetration-d,0)/t,this.velocityBias+=g*p;var _=this.impulse.scale(.25),b=this.angImpulseA.scale(.25),x=this.angImpulseB.scale(.25);s.applyImpulse(_),s.applyAngularImpulse(x),_.invert(),i.applyImpulse(_),i.applyAngularImpulse(b),this.normalImpulse=0,this.tangentImpulse1=0,this.tangentImpulse2=0,_.clear(),b.clear(),x.clear()},o.prototype.resolve=function(){var t=this.data,e=this.bodyA,i=this.bodyB,r=t.localContactA,n=t.localContactB,o=t.normal,h=this.tangent1,u=this.tangent2,c=a.add(e.velocity,a.cross(e.angularVelocity,r,v),m),p=a.add(i.velocity,a.cross(i.angularVelocity,n,v),y),l=p.subtract(c),g=-(a.dot(l,o)+this.velocityBias)*this.effNormalMass,_=Math.max(this.normalImpulse+g,0);g=_-this.normalImpulse;var I=this.friction*_,C=-a.dot(l,h)*this.effTangentialMass1,T=s(this.tangentImpulse1+C,-I,I);C=T-this.tangentImpulse1;var M=-a.dot(l,u)*this.effTangentialMass2,E=s(this.tangentImpulse2+M,-I,I);M=E-this.tangentImpulse2;var A=a.scale(o,g,b),z=a.scale(h,C,x),R=a.scale(u,M,w);A.add(z).add(R);var S=a.cross(n,A,d),D=a.cross(r,A,f).invert();i.applyImpulse(A),i.applyAngularImpulse(S),A.invert(),e.applyImpulse(A),e.applyAngularImpulse(D),this.normalImpulse=_,this.tangentImpulse1=T,this.tangentImpulse2=E,this.impulse.add(A),this.angImpulseA.add(D),this.angImpulseB.add(S)},e.exports=r},{"../../../math/Vec3":29,"../../../utilities/ObjectManager":69}],51:[function(t,e,i){"use strict";function s(t,e,i){this.vertex=t,this.worldVertexA=e,this.worldVertexB=i}function r(t){var e,i=t.vertices;for(e=i.length;e--;){var s=i.pop();null!==s&&l(s)}t.numVertices=0;var r=t.features;for(e=r.length;e--;){var n=r.pop();null!==n&&f(n)}t.numFeatures=0,d(t)}function n(t,e,i){var s=h.scale(i,-1,b),r=h.add(t.support(i),t.position,new h),n=h.add(e.support(s),e.position,new h);return c().reset(h.subtract(r,n,new h),r,n)}function o(t,e){var i=n,s=h.subtract(e.position,t.position,_).normalize(),o=p();o.addVertex(i(t,e,s)),s.invert();for(var a=0,u=1e3;a++<u&&(0!==s.x||0!==s.y||0!==s.z)&&(o.addVertex(i(t,e,s)),!(h.dot(o.getLastVertex().vertex,s)<0));)if(o.simplexContainsOrigin(s,l))return o;return r(o),!1}function a(t,e,i){for(var s=n,o=1/0,a=0,c=1e3;a++<c;){var p=i.getFeatureClosestToOrigin();if(null===p)return null;var d=p.normal,f=s(t,e,d);if(o=Math.min(o,h.dot(f.vertex,d)),o-p.distance<=.01){var _=i.vertices[p.vertexIndices[0]],b=i.vertices[p.vertexIndices[1]],x=i.vertices[p.vertexIndices[2]],w=_.vertex,I=b.vertex,C=x.vertex,T=h.scale(d,p.distance,m),M=h.subtract(I,w,y),E=h.subtract(C,w,v),A=h.subtract(T,w,g),z=h.dot(M,M),R=h.dot(M,E),S=h.dot(E,E),D=h.dot(A,M),O=h.dot(A,E),P=z*S-R*R,L=(S*D-R*O)/P,V=(z*O-R*D)/P,U=1-L-V,F=_.worldVertexA.scale(U).add(b.worldVertexA.scale(L)).add(x.worldVertexA.scale(V)),k=_.worldVertexB.scale(U).add(b.worldVertexB.scale(L)).add(x.worldVertexB.scale(V)),G=h.subtract(F,t.position,new h),B=h.subtract(k,e.position,new h);return r(i),l(f),u.requestCollisionData().reset(p.distance,d,F,k,G,B)}i.addVertex(f),i.reshape()}throw new Error("EPA failed to terminate in allotted iterations.")}var h=t("../../../math/Vec3"),u=t("../../../utilities/ObjectManager");u.register("GJK_EPASupportPoint",s);var c=u.requestGJK_EPASupportPoint,p=u.requestDynamicGeometry,l=u.freeGJK_EPASupportPoint,d=u.freeDynamicGeometry,f=u.freeDynamicGeometryFeature,m=new h,y=new h,v=new h,g=new h,_=new h,b=new h;s.prototype.reset=function(t,e,i){return this.vertex=t,this.worldVertexA=e,this.worldVertexB=i,this},e.exports.gjk=o,e.exports.epa=a},{"../../../math/Vec3":29,"../../../utilities/ObjectManager":69}],52:[function(t,e,i){"use strict";function s(t){this._sweepVolumes=[],this._entityRegistry={},this._boundingVolumeRegistry={},this.endpoints={x:[],y:[],z:[]},this.overlaps=[],this.overlapsMatrix={},this._IDPool=[],t=t||[];for(var e=0;e<t.length;e++)this.add(t[e])}function r(t){this._boundingVolume=t,this._ID=t._ID,this.points={x:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}],y:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}],z:[{_ID:t._ID,side:0,value:null},{_ID:t._ID,side:1,value:null}]},this.update()}var n=t("./AABB"),o=["x","y","z"];s.prototype.add=function(t){var e=new n(t),i=new r(e);this._entityRegistry[t._ID]=t,this._boundingVolumeRegistry[t._ID]=e,this._sweepVolumes.push(i);for(var s=0;3>s;s++){var a=o[s];this.endpoints[a].push(i.points[a][0]),this.endpoints[a].push(i.points[a][1])}},s.prototype.remove=function(t){this._entityRegistry[t._ID]=null,this._boundingVolumeRegistry[t._ID]=null;var e,i,s;for(e=0,i=this._sweepVolumes.length;i>e;e++)if(this._sweepVolumes[e]._ID===t._ID){s=e;break}this._sweepVolumes.splice(s,1);var r,n=this.endpoints,o=[];for(e=0,i=n.x.length;i>e;e++)r=n.x[e],r._ID!==t._ID&&o.push(r);var a=[];for(e=0,i=n.y.length;i>e;e++)r=n.y[e],r._ID!==t._ID&&a.push(r);var h=[];for(e=0,i=n.z.length;i>e;e++)r=n.z[e],r._ID!==t._ID&&h.push(r);n.x=o,n.y=a,n.z=h},s.prototype.update=function(){var t,e,i,s,r=this._sweepVolumes,a=this._entityRegistry,h=this._boundingVolumeRegistry;for(e=0,s=r.length;s>e;e++)r[e].update();var u=this.endpoints,c=this.overlaps,p=this.overlapsMatrix,l=this._IDPool;for(i=0;3>i;i++){var d=o[i],f=u[d];for(e=1,s=f.length;s>e;e++){var m,y,v,g,_,b,x,w=f[e],I=w.value;for(t=e-1;t>=0&&(m=f[t]).value>I;)b=w._ID,x=m._ID,x>b?(g=b,_=x):(g=x,_=b),~w.side&m.side?n.checkOverlap(h[b],h[x])&&(y=p[g]=p[g]||{},v=y[_]=l.length?l.pop():c.length,c[v]=[a[g],a[_]]):w.side&~m.side&&(y=p[g])&&null!=y[_]&&(v=y[_],c[v]=null,y[_]=null,l.push(v)),f[t+1]=m,t--;f[t+1]=w}}return c},r.prototype.update=function(){var t=this._boundingVolume;t.update();for(var e=this.points,i=0;3>i;i++){var s=o[i];e[s][0].value=t.vertices[s][0],e[s][1].value=t.vertices[s][1]}},e.exports=s},{"./AABB":48}],53:[function(t,e,i){"use strict";function s(t,e){r.call(this,t,e)}var r=t("./Force"),n=t("../../math/Vec3"),o=new n;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.QUADRATIC=function(t){return t*t},s.LINEAR=function(t){return t},s.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||1,this.type=this.type||s.LINEAR},s.prototype.update=function(){for(var t=this.targets,e=this.type,i=o,s=this.max,r=this.strength,a=0,h=t.length;h>a;a++){var u=t[a],c=u.velocity,p=c.length(),l=p?1/p:0,d=-r*e(p);n.scale(c,(-s>d?-s:d)*l,i),u.applyForce(i)}},e.exports=s},{"../../math/Vec3":29,"./Force":54}],54:[function(t,e,i){"use strict";function s(t,e){t?t instanceof Array?this.targets=t:this.targets=[t]:this.targets=[],e=e||{},this.setOptions(e),this._ID=r++}var r=0;s.prototype.setOptions=function(t){for(var e in t)this[e]=t[e];this.init(t)},s.prototype.addTarget=function(t){this.targets.push(t)},s.prototype.removeTarget=function(t){var e=this.targets.indexOf(t);0>e||this.targets.splice(e,1)},s.prototype.init=function(t){},s.prototype.update=function(t,e){},e.exports=s},{}],55:[function(t,e,i){"use strict";function s(t,e){r.call(this,t,e)}var r=t("./Force"),n=t("../../math/Vec3"),o=new n;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.DOWN=0,s.UP=1,s.LEFT=2,s.RIGHT=3,s.FORWARD=4,s.BACKWARD=5,s.prototype.init=function(t){if(this.max=this.max||1/0,t.acceleration)return this.strength=this.acceleration.length(),void(this.direction=-1);var e=this.acceleration=new n,i=this.direction=this.direction||s.DOWN,r=this.strength=this.strength||200;switch(i){case s.DOWN:e.set(0,r,0);break;case s.UP:e.set(0,-1*r,0);break;case s.LEFT:e.set(-1*r,0,0);break;case s.RIGHT:e.set(r,0,0);break;case s.FORWARD:e.set(0,0,-1*r);break;case s.BACKWARD:e.set(0,0,r)}},s.prototype.update=function(){for(var t=this.targets,e=o,i=this.max,s=this.acceleration,r=s.length(),a=r?1/r:0,h=0,u=t.length;u>h;h++){var c=t[h],p=r*c.mass;n.scale(s,(p>i?i:p)*a,e),c.applyForce(e)}},e.exports=s},{"../../math/Vec3":29,"./Force":54}],56:[function(t,e,i){"use strict";function s(t,e,i){this.source=t||null,r.call(this,e,i)}var r=t("./Force"),n=t("../../math/Vec3"),o=new n;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||200},s.prototype.update=function(){for(var t=this.source,e=this.targets,i=o,s=this.strength,r=this.max,a=this.anchor||t.position,h=this.anchor?1:t.mass,u=0,c=e.length;c>u;u++){var p=e[u];n.subtract(a,p.position,i);var l=i.length(),d=l?1/l:0,f=s*h*p.mass*d*d;f=0>f?-r>f?-r:f:f>r?r:f,i.scale(f*d),p.applyForce(i),t&&t.applyForce(i.invert())}},e.exports=s},{"../../math/Vec3":29,"./Force":54}],57:[function(t,e,i){"use strict";function s(t,e){r.call(this,t,e)}var r=t("./Force"),n=t("../../math/Vec3"),o=new n;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.QUADRATIC=function(t){return t.length()},s.LINEAR=function(){return 1},s.prototype.init=function(){this.max=this.max||1/0,this.strength=this.strength||1,this.type=this.type||s.LINEAR},s.prototype.update=function(){for(var t=this.targets,e=this.type,i=o,s=this.max,r=this.strength,a=0,h=t.length;h>a;a++){var u=t[a],c=u.angularVelocity,p=-r*e(c);n.scale(c,-s>p?-s:p,i),u.applyTorque(i)}},e.exports=s},{"../../math/Vec3":29,"./Force":54}],58:[function(t,e,i){"use strict";function s(t,e,i){this.source=t||null,r.call(this,e,i)}var r=t("./Force"),n=t("../../math/Vec3"),o=t("../../math/Mat33"),a=t("../../math/Quaternion"),h=new a,u=new n,c=new n,p=new o,l=Math.PI;s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype.init=function(t){this.source||(this.anchor=this.anchor?this.anchor.normalize():new a(1,0,0,0)),t.stiffness||t.damping?(this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.period=null,this.dampingRatio=null):(t.period||t.dampingRatio)&&(this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*l/this.period,this.stiffness*=this.stiffness,this.damping=4*l*this.dampingRatio/this.period)},s.prototype.update=function(){for(var t=this.source,e=this.targets,i=h,s=u,r=c,l=p,d=this.max,f=this.stiffness,m=this.damping,y=this.anchor||t.orientation,v=this.anchor?null:t.inverseInertia,g=0,_=e.length;_>g;g++){var b=e[g],x=b.orientation;if(a.conjugate(x,i),i.multiply(y),!(i.w>=1)){var w=Math.acos(i.w),I=Math.sqrt(1-i.w*i.w),C=r.copy(i).scale(2*w/I);C.scale(f),null!==v?o.add(v,b.inverseInertia,l).inverse():o.inverse(b.inverseInertia,l),0!==m&&(t?C.add(n.subtract(b.angularVelocity,t.angularVelocity,s).scale(-m)):C.add(n.scale(b.angularVelocity,-m,s)));var T=C.applyMatrix(l),M=T.length();M>d&&T.scale(d/M),b.applyTorque(T),t&&t.applyTorque(T.invert())}}},e.exports=s},{"../../math/Mat33":26,"../../math/Quaternion":27,"../../math/Vec3":29,"./Force":54}],59:[function(t,e,i){"use strict";function s(t,e,i){this.source=t||null,r.call(this,e,i)}var r=t("./Force"),n=t("../../math/Vec3"),o=new n,a=new n;s.prototype=Object.create(r.prototype),s.prototype.constructor=s;var h=Math.PI;s.FENE=function(t,e){var i=.99*e,s=Math.max(Math.min(t,i),-i);return s/(1-s*s/(e*e))},s.HOOKE=function(t){return t},s.prototype.init=function(t){this.max=this.max||1/0,this.length=this.length||0,this.type=this.type||s.HOOKE,this.maxLength=this.maxLength||1/0,t.stiffness||t.damping?(this.stiffness=this.stiffness||100,this.damping=this.damping||0,this.period=null,this.dampingRatio=null):(t.period||t.dampingRatio)&&(this.period=this.period||1,this.dampingRatio=this.dampingRatio||0,this.stiffness=2*h/this.period,this.stiffness*=this.stiffness,this.damping=4*h*this.dampingRatio/this.period)},s.prototype.update=function(){for(var t=this.source,e=this.targets,i=o,s=a,r=this.max,h=this.stiffness,u=this.damping,c=this.length,p=this.maxLength,l=this.anchor||t.position,d=this.anchor?0:t.inverseMass,f=this.type,m=0,y=e.length;y>m;m++){var v=e[m];n.subtract(l,v.position,i);var g=i.length(),_=g-c;if(!(Math.abs(_)<1e-6)){var b=1/(v.inverseMass+d);null!==this.period&&(h*=b,u*=b),i.scale(h*f(_,p)/_),0!==u&&(t?i.add(n.subtract(v.velocity,t.velocity,s).scale(-u)):i.add(n.scale(v.velocity,-u,s)));var x=i.length(),w=x?1/x:0;n.scale(i,(x>r?r:x)*w,i),v.applyForce(i),t&&t.applyForce(i.invert())}}},e.exports=s},{"../../math/Vec3":29,"./Force":54}],60:[function(t,e,i){"use strict";e.exports={Particle:t("./bodies/Particle"),convexBodyFactory:t("./bodies/convexBodyFactory"),Box:t("./bodies/Box"),Sphere:t("./bodies/Sphere"),Wall:t("./bodies/Wall"),Constraint:t("./constraints/Constraint"),Angle:t("./constraints/Angle"),Collision:t("./constraints/Collision"),Direction:t("./constraints/Direction"),Distance:t("./constraints/Distance"),Curve:t("./constraints/Curve"),Hinge:t("./constraints/Hinge"),BallAndSocket:t("./constraints/BallAndSocket"),Force:t("./forces/Force"),Drag:t("./forces/Drag"),RotationalDrag:t("./forces/RotationalDrag"),Gravity1D:t("./forces/Gravity1D"),Gravity3D:t("./forces/Gravity3D"),Spring:t("./forces/Spring"),RotationalSpring:t("./forces/RotationalSpring"),PhysicsEngine:t("./PhysicsEngine"),Geometry:t("./Geometry")}},{"./Geometry":33,"./PhysicsEngine":34,"./bodies/Box":35,"./bodies/Particle":36,"./bodies/Sphere":37,"./bodies/Wall":38,"./bodies/convexBodyFactory":39,"./constraints/Angle":40,"./constraints/BallAndSocket":41,"./constraints/Collision":42,"./constraints/Constraint":43,"./constraints/Curve":44,"./constraints/Direction":45,"./constraints/Distance":46,"./constraints/Hinge":47,"./forces/Drag":53,"./forces/Force":54,"./forces/Gravity1D":55,"./forces/Gravity3D":56,"./forces/RotationalDrag":57,"./forces/RotationalSpring":58,"./forces/Spring":59}],61:[function(t,e,i){"use strict";var s,r,n=0,o=["ms","moz","webkit","o"];if("object"==typeof window){s=window.requestAnimationFrame,r=window.cancelAnimationFrame||window.cancelRequestAnimationFrame;for(var a=0;a<o.length&&!s;++a)s=window[o[a]+"RequestAnimationFrame"],r=window[o[a]+"CancelRequestAnimationFrame"]||window[o[a]+"CancelAnimationFrame"];s&&!r&&(s=null)}if(!s){var h=Date.now?Date.now:function(){return(new Date).getTime()};s=function(t){var e=h(),i=Math.max(0,16-(e-n)),s=setTimeout(function(){t(e+i)},i);return n=e+i,s},r=function(t){clearTimeout(t)}}var u={requestAnimationFrame:s,cancelAnimationFrame:r};e.exports=u},{}],62:[function(t,e,i){"use strict";e.exports={requestAnimationFrame:t("./animationFrame").requestAnimationFrame,cancelAnimationFrame:t("./animationFrame").cancelAnimationFrame}},{"./animationFrame":61}],63:[function(t,e,i){"use strict";function s(){var t=this;this._updates=[],this._looper=function(e){t.loop(e)},this._time=0,this._stoppedAt=0,this._sleep=0,this._startOnVisibilityChange=!0,this._rAF=null,this._sleepDiff=!0,this.start(),a&&document.addEventListener(u,function(){t._onVisibilityChange()})}var r=t("../polyfills"),n=r.requestAnimationFrame,o=r.cancelAnimationFrame,a="undefined"!=typeof document;if(a){var h,u;"undefined"!=typeof document.hidden?(h="hidden",u="visibilitychange"):"undefined"!=typeof document.mozHidden?(h="mozHidden",u="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(h="msHidden",u="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(h="webkitHidden",u="webkitvisibilitychange")}s.prototype._onVisibilityChange=function(){document[h]?this._onUnfocus():this._onFocus()},s.prototype._onFocus=function(){this._startOnVisibilityChange&&this._start()},s.prototype._onUnfocus=function(){this._stop()},s.prototype.start=function(){return this._running||(this._startOnVisibilityChange=!0,this._start()),this},s.prototype._start=function(){this._running=!0,this._sleepDiff=!0,this._rAF=n(this._looper)},s.prototype.stop=function(){return this._running&&(this._startOnVisibilityChange=!1,this._stop()),this},s.prototype._stop=function(){this._running=!1,this._stoppedAt=this._time,o(this._rAF)},s.prototype.isRunning=function(){return this._running},s.prototype.step=function(t){this._time=t,this._sleepDiff&&(this._sleep+=t-this._stoppedAt,this._sleepDiff=!1);for(var e=t-this._sleep,i=0,s=this._updates.length;s>i;i++)this._updates[i].update(e);return this},s.prototype.loop=function(t){return this.step(t),this._rAF=n(this._looper),this},s.prototype.update=function(t){return-1===this._updates.indexOf(t)&&this._updates.push(t),this},s.prototype.noLongerUpdate=function(t){var e=this._updates.indexOf(t);return e>-1&&this._updates.splice(e,1),this},e.exports=s},{"../polyfills":62}],64:[function(t,e,i){"use strict";function s(){n(),this._contexts={},this._outCommands=[],this._inCommands=[],this._time=null,this._resized=!1;var t=this;window.addEventListener("resize",function(){t._resized=!0})}var r=t("./Context"),n=t("./inject-css");s.prototype.getTime=function(){return this._time},s.prototype.sendEvent=function(t,e,i){this._outCommands.push("WITH",t,"TRIGGER",e,i)},s.prototype.sendResize=function(t,e){this.sendEvent(t,"CONTEXT_RESIZE",e)},s.prototype.handleWith=function(t,e){var i=e[t],s=i.split("/"),r=this.getOrSetContext(s.shift());return r.receive(i,e,t)},s.prototype.getOrSetContext=function(t){if(this._contexts[t])return this._contexts[t];var e=new r(t,this);return this._contexts[t]=e,e},s.prototype.giveSizeFor=function(t,e){var i=e[t],s=this.getOrSetContext(i).getRootSize();this.sendResize(i,s)},s.prototype.drawCommands=function(){for(var t=this._inCommands,e=0,i=t[e];i;){switch(i){case"TIME":this._time=t[++e];break;case"WITH":e=this.handleWith(++e,t);break;case"NEED_SIZE_FOR":this.giveSizeFor(++e,t)}i=t[++e]}for(var s in this._contexts)this._contexts[s].draw();return this._resized&&this.updateSize(),this._outCommands},s.prototype.updateSize=function(){for(var t in this._contexts)this._contexts[t].updateSize()},s.prototype.receiveCommands=function(t){for(var e=t.length,i=0;e>i;i++)this._inCommands.push(t[i])},s.prototype.clearCommands=function(){this._inCommands.length=0,this._outCommands.length=0,this._resized=!1},e.exports=s},{"./Context":65,"./inject-css":67}],65:[function(t,e,i){"use strict";function s(t,e){this._compositor=e,this._rootEl=document.querySelector(t),this._selector=t;var i=document.createElement("div");this._rootEl.appendChild(i),this.DOMRenderer=new o(i,t,e),this.WebGLRenderer=null,this.canvas=null,this._renderState={projectionType:n.ORTHOGRAPHIC_PROJECTION,perspectiveTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewTransform:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),viewDirty:!1,perspectiveDirty:!1},this._size=[],this._children={},this._elementHash={},this._meshTransform=[],this._meshSize=[0,0,0]}var r=t("../webgl-renderers/WebGLRenderer"),n=t("../components/Camera"),o=t("../dom-renderers/DOMRenderer");s.prototype.updateSize=function(){var t=this.DOMRenderer.getSize();return this._compositor.sendResize(this._selector,t),this.canvas&&this.WebGLRenderer&&this.WebGLRenderer.updateSize(t),this},s.prototype.draw=function(){this.DOMRenderer.draw(this._renderState),this.WebGLRenderer&&this.WebGLRenderer.draw(this._renderState),this._renderState.perspectiveDirty&&(this._renderState.perspectiveDirty=!1),this._renderState.viewDirty&&(this._renderState.viewDirty=!1)},s.prototype.getRootSize=function(){return this.DOMRenderer.getSize()},s.prototype.initWebGL=function(){this.canvas=document.createElement("canvas"),this._rootEl.appendChild(this.canvas),this.WebGLRenderer=new r(this.canvas,this._compositor),this.updateSize()},s.prototype.receive=function(t,e,i){var s=i,r=e[++s];for(this.DOMRenderer.loadPath(t),this.DOMRenderer.findTarget();r;){switch(r){case"INIT_DOM":this.DOMRenderer.insertEl(e[++s]);break;case"DOM_RENDER_SIZE":this.DOMRenderer.getSizeOf(e[++s]);break;case"CHANGE_TRANSFORM":for(var o=0;16>o;o++)this._meshTransform[o]=e[++s];this.DOMRenderer.setMatrix(this._meshTransform),this.WebGLRenderer&&this.WebGLRenderer.setCutoutUniform(t,"u_transform",this._meshTransform);break;case"CHANGE_SIZE":var a=e[++s],h=e[++s];this.DOMRenderer.setSize(a,h),this.WebGLRenderer&&(this._meshSize[0]=a,this._meshSize[1]=h,this.WebGLRenderer.setCutoutUniform(t,"u_size",this._meshSize));break;case"CHANGE_PROPERTY":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.setProperty(e[++s],e[++s]);break;case"CHANGE_CONTENT":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.setContent(e[++s]);break;case"CHANGE_ATTRIBUTE":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.setAttribute(e[++s],e[++s]);break;case"ADD_CLASS":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.addClass(e[++s]);break;case"REMOVE_CLASS":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.removeClass(e[++s]);break;case"SUBSCRIBE":this.WebGLRenderer&&this.WebGLRenderer.getOrSetCutout(t),this.DOMRenderer.subscribe(e[++s],e[++s]);break;case"GL_SET_DRAW_OPTIONS":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setMeshOptions(t,e[++s]);
break;case"GL_AMBIENT_LIGHT":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setAmbientLightColor(t,e[++s],e[++s],e[++s]);break;case"GL_LIGHT_POSITION":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setLightPosition(t,e[++s],e[++s],e[++s]);break;case"GL_LIGHT_COLOR":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setLightColor(t,e[++s],e[++s],e[++s]);break;case"MATERIAL_INPUT":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.handleMaterialInput(t,e[++s],e[++s]);break;case"GL_SET_GEOMETRY":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setGeometry(t,e[++s],e[++s],e[++s]);break;case"GL_UNIFORMS":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setMeshUniform(t,e[++s],e[++s]);break;case"GL_BUFFER_DATA":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.bufferData(t,e[++s],e[++s],e[++s],e[++s],e[++s]);break;case"GL_CUTOUT_STATE":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setCutoutState(t,e[++s]);break;case"GL_MESH_VISIBILITY":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.setMeshVisibility(t,e[++s]);break;case"GL_REMOVE_MESH":this.WebGLRenderer||this.initWebGL(),this.WebGLRenderer.removeMesh(t);break;case"PINHOLE_PROJECTION":this._renderState.projectionType=n.PINHOLE_PROJECTION,this._renderState.perspectiveTransform[11]=-1/e[++s],this._renderState.perspectiveDirty=!0;break;case"ORTHOGRAPHIC_PROJECTION":this._renderState.projectionType=n.ORTHOGRAPHIC_PROJECTION,this._renderState.perspectiveTransform[11]=0,this._renderState.perspectiveDirty=!0;break;case"CHANGE_VIEW_TRANSFORM":this._renderState.viewTransform[0]=e[++s],this._renderState.viewTransform[1]=e[++s],this._renderState.viewTransform[2]=e[++s],this._renderState.viewTransform[3]=e[++s],this._renderState.viewTransform[4]=e[++s],this._renderState.viewTransform[5]=e[++s],this._renderState.viewTransform[6]=e[++s],this._renderState.viewTransform[7]=e[++s],this._renderState.viewTransform[8]=e[++s],this._renderState.viewTransform[9]=e[++s],this._renderState.viewTransform[10]=e[++s],this._renderState.viewTransform[11]=e[++s],this._renderState.viewTransform[12]=e[++s],this._renderState.viewTransform[13]=e[++s],this._renderState.viewTransform[14]=e[++s],this._renderState.viewTransform[15]=e[++s],this._renderState.viewDirty=!0;break;case"WITH":return s-1}r=e[++s]}return s},e.exports=s},{"../components/Camera":1,"../dom-renderers/DOMRenderer":13,"../webgl-renderers/WebGLRenderer":82}],66:[function(t,e,i){"use strict";function s(t,e,i){this._thread=t,this._compositor=e,this._renderLoop=i,this._renderLoop.update(this);var s=this;this._thread.onmessage=function(t){var e=t.data?t.data:t;if("ENGINE"===e[0])switch(e[1]){case"START":s._renderLoop.start();break;case"STOP":s._renderLoop.stop();break;default:console.error('Unknown ENGINE command "'+e[1]+'"')}else s._compositor.receiveCommands(e)},this._thread.onerror=function(t){console.error(t)}}s.prototype.getThread=function(){return this._thread},s.prototype.getCompositor=function(){return this._compositor},s.prototype.getEngine=function(){return this._renderLoop},s.prototype.update=function(t){this._thread.postMessage(["FRAME",t]);var e=this._compositor.drawCommands();this._thread.postMessage(e),this._compositor.clearCommands()},e.exports=s},{}],67:[function(t,e,i){"use strict";function s(){if(!n)if(n=!0,document.createStyleSheet){var t=document.createStyleSheet();t.cssText=r}else{var e=document.getElementsByTagName("head")[0],i=document.createElement("style");i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r)),(e?e:document.documentElement).appendChild(i)}}var r=".famous-dom-renderer {width:100%;height:100%;transform-style:preserve-3d;-webkit-transform-style:preserve-3d;}.famous-dom-element {-webkit-transform-origin:0% 0%;transform-origin:0% 0%;-webkit-backface-visibility:visible;backface-visibility:visible;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-tap-highlight-color:transparent;pointer-events:auto;z-index:1;}.famous-dom-element-content,.famous-dom-element {position:absolute;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;}.famous-webgl-renderer {-webkit-transform:translateZ(1000000px);transform:translateZ(1000000px);pointer-events:none;position:absolute;z-index:1;top:0;width:100%;height:100%;}",n="undefined"==typeof document;e.exports=s},{}],68:[function(t,e,i){"use strict";function s(){this._events={}}s.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]);var i=this._events[t];return i.push(e),function(){i.splice(i.indexOf(e),1)}},s.prototype.off=function(t,e){var i=this._events[t];return i&&i.splice(i.indexOf(e),1),this},s.prototype.trigger=function(t,e){var i=this._events[t];if(i)for(var s=0,r=i.length;r>s;s++)i[s](e);return this},e.exports=s},{}],69:[function(t,e,i){"use strict";function s(t,e){return function(){return 0!==t.length?t.pop():new e}}function r(t){return function(e){t.push(e)}}var n={};n.pools={},n.register=function(t,e){var i=this.pools[t]=[];this["request"+t]=s(i,e),this["free"+t]=r(i)},n.disposeOf=function(t){for(var e=this.pools[t],i=e.length;i--;)e.pop()},e.exports=n},{}],70:[function(t,e,i){"use strict";var s=function t(e){var i;if("object"==typeof e){i=e instanceof Array?[]:{};for(var s in e)if("object"==typeof e[s]&&null!==e[s])if(e[s]instanceof Array){i[s]=new Array(e[s].length);for(var r=0;r<e[s].length;r++)i[s][r]=t(e[s][r])}else i[s]=t(e[s]);else i[s]=e[s]}else i=e;return i};e.exports=s},{}],71:[function(t,e,i){"use strict";e.exports=function(t){var e=[],i=[],s=0;for(var r in t)t.hasOwnProperty(r)&&(e[s]=r,i[s]=t[r],s++);return{keys:e,values:i}}},{}],72:[function(t,e,i){"use strict";function s(t){for(var e=0;e<r.length;e++){var i=r[e]+t;if(""===document.documentElement.style[i])return i}return t}var r=["","-ms-","-webkit-","-moz-","-o-"];e.exports=s},{}],73:[function(t,e,i){"use strict";function s(t){if(this.options=t||{},this.DEFAULT_BUFFER_SIZE=3,this.spec={id:r++,dynamic:!1,type:this.options.type||"TRIANGLES",bufferNames:[],bufferValues:[],bufferSpacings:[],invalidations:[]},this.options.buffers)for(var e=this.options.buffers.length,i=0;e>i;)this.spec.bufferNames.push(this.options.buffers[i].name),this.spec.bufferValues.push(this.options.buffers[i].data),this.spec.bufferSpacings.push(this.options.buffers[i].size||this.DEFAULT_BUFFER_SIZE),this.spec.invalidations.push(i++)}var r=0;e.exports=s},{}],74:[function(t,e,i){"use strict";function s(t,e){return-(e+(t-e)/2)}function r(t,e){return 1/((t-e)/2)}var n=t("../math/Vec3"),o=t("../math/Vec2"),a=[new n,new n,new n,new o,new o],h={};h.generateParametric=function(t,e,i,s){var r,n,o,a,h=[],u=s?Math.PI+Math.PI/(t-1):Math.PI,c=[];for(r=0;t+1>r;r++)for(n=r*u/t,a=0;e>a;a++)o=2*a*u/e,i(n,o,c),h.push(c[0],c[1],c[2]);var p,l=[],d=0;for(r=0;t>r;r++){for(a=0;e>a;a++)p=(a+1)%e,l.push(d+a,d+a+e,d+p),l.push(d+p,d+a+e,d+p+e);d+=e}return{vertices:h,indices:l}},h.computeNormals=function(t,e,i){var s,r,n,o,h,u,c,p,l,d,f=i||[],m=e.length/3;for(u=0;m>u;u++)r=3*e[3*u+0],s=3*e[3*u+1],n=3*e[3*u+2],a[0].set(t[s],t[s+1],t[s+2]),a[1].set(t[r],t[r+1],t[r+2]),a[2].set(t[n],t[n+1],t[n+2]),o=a[2].subtract(a[0]).cross(a[1].subtract(a[0])).normalize(),f[s+0]=(f[s+0]||0)+o.x,f[s+1]=(f[s+1]||0)+o.y,f[s+2]=(f[s+2]||0)+o.z,f[r+0]=(f[r+0]||0)+o.x,f[r+1]=(f[r+1]||0)+o.y,f[r+2]=(f[r+2]||0)+o.z,f[n+0]=(f[n+0]||0)+o.x,f[n+1]=(f[n+1]||0)+o.y,f[n+2]=(f[n+2]||0)+o.z;for(u=0;u<f.length;u+=3)for(c=f[u],p=f[u+1],l=f[u+2],d=Math.sqrt(c*c+p*p+l*l),h=0;3>h;h++)f[u+h]/=d;return f},h.subdivide=function(t,e,i){for(var s,r,h,u,c,p,l=t.length/3;l--;)s=t.slice(3*l,3*l+3),c=s.map(function(t){return new n(e[3*t],e[3*t+1],e[3*t+2])}),e.push.apply(e,n.scale(n.add(c[0],c[1],a[0]),.5,a[1]).toArray()),e.push.apply(e,n.scale(n.add(c[1],c[2],a[0]),.5,a[1]).toArray()),e.push.apply(e,n.scale(n.add(c[0],c[2],a[0]),.5,a[1]).toArray()),i&&(p=s.map(function(t){return new o(i[2*t],i[2*t+1])}),i.push.apply(i,o.scale(o.add(p[0],p[1],a[3]),.5,a[4]).toArray()),i.push.apply(i,o.scale(o.add(p[1],p[2],a[3]),.5,a[4]).toArray()),i.push.apply(i,o.scale(o.add(p[0],p[2],a[3]),.5,a[4]).toArray())),r=e.length-3,h=r+1,u=r+2,t.push(r,h,u),t.push(s[0],r,u),t.push(r,s[1],h),t[l]=u,t[l+1]=h,t[l+2]=s[2]},h.getUniqueFaces=function(t,e){for(var i,s=e.length/3,r=[];s--;)for(var n=0;3>n;n++)i=e[3*s+n],r[i]?(t.push(t[3*i],t[3*i+1],t[3*i+2]),e[3*s+n]=t.length/3-1):r[i]=!0},h.subdivideSpheroid=function(t,e){for(var i,s,r,o,h,u=e.length/3;u--;)s=e.slice(3*u,3*u+3),i=s.map(function(e){return new n(t[3*e],t[3*e+1],t[3*e+2])}),t.push.apply(t,n.normalize(n.add(i[0],i[1],a[0]),a[1]).toArray()),t.push.apply(t,n.normalize(n.add(i[1],i[2],a[0]),a[1]).toArray()),t.push.apply(t,n.normalize(n.add(i[0],i[2],a[0]),a[1]).toArray()),r=t.length/3-3,o=r+1,h=r+2,e.push(r,o,h),e.push(s[0],r,h),e.push(r,s[1],o),e[3*u]=h,e[3*u+1]=o,e[3*u+2]=s[2]},h.getSpheroidNormals=function(t,e){e=e||[];for(var i,s=t.length/3,r=0;s>r;r++)i=new n(t[3*r+0],t[3*r+1],t[3*r+2]).normalize().toArray(),e[3*r+0]=i[0],e[3*r+1]=i[1],e[3*r+2]=i[2];return e},h.getSpheroidUV=function(t,e){e=e||[];for(var i,s=t.length/3,r=[],n=0;s>n;n++)i=a[0].set(t[3*n],t[3*n+1],t[3*n+2]).normalize().toArray(),r[0]=.5*this.getAzimuth(i)/Math.PI+.5,r[1]=this.getAltitude(i)/Math.PI+.5,e.push.apply(e,r);return e},h.normalizeAll=function(t,e){e=e||[];for(var i=t.length/3,s=0;i>s;s++)Array.prototype.push.apply(e,new n(t[3*s],t[3*s+1],t[3*s+2]).normalize().toArray());return e},h.normalizeVertices=function(t,e){e=e||[];var i,o,a,h,u,c,p,l,d=t.length/3,f=[];for(l=0;d>l;l++)p=f[l]=new n(t[3*l],t[3*l+1],t[3*l+2]),(null==i||p.x<i)&&(i=p.x),(null==o||p.x>o)&&(o=p.x),(null==a||p.y<a)&&(a=p.y),(null==h||p.y>h)&&(h=p.y),(null==u||p.z<u)&&(u=p.z),(null==c||p.z>c)&&(c=p.z);var m=new n(s(o,i),s(h,a),s(c,u)),y=Math.min(r(o+m.x,i+m.x),r(h+m.y,a+m.y),r(c+m.z,u+m.z));for(l=0;l<f.length;l++)e.push.apply(e,f[l].add(m).scale(y).toArray());return e},h.getAzimuth=function(t){return Math.atan2(t[2],-t[0])},h.getAltitude=function(t){return Math.atan2(-t[1],Math.sqrt(t[0]*t[0]+t[2]*t[2]))},h.trianglesToLines=function(t,e){var i=t.length/3;e=e||[];var s;for(s=0;i>s;s++)e.push(t[3*s+0],t[3*s+1]),e.push(t[3*s+1],t[3*s+2]),e.push(t[3*s+2],t[3*s+0]);return e},h.addBackfaceTriangles=function(t,e){for(var i=e.length/3,s=0,r=e.length;r--;)e[r]>s&&(s=e[r]);for(s++,r=0;i>r;r++){var n=e[3*r],o=e[3*r+1],a=e[3*r+2];e.push(n+s,a+s,o+s)}var h=t.length;for(r=0;h>r;r++)t.push(t[r])},e.exports=h},{"../math/Vec2":28,"../math/Vec3":29}],75:[function(t,e,i){"use strict";function s(t){t=t||{};for(var e,i=t.detailX||t.detail||1,s=t.detailY||t.detail||1,o=[],a=[],h=[],u=[],c=0;s>=c;c++)for(var p=c/s,l=0;i>=l;l++){var d=l/i;o.push(2*(d-.5),2*(p-.5),0),a.push(d,1-p),i>l&&s>c&&(e=l+c*(i+1),u.push(e,e+1,e+i+1),u.push(e+i+1,e+1,e+i+2))}if(t.backface!==!1){n.addBackfaceTriangles(o,u);var f=a.length;for(e=0;f>e;e++)a.push(a[e])}return h=n.computeNormals(o,u),new r({buffers:[{name:"a_pos",data:o},{name:"a_texCoord",data:a,size:2},{name:"a_normals",data:h},{name:"indices",data:u,size:1}]})}var r=t("../Geometry"),n=t("../GeometryHelper");e.exports=s},{"../Geometry":73,"../GeometryHelper":74}],76:[function(t,e,i){"use strict";function s(t,e,i){this.buffer=null,this.target=t,this.type=e,this.data=[],this.gl=i}s.prototype.subData=function(){for(var t=this.gl,e=[],i=0,s=1e4;i<this.data.length;i+=s)e=Array.prototype.concat.apply(e,this.data.slice(i,i+s));this.buffer=this.buffer||t.createBuffer(),t.bindBuffer(this.target,this.buffer),t.bufferData(this.target,new this.type(e),t.STATIC_DRAW)},e.exports=s},{}],77:[function(t,e,i){"use strict";function s(t){this.gl=t,this.registry={},this._dynamicBuffers=[],this._staticBuffers=[],this._arrayBufferMax=3e4,this._elementBufferMax=3e4}var r="indices",n=t("./Buffer");s.prototype.allocate=function(t,e,i,s,o){var a,h,u,c,p=this.registry[t]||(this.registry[t]={keys:[],values:[],spacing:[],offset:[],length:[]}),l=p.keys.indexOf(e),d=e===r,f=!1,m=0;if(-1===l){if(l=p.keys.length,h=d?i.length:Math.floor(i.length/s),o)u=new n(d?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,d?Uint16Array:Float32Array,this.gl),this._dynamicBuffers.push({buffer:u,offset:i.length,isIndex:d});else{for(c=0;c<this._staticBuffers.length;c++)if(d===this._staticBuffers[c].isIndex&&(a=this._staticBuffers[c].offset+i.length,!d&&a<this._arrayBufferMax||d&&a<this._elementBufferMax)){u=this._staticBuffers[c].buffer,m=this._staticBuffers[c].offset,this._staticBuffers[c].offset+=i.length,f=!0;break}f||(u=new n(d?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,d?Uint16Array:Float32Array,this.gl),this._staticBuffers.push({buffer:u,offset:i.length,isIndex:d}))}p.keys.push(e),p.values.push(u),p.spacing.push(s),p.offset.push(m),p.length.push(h)}var y=i.length;for(c=0;y>c;c++)p.values[l].data[m+c]=i[c];p.values[l].subData()},e.exports=s},{"./Buffer":76}],78:[function(t,e,i){"use strict";function s(t,e){return function(){var i=t.apply(this,arguments);return e.apply(this,arguments),i}}function r(t,e){var i="body,html{background:#e3e3e3;font-family:monaco,monospace;font-size:14px;line-height:1.7em}#shaderReport{left:0;top:0;right:0;box-sizing:border-box;position:absolute;z-index:1000;color:#222;padding:15px;white-space:normal;list-style-type:none;margin:50px auto;max-width:1200px}#shaderReport li{background-color:#fff;margin:13px 0;box-shadow:0 1px 2px rgba(0,0,0,.15);padding:20px 30px;border-radius:2px;border-left:20px solid #e01111}span{color:#e01111;text-decoration:underline;font-weight:700}#shaderReport li p{padding:0;margin:0}#shaderReport li:nth-child(even){background-color:#f4f4f4}#shaderReport li p:first-child{margin-bottom:10px;color:#666}",s=document.createElement("style");document.getElementsByTagName("head")[0].appendChild(s),s.textContent=i;var r=document.createElement("ul");r.setAttribute("id","shaderReport"),document.body.appendChild(r);for(var n,o=/ERROR: [\d]+:([\d]+): (.+)/gim,a=e.split("\n");null!=(n=o.exec(t));){n.index===o.lastIndex&&o.lastIndex++;var h=document.createElement("li"),u='<p><span>ERROR</span> "'+n[2]+'" in line '+n[1]+"</p>";u+="<p><b>"+a[n[1]-1].replace(/^[ \t]+/g,"")+"</b></p>",h.innerHTML=u,r.appendChild(h)}}e.exports=function(){return s(this.gl.compileShader,function(t){if(!this.getShaderParameter(t,this.COMPILE_STATUS)){var e=this.getShaderInfoLog(t),i=this.getShaderSource(t);r(e,i)}})}},{}],79:[function(t,e,i){"use strict";function s(t,e){this.gl=t,this.textureSlots=1,this.options=e||{},this.registeredMaterials={},this.flaggedUniforms=[],this.cachedUniforms={},this.uniformTypes=[],this.definitionVec4=[],this.definitionVec3=[],this.definitionFloat=[],this.applicationVec3=[],this.applicationVec4=[],this.applicationFloat=[],this.applicationVert=[],this.definitionVert=[],this.resetProgram()}var r=t("../utilities/clone"),n=t("../utilities/keyValueToArrays"),o=t("../webgl-shaders").vertex,a=t("../webgl-shaders").fragment,h=t("./Debug"),u=35633,c=35632,p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l="precision mediump float;\n",d={undefined:"float ",1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 ",16:"mat4 "},f={u_baseColor:"vec4",u_normals:"vert",u_glossiness:"vec4",u_positionOffset:"vert"},m={vert:1,vec3:2,vec4:4,float:8},y=n({u_perspective:p,u_view:p,u_resolution:[0,0,0],u_transform:p,u_size:[1,1,1],u_time:0,u_opacity:1,u_metalness:0,u_glossiness:[0,0,0,0],u_baseColor:[1,1,1,1],u_normals:[1,1,1],u_positionOffset:[0,0,0],u_lightPosition:p,u_lightColor:p,u_ambientLight:[0,0,0],u_flatShading:0,u_numLights:0}),v=n({a_pos:[0,0,0],a_texCoord:[0,0],a_normals:[0,0,0]}),g=n({v_textureCoordinate:[0,0],v_normal:[0,0,0],v_position:[0,0,0],v_eyeVector:[0,0,0]});s.prototype.registerMaterial=function(t,e){var i=e,s=f[t],r=m[s];if((this.registeredMaterials[e._id]&r)===r)return this;var n;for(n in i.uniforms)-1===y.keys.indexOf(n)&&(y.keys.push(n),y.values.push(i.uniforms[n]));for(n in i.varyings)-1===g.keys.indexOf(n)&&(g.keys.push(n),g.values.push(i.varyings[n]));for(n in i.attributes)-1===v.keys.indexOf(n)&&(v.keys.push(n),v.values.push(i.attributes[n]));return this.registeredMaterials[e._id]|=r,"float"===s&&(this.definitionFloat.push(e.defines),this.definitionFloat.push("float fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationFloat.push("if (int(abs(ID)) == "+e._id+") return fa_"+e._id+"();")),"vec3"===s&&(this.definitionVec3.push(e.defines),this.definitionVec3.push("vec3 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVec3.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),"vec4"===s&&(this.definitionVec4.push(e.defines),this.definitionVec4.push("vec4 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVec4.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),"vert"===s&&(this.definitionVert.push(e.defines),this.definitionVert.push("vec3 fa_"+e._id+"() {\n "+i.glsl+" \n}"),this.applicationVert.push("if (int(abs(ID.x)) == "+e._id+") return fa_"+e._id+"();")),this.resetProgram()},s.prototype.resetProgram=function(){var t,e,i,s,n,h,p=[l],f=[l];for(this.uniformLocations=[],this.attributeLocations={},this.uniformTypes={},this.attributeNames=r(v.keys),this.attributeValues=r(v.values),this.varyingNames=r(g.keys),this.varyingValues=r(g.values),this.uniformNames=r(y.keys),this.uniformValues=r(y.values),this.flaggedUniforms=[],this.cachedUniforms={},f.push("uniform sampler2D u_textures[7];\n"),this.applicationVert.length&&p.push("uniform sampler2D u_textures[7];\n"),h=0;h<this.uniformNames.length;h++)s=this.uniformNames[h],n=this.uniformValues[h],p.push("uniform "+d[n.length]+s+";\n"),f.push("uniform "+d[n.length]+s+";\n");for(h=0;h<this.attributeNames.length;h++)s=this.attributeNames[h],n=this.attributeValues[h],p.push("attribute "+d[n.length]+s+";\n");for(h=0;h<this.varyingNames.length;h++)s=this.varyingNames[h],n=this.varyingValues[h],p.push("varying "+d[n.length]+s+";\n"),f.push("varying "+d[n.length]+s+";\n");e=p.join("")+o.replace("#vert_definitions",this.definitionVert.join("\n")).replace("#vert_applications",this.applicationVert.join("\n")),t=f.join("")+a.replace("#vec3_definitions",this.definitionVec3.join("\n")).replace("#vec3_applications",this.applicationVec3.join("\n")).replace("#vec4_definitions",this.definitionVec4.join("\n")).replace("#vec4_applications",this.applicationVec4.join("\n")).replace("#float_definitions",this.definitionFloat.join("\n")).replace("#float_applications",this.applicationFloat.join("\n")),i=this.gl.createProgram(),this.gl.attachShader(i,this.compileShader(this.gl.createShader(u),e)),this.gl.attachShader(i,this.compileShader(this.gl.createShader(c),t)),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.program=i,this.gl.useProgram(this.program)):(console.error("link error: "+this.gl.getProgramInfoLog(i)),this.program=null),this.setUniforms(this.uniformNames,this.uniformValues);var m=this.gl.getUniformLocation(this.program,"u_textures[0]");return this.gl.uniform1iv(m,[0,1,2,3,4,5,6]),this},s.prototype.uniformIsCached=function(t,e){if(null==this.cachedUniforms[t])return e.length?this.cachedUniforms[t]=new Float32Array(e):this.cachedUniforms[t]=e,!1;if(e.length){for(var i=e.length;i--;)if(e[i]!==this.cachedUniforms[t][i]){for(i=e.length;i--;)this.cachedUniforms[t][i]=e[i];return!1}}else if(this.cachedUniforms[t]!==e)return this.cachedUniforms[t]=e,!1;return!0},s.prototype.setUniforms=function(t,e){var i,s,r,n,o,a=this.gl;if(!this.program)return this;for(n=t.length,o=0;n>o;o++)if(r=t[o],s=e[o],i=this.uniformLocations[r],null!==i&&(void 0===i&&(i=a.getUniformLocation(this.program,r),this.uniformLocations[r]=i),!this.uniformIsCached(r,s)))switch(this.uniformTypes[r]||(this.uniformTypes[r]=this.getUniformTypeFromValue(s)),this.uniformTypes[r]){case"uniform4fv":a.uniform4fv(i,s);break;case"uniform3fv":a.uniform3fv(i,s);break;case"uniform2fv":a.uniform2fv(i,s);break;case"uniform1fv":a.uniform1fv(i,s);break;case"uniform1f":a.uniform1f(i,s);break;case"uniformMatrix3fv":a.uniformMatrix3fv(i,!1,s);break;case"uniformMatrix4fv":a.uniformMatrix4fv(i,!1,s)}return this},s.prototype.getUniformTypeFromValue=function(t){if(Array.isArray(t)||t instanceof Float32Array)switch(t.length){case 1:return"uniform1fv";case 2:return"uniform2fv";case 3:return"uniform3fv";case 4:return"uniform4fv";case 9:return"uniformMatrix3fv";case 16:return"uniformMatrix4fv"}else if(!isNaN(parseFloat(t))&&isFinite(t))return"uniform1f";throw'cant load uniform "'+name+'" with value:'+JSON.stringify(t)},s.prototype.compileShader=function(t,e){var i=1;return this.options.debug&&(this.gl.compileShader=h.call(this)),this.gl.shaderSource(t,e),this.gl.compileShader(t),this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS)||(console.error("compile error: "+this.gl.getShaderInfoLog(t)),console.error("1: "+e.replace(/\n/g,function(){return"\n"+(i+=1)+": "}))),t},e.exports=s},{"../utilities/clone":70,"../utilities/keyValueToArrays":71,"../webgl-shaders":86,"./Debug":78}],80:[function(t,e,i){"use strict";function s(t,e){e=e||{},this.id=t.createTexture(),this.width=e.width||0,this.height=e.height||0,this.mipmap=e.mipmap,this.format=e.format||"RGBA",this.type=e.type||"UNSIGNED_BYTE",this.gl=t,this.bind(),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipYWebgl||!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlphaWebgl||!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t[e.magFilter]||t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t[e.minFilter]||t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t[e.wrapS]||t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t[e.wrapT]||t.CLAMP_TO_EDGE)}s.prototype.bind=function(){return this.gl.bindTexture(this.gl.TEXTURE_2D,this.id),this},s.prototype.unbind=function(){return this.gl.bindTexture(this.gl.TEXTURE_2D,null),this},s.prototype.setImage=function(t){return this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.gl[this.format],this.gl[this.type],t),this.mipmap&&this.gl.generateMipmap(this.gl.TEXTURE_2D),this},s.prototype.setArray=function(t){return this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl[this.format],this.width,this.height,0,this.gl[this.format],this.gl[this.type],t),this},s.prototype.readBack=function(t,e,i,s){var r,n=this.gl;t=t||0,e=e||0,i=i||this.width,s=s||this.height;var o=n.createFramebuffer();return n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.id,0),n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE&&(r=new Uint8Array(i*s*4),n.readPixels(t,e,i,s,n.RGBA,n.UNSIGNED_BYTE,r)),r},e.exports=s},{}],81:[function(t,e,i){"use strict";function s(t){this.registry=[],this._needsResample=[],this._activeTexture=0,this._boundTexture=null,this._checkerboard=o(),this.gl=t}function r(t,e){var i=("string"==typeof t?new Image:t)||{};return i.crossOrigin="anonymous",i.src||(i.src=t),i.complete?e(i):i.onload=function(){e(i)},i}var n=t("./Texture"),o=t("./createCheckerboard");s.prototype.update=function(t){for(var e=this.registry.length,i=1;e>i;i++){var s=this.registry[i];s&&s.isLoaded&&s.resampleRate&&(!s.lastResample||t-s.lastResample>s.resampleRate)&&(this._needsResample[s.id]||(this._needsResample[s.id]=!0,s.lastResample=t))}},s.prototype.register=function(t,e){var i,s=this,o=t.data,a=t.id,h=t.options||{},u=this.registry[a];return u||(u=new n(this.gl,h),u.setImage(this._checkerboard),i=this.registry[a]={resampleRate:h.resampleRate||null,lastResample:null,isLoaded:!1,texture:u,source:o,id:a,slot:e},Array.isArray(o)||o instanceof Uint8Array||o instanceof Float32Array?(this.bindTexture(a),u.setArray(o),i.isLoaded=!0):window&&o instanceof window.HTMLVideoElement?o.addEventListener("loadeddata",function(){s.bindTexture(a),u.setImage(o),i.isLoaded=!0,i.source=o}):"string"==typeof o&&r(o,function(t){s.bindTexture(a),u.setImage(t),i.isLoaded=!0,i.source=t})),a},s.prototype.bindTexture=function(t){var e=this.registry[t];this._activeTexture!==e.slot&&(this.gl.activeTexture(this.gl.TEXTURE0+e.slot),this._activeTexture=e.slot),this._boundTexture!==t&&(this._boundTexture=t,e.texture.bind()),this._needsResample[e.id]&&(e.texture.setImage(e.source),this._needsResample[e.id]=!1)},e.exports=s},{"./Texture":80,"./createCheckerboard":84}],82:[function(t,e,i){"use strict";function s(t,e){t.classList.add("famous-webgl-renderer"),this.canvas=t,this.compositor=e;var i=this.gl=this.getWebGLContext(this.canvas);i.clearColor(0,0,0,0),i.polygonOffset(.1,.1),i.enable(i.POLYGON_OFFSET_FILL),i.enable(i.DEPTH_TEST),i.enable(i.BLEND),i.depthFunc(i.LEQUAL),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.enable(i.CULL_FACE),i.cullFace(i.BACK),this.meshRegistry={},this.meshRegistryKeys=[],this.cutoutRegistry={},this.cutoutRegistryKeys=[],this.numLights=0,this.ambientLightColor=[0,0,0],this.lightRegistry={},this.lightRegistryKeys=[],this.lightPositions=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.lightColors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.textureManager=new u(i),this.texCache={},this.bufferRegistry=new n(i),this.program=new r(i,{debug:!0}),this.state={boundArrayBuffer:null,boundElementBuffer:null,lastDrawn:null,enabledAttributes:{},enabledAttributesKeys:[]},this.resolutionName=["u_resolution"],this.resolutionValues=[],this.cachedSize=[],this.projectionTransform=[1,0,0,0,0,1,0,0,0,0,-1e-6,0,-1,1,0,1];var s=this.cutoutGeometry=new o;this.bufferRegistry.allocate(s.spec.id,"a_pos",s.spec.bufferValues[0],3),this.bufferRegistry.allocate(s.spec.id,"a_texCoord",s.spec.bufferValues[1],2),this.bufferRegistry.allocate(s.spec.id,"a_normals",s.spec.bufferValues[2],3),this.bufferRegistry.allocate(s.spec.id,"indices",s.spec.bufferValues[3],1)}var r=t("./Program"),n=t("./BufferRegistry"),o=t("../webgl-geometries/primitives/Plane"),a=t("./radixSort"),h=t("../utilities/keyValueToArrays"),u=t("./TextureManager"),c=t("./compileMaterial"),p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=h({u_numLights:0,u_ambientLight:new Array(3),u_lightPosition:new Array(3),u_lightColor:new Array(3),u_perspective:new Array(16),u_time:0,u_view:new Array(16)});s.prototype.getWebGLContext=function(t){for(var e=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,s=0;s<e.length;s++){try{i=t.getContext(e[s])}catch(t){var r="Error creating WebGL context: "+t.prototype.toString();console.error(r)}if(i)break}return i?i:!1},s.prototype.createLight=function(t){return this.numLights++,this.lightRegistryKeys.push(t),this.lightRegistry[t]={color:[0,0,0],position:[0,0,0]},this.lightRegistry[t]},s.prototype.createMesh=function(t){this.meshRegistryKeys.push(t);var e=h({u_opacity:1,u_transform:p,u_size:[0,0,0],u_baseColor:[.5,.5,.5,1],u_positionOffset:[0,0,0],u_normals:[0,0,0],u_flatShading:0,u_glossiness:[0,0,0,0]});return this.meshRegistry[t]={depth:null,uniformKeys:e.keys,uniformValues:e.values,buffers:{},geometry:null,drawType:null,textures:[],visible:!0},this.meshRegistry[t]},s.prototype.setCutoutState=function(t,e){var i=this.getOrSetCutout(t);i.visible=e},s.prototype.getOrSetCutout=function(t){if(this.cutoutRegistry[t])return this.cutoutRegistry[t];var e=h({u_opacity:0,u_transform:p.slice(),u_size:[0,0,0],u_origin:[0,0,0],u_baseColor:[0,0,0,1]});return this.cutoutRegistryKeys.push(t),this.cutoutRegistry[t]={uniformKeys:e.keys,uniformValues:e.values,geometry:this.cutoutGeometry.spec.id,drawType:this.cutoutGeometry.spec.type,visible:!0},this.cutoutRegistry[t]},s.prototype.setMeshVisibility=function(t,e){var i=this.meshRegistry[t]||this.createMesh(t);i.visible=e},s.prototype.removeMesh=function(t){var e=this.meshRegistryKeys.indexOf(t);this.meshRegistryKeys.splice(e,1),this.meshRegistry[t]=null},s.prototype.setCutoutUniform=function(t,e,i){var s=this.getOrSetCutout(t),r=s.uniformKeys.indexOf(e);if(Array.isArray(i))for(var n=0,o=i.length;o>n;n++)s.uniformValues[r][n]=i[n];else s.uniformValues[r]=i},s.prototype.setMeshOptions=function(t,e){var i=this.meshRegistry[t]||this.createMesh(t);return i.options=e,this},s.prototype.setAmbientLightColor=function(t,e,i,s){return this.ambientLightColor[0]=e,this.ambientLightColor[1]=i,this.ambientLightColor[2]=s,this},s.prototype.setLightPosition=function(t,e,i,s){var r=this.lightRegistry[t]||this.createLight(t);return r.position[0]=e,r.position[1]=i,r.position[2]=s,this},s.prototype.setLightColor=function(t,e,i,s){var r=this.lightRegistry[t]||this.createLight(t);return r.color[0]=e,r.color[1]=i,r.color[2]=s,this},s.prototype.handleMaterialInput=function(t,e,i){var s=this.meshRegistry[t]||this.createMesh(t);i=c(i,s.textures.length),s.uniformValues[s.uniformKeys.indexOf(e)][0]=-i._id;for(var r=i.textures.length;r--;)s.textures.push(this.textureManager.register(i.textures[r],s.textures.length+r));return this.program.registerMaterial(e,i),this.updateSize()},s.prototype.setGeometry=function(t,e,i,s){var r=this.meshRegistry[t]||this.createMesh(t);return r.geometry=e,r.drawType=i,r.dynamic=s,this},s.prototype.setMeshUniform=function(t,e,i){var s=this.meshRegistry[t]||this.createMesh(t),r=s.uniformKeys.indexOf(e);-1===r?(s.uniformKeys.push(e),s.uniformValues.push(i)):s.uniformValues[r]=i},s.prototype.bufferData=function(t,e,i,s,r,n){return this.bufferRegistry.allocate(e,i,s,r,n),this},s.prototype.draw=function(t){var e=this.compositor.getTime();this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.textureManager.update(e),this.meshRegistryKeys=a(this.meshRegistryKeys,this.meshRegistry),this.setGlobalUniforms(t),this.drawCutouts(),this.drawMeshes()},s.prototype.drawMeshes=function(){for(var t,e,i=this.gl,s=0;s<this.meshRegistryKeys.length;s++)if(e=this.meshRegistry[this.meshRegistryKeys[s]],t=this.bufferRegistry.registry[e.geometry],e.visible&&(e.uniformValues[0]<1?(i.depthMask(!1),i.enable(i.BLEND)):(i.depthMask(!0),i.disable(i.BLEND)),t)){for(var r=e.textures.length;r--;)this.textureManager.bindTexture(e.textures[r]);e.options&&this.handleOptions(e.options,e),this.program.setUniforms(e.uniformKeys,e.uniformValues),this.drawBuffers(t,e.drawType,e.geometry),e.options&&this.resetOptions(e.options)}},s.prototype.drawCutouts=function(){var t,e,i=this.cutoutRegistryKeys.length;i&&(this.gl.enable(this.gl.BLEND),this.gl.depthMask(!0));for(var s=0;i>s;s++)t=this.cutoutRegistry[this.cutoutRegistryKeys[s]],e=this.bufferRegistry.registry[t.geometry],t.visible&&(this.program.setUniforms(t.uniformKeys,t.uniformValues),this.drawBuffers(e,t.drawType,t.geometry))},s.prototype.setGlobalUniforms=function(t){for(var e,i,s=0,r=this.lightRegistryKeys.length;r>s;s++)e=this.lightRegistry[this.lightRegistryKeys[s]],i=4*s,this.lightPositions[0+i]=e.position[0],this.lightPositions[1+i]=e.position[1],this.lightPositions[2+i]=e.position[2],this.lightColors[0+i]=e.color[0],this.lightColors[1+i]=e.color[1],this.lightColors[2+i]=e.color[2];l.values[0]=this.numLights,l.values[1]=this.ambientLightColor,l.values[2]=this.lightPositions,l.values[3]=this.lightColors,this.projectionTransform[0]=1/(.5*this.cachedSize[0]),this.projectionTransform[5]=-1/(.5*this.cachedSize[1]),this.projectionTransform[11]=t.perspectiveTransform[11],l.values[4]=this.projectionTransform,l.values[5]=.001*this.compositor.getTime(),l.values[6]=t.viewTransform,this.program.setUniforms(l.keys,l.values)},s.prototype.drawBuffers=function(t,e,i){var s,r,n,o,a,h,u,c,p=this.gl,l=0;for(h=t.keys.length,c=0;h>c;c++)s=t.keys[c],"indices"!==s?(r=this.program.attributeLocations[s],-1!==r&&(void 0!==r||(r=p.getAttribLocation(this.program.program,s),this.program.attributeLocations[s]=r,-1!==r))&&(this.state.enabledAttributes[s]||(p.enableVertexAttribArray(r),this.state.enabledAttributes[s]=!0,this.state.enabledAttributesKeys.push(s)),a=t.values[c],n=t.spacing[c],o=t.offset[c],l=t.length[c],this.state.boundArrayBuffer!==a&&(p.bindBuffer(a.target,a.buffer),this.state.boundArrayBuffer=a),this.state.lastDrawn!==i&&p.vertexAttribPointer(r,n,p.FLOAT,p.FALSE,0,4*o))):u=c;var d=this.state.enabledAttributesKeys.length;for(c=0;d>c;c++){var f=this.state.enabledAttributesKeys[c];this.state.enabledAttributes[f]&&-1===t.keys.indexOf(f)&&(p.disableVertexAttribArray(this.program.attributeLocations[f]),this.state.enabledAttributes[f]=!1)}l&&(void 0!==u?(a=t.values[u],o=t.offset[u],n=t.spacing[u],l=t.length[u],this.state.boundElementBuffer!==a&&(p.bindBuffer(a.target,a.buffer),
this.state.boundElementBuffer=a),p.drawElements(p[e],l,p.UNSIGNED_SHORT,2*o)):p.drawArrays(p[e],0,l)),this.state.lastDrawn=i},s.prototype.updateSize=function(t){if(t){var e=window.devicePixelRatio||1,i=~~(t[0]*e),s=~~(t[1]*e);this.canvas.width=i,this.canvas.height=s,this.gl.viewport(0,0,i,s),this.cachedSize[0]=t[0],this.cachedSize[1]=t[1],this.cachedSize[2]=t[0]>t[1]?t[0]:t[1],this.resolutionValues[0]=this.cachedSize}return this.program.setUniforms(this.resolutionName,this.resolutionValues),this},s.prototype.handleOptions=function(t,e){var i=this.gl;t&&("double"===t.side&&(this.gl.cullFace(this.gl.FRONT),this.drawBuffers(this.bufferRegistry.registry[e.geometry],e.drawType,e.geometry),this.gl.cullFace(this.gl.BACK)),t.blending&&i.blendFunc(i.SRC_ALPHA,i.ONE),"back"===t.side&&i.cullFace(i.FRONT))},s.prototype.resetOptions=function(t){var e=this.gl;t&&(t.blending&&e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),"back"===t.side&&e.cullFace(e.BACK))},e.exports=s},{"../utilities/keyValueToArrays":71,"../webgl-geometries/primitives/Plane":75,"./BufferRegistry":77,"./Program":79,"./TextureManager":81,"./compileMaterial":83,"./radixSort":85}],83:[function(t,e,i){"use strict";function s(t,e){var i="",s={},u={},p={},l=[],d=[];return r(t,function(t,r){if(t.chunk){var f=c[n(t)],m=a(t),y=o(t.chunk.glsl,t.inputs,d.length+e);i+=f+m+" = "+y+"\n ",t.uniforms&&h(s,t.uniforms),t.varyings&&h(u,t.varyings),t.attributes&&h(p,t.attributes),t.chunk.defines&&l.push(t.chunk.defines),t.texture&&d.push(t.texture)}}),{_id:t._id,glsl:i+"return "+a(t)+";",defines:l.join("\n"),uniforms:s,varyings:u,attributes:p,textures:d}}function r(t,e){for(var i=t.inputs,s=i&&i.length,n=-1;++n<s;)r(i[n],e);return e(t),t}function n(t){if("number"==typeof t)return 1;if(Array.isArray(t))return t.length;var e=t.chunk.output;if("number"==typeof e)return e;var i=t.inputs.map(function(t){return n(t)}).join(",");return e[i]}function o(t,e,i){return t.replace(/%\d/g,function(t){return a(e[t[1]-1])}).replace(/\$TEXTURE/,"u_textures["+i+"]")}function a(t){return Array.isArray(t)?u(t):"object"==typeof t?"fa_"+t._id:t.toFixed(6)}function h(t,e){for(var i in e)t[i]=e[i]}function u(t){var e=t.length;return"vec"+e+"("+t.join(",")+")"}var c={1:"float ",2:"vec2 ",3:"vec3 ",4:"vec4 "};e.exports=s},{}],84:[function(t,e,i){"use strict";function s(){var t=document.createElement("canvas").getContext("2d");t.canvas.width=t.canvas.height=128;for(var e=0;e<t.canvas.height;e+=16)for(var i=0;i<t.canvas.width;i+=16)t.fillStyle=16&(i^e)?"#FFF":"#DDD",t.fillRect(i,e,16,16);return t.canvas}e.exports=s},{}],85:[function(t,e,i){"use strict";function s(t,e,i){var s=t[i],r=e[s];return(r.depth?r.depth:e[s].uniformValues[1][14])+v}function r(t,e,i,s){var r=t[i];return e[r].depth=a(s)-v,r}function n(t,e,i){e[t[i]].depth=null}function o(t){return _[0]=t,b[0]}function a(t){return b[0]=t,_[0]}function h(t,e){var i,a,h,d,v,g,_,b,x,w,I,C=0,T=[];for(m=32/u+.999999999999999|0,i=0,d=c*m;d>i;i++)l[i]=0;for(i=0,d=t.length;d>i;i++){for(v=o(s(t,e,i)),v^=v>>31|2147483648,a=0,h=0;y>a;a+=c,h+=u)l[a+(v>>>h&p)]++;l[a+(v>>>h&f)]++}for(a=0;y>=a;a+=c)for(b=a,x=0;a+c>b;b++)w=l[b]+x,l[b]=x-1,x=w;if(--m){for(i=0,d=t.length;d>i;i++)v=o(s(t,e,i)),T[++l[v&p]]=r(t,e,i,v^=v>>31|2147483648);for(_=T,T=t,t=_;++C<m;){for(i=0,d=t.length,g=C*c,I=C*u;d>i;i++)v=o(s(t,e,i)),T[++l[g+(v>>>I&p)]]=t[i];_=T,T=t,t=_}}for(i=0,d=t.length,g=C*c,I=C*u;d>i;i++)v=o(s(t,e,i)),T[++l[g+(v>>>I&f)]]=r(t,e,i,v^(~v>>31|2147483648)),n(t,e,i);return T}var u=11,c=1<<u,p=c-1,l=new Array(c*Math.ceil(64/u)),d=1<<31%u,f=(d<<1)-1,m=32/u+.999999999999999|0,y=c*(m-1),v=Math.pow(20,6),g=new ArrayBuffer(4),_=new Float32Array(g,0,1),b=new Int32Array(g,0,1);e.exports=h},{}],86:[function(t,e,i){"use strict";var s=(t("glslify"),t("glslify/simple-adapter.js")("\n#define GLSLIFY 1\n\nmat3 a_x_getNormalMatrix(in mat4 t) {\n  mat3 matNorm;\n  mat4 a = t;\n  float a00 = a[0][0], a01 = a[0][1], a02 = a[0][2], a03 = a[0][3], a10 = a[1][0], a11 = a[1][1], a12 = a[1][2], a13 = a[1][3], a20 = a[2][0], a21 = a[2][1], a22 = a[2][2], a23 = a[2][3], a30 = a[3][0], a31 = a[3][1], a32 = a[3][2], a33 = a[3][3], b00 = a00 * a11 - a01 * a10, b01 = a00 * a12 - a02 * a10, b02 = a00 * a13 - a03 * a10, b03 = a01 * a12 - a02 * a11, b04 = a01 * a13 - a03 * a11, b05 = a02 * a13 - a03 * a12, b06 = a20 * a31 - a21 * a30, b07 = a20 * a32 - a22 * a30, b08 = a20 * a33 - a23 * a30, b09 = a21 * a32 - a22 * a31, b10 = a21 * a33 - a23 * a31, b11 = a22 * a33 - a23 * a32, det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  det = 1.0 / det;\n  matNorm[0][0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  matNorm[0][1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  matNorm[0][2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  matNorm[1][0] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  matNorm[1][1] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  matNorm[1][2] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  matNorm[2][0] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  matNorm[2][1] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  matNorm[2][2] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  return matNorm;\n}\nfloat b_x_inverse(float m) {\n  return 1.0 / m;\n}\nmat2 b_x_inverse(mat2 m) {\n  return mat2(m[1][1], -m[0][1], -m[1][0], m[0][0]) / (m[0][0] * m[1][1] - m[0][1] * m[1][0]);\n}\nmat3 b_x_inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11), b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10), b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\nmat4 b_x_inverse(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3], a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3], a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3], a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3], b00 = a00 * a11 - a01 * a10, b01 = a00 * a12 - a02 * a10, b02 = a00 * a13 - a03 * a10, b03 = a01 * a12 - a02 * a11, b04 = a01 * a13 - a03 * a11, b05 = a02 * a13 - a03 * a12, b06 = a20 * a31 - a21 * a30, b07 = a20 * a32 - a22 * a30, b08 = a20 * a33 - a23 * a30, b09 = a21 * a32 - a22 * a31, b10 = a21 * a33 - a23 * a31, b11 = a22 * a33 - a23 * a32, det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n  return mat4(a11 * b11 - a12 * b10 + a13 * b09, a02 * b10 - a01 * b11 - a03 * b09, a31 * b05 - a32 * b04 + a33 * b03, a22 * b04 - a21 * b05 - a23 * b03, a12 * b08 - a10 * b11 - a13 * b07, a00 * b11 - a02 * b08 + a03 * b07, a32 * b02 - a30 * b05 - a33 * b01, a20 * b05 - a22 * b02 + a23 * b01, a10 * b10 - a11 * b08 + a13 * b06, a01 * b08 - a00 * b10 - a03 * b06, a30 * b04 - a31 * b02 + a33 * b00, a21 * b02 - a20 * b04 - a23 * b00, a11 * b07 - a10 * b09 - a12 * b06, a00 * b09 - a01 * b07 + a02 * b06, a31 * b01 - a30 * b03 - a32 * b00, a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\nfloat c_x_transpose(float m) {\n  return m;\n}\nmat2 c_x_transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0], m[0][1], m[1][1]);\n}\nmat3 c_x_transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0], m[0][1], m[1][1], m[2][1], m[0][2], m[1][2], m[2][2]);\n}\nmat4 c_x_transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0], m[0][1], m[1][1], m[2][1], m[3][1], m[0][2], m[1][2], m[2][2], m[3][2], m[0][3], m[1][3], m[2][3], m[3][3]);\n}\nvec4 applyTransform(vec4 pos) {\n  mat4 MVMatrix = u_view * u_transform;\n  pos.x += 1.0;\n  pos.y -= 1.0;\n  pos.xyz *= u_size * 0.5;\n  pos.y *= -1.0;\n  v_position = (MVMatrix * pos).xyz;\n  v_eyeVector = (u_resolution * 0.5) - v_position;\n  pos = u_perspective * MVMatrix * pos;\n  return pos;\n}\n#vert_definitions\n\nvec3 calculateOffset(vec3 ID) {\n  \n  #vert_applications\n  return vec3(0.0);\n}\nvoid main() {\n  v_textureCoordinate = a_texCoord;\n  vec3 invertedNormals = a_normals + (u_normals.x < 0.0 ? calculateOffset(u_normals) * 2.0 - 1.0 : vec3(0.0));\n  invertedNormals.y *= -1.0;\n  v_normal = c_x_transpose(mat3(b_x_inverse(u_transform))) * invertedNormals;\n  vec3 offsetPos = a_pos + calculateOffset(u_positionOffset);\n  gl_Position = applyTransform(vec4(offsetPos, 1.0));\n}","\n#define GLSLIFY 1\n\n#float_definitions\n\nfloat a_x_applyMaterial(float ID) {\n  \n  #float_applications\n  return 1.;\n}\n#vec3_definitions\n\nvec3 a_x_applyMaterial(vec3 ID) {\n  \n  #vec3_applications\n  return vec3(0);\n}\n#vec4_definitions\n\nvec4 a_x_applyMaterial(vec4 ID) {\n  \n  #vec4_applications\n  return vec4(0);\n}\nvec4 b_x_applyLight(in vec4 baseColor, in vec3 normal, in vec4 glossiness) {\n  int numLights = int(u_numLights);\n  vec3 ambientColor = u_ambientLight * baseColor.rgb;\n  vec3 eyeVector = normalize(v_eyeVector);\n  vec3 diffuse = vec3(0.0);\n  bool hasGlossiness = glossiness.a > 0.0;\n  bool hasSpecularColor = length(glossiness.rgb) > 0.0;\n  for(int i = 0; i < 4; i++) {\n    if(i >= numLights)\n      break;\n    vec3 lightDirection = normalize(u_lightPosition[i].xyz - v_position);\n    float lambertian = max(dot(lightDirection, normal), 0.0);\n    if(lambertian > 0.0) {\n      diffuse += u_lightColor[i].rgb * baseColor.rgb * lambertian;\n      if(hasGlossiness) {\n        vec3 halfVector = normalize(lightDirection + eyeVector);\n        float specularWeight = pow(max(dot(halfVector, normal), 0.0), glossiness.a);\n        vec3 specularColor = hasSpecularColor ? glossiness.rgb : u_lightColor[i].rgb;\n        diffuse += specularColor * specularWeight * lambertian;\n      }\n    }\n  }\n  return vec4(ambientColor + diffuse, baseColor.a);\n}\nvoid main() {\n  vec4 material = u_baseColor.r >= 0.0 ? u_baseColor : a_x_applyMaterial(u_baseColor);\n  bool lightsEnabled = (u_flatShading == 0.0) && (u_numLights > 0.0 || length(u_ambientLight) > 0.0);\n  vec3 normal = normalize(v_normal);\n  vec4 glossiness = u_glossiness.x < 0.0 ? a_x_applyMaterial(u_glossiness) : u_glossiness;\n  vec4 color = lightsEnabled ? b_x_applyLight(material, normalize(v_normal), glossiness) : material;\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}",[],[]));e.exports=s},{glslify:31,"glslify/simple-adapter.js":32}],87:[function(t,e,i){"use strict";function s(t,e){this.node=t,this.el=new r(t),this.el.setProperty("color","white"),this.direction=e.direction,this.el.setContent(1===this.direction?">":"<"),this.el.setProperty("fontSize","40px"),this.el.setProperty("lineHeight","40px"),this.el.setProperty("cursor","pointer"),this.el.setProperty("textHighlight","none"),this.el.setProperty("zIndex","2");var i=function(){this.node.emit("pageChange",{direction:this.direction})}.bind(this);this.gestures=new n(t),this.gestures.on("tap",i)}var r=t("famous/dom-renderables/DOMElement"),n=t("famous/components/GestureHandler");e.exports=s},{"famous/components/GestureHandler":2,"famous/dom-renderables/DOMElement":12}],88:[function(t,e,i){"use strict";function s(t,e){this.context=o.createScene(t),this.root=this.context.addChild(),this.camera=new c(this.root),this.camera.setDepth(1e3),this.pageData=e.pageData,this.arrows={back:new a(this.root.addChild(),{direction:-1}),next:new a(this.root.addChild(),{direction:1})},this.pager=new h(this.root.addChild(),{pageData:this.pageData}),this.dots=new u(this.root.addChild(),{numPages:this.pageData.length}),r.call(this),this.currentIndex=0,n.call(this)}function r(){this.arrows.back.node.setSizeMode(1,1),this.arrows.back.node.setAbsoluteSize(40,40),this.arrows.back.node.setPosition(40,0,0),this.arrows.back.node.setAlign(0,.5,0),this.arrows.back.node.setMountPoint(0,.5,0),this.arrows.next.node.setSizeMode(1,1),this.arrows.next.node.setAbsoluteSize(40,40),this.arrows.next.node.setPosition(-40,0,0),this.arrows.next.node.setAlign(1,.5,0),this.arrows.next.node.setMountPoint(1,.5,0),this.dots.node.setSizeMode(1,1),this.dots.node.setAbsoluteSize(null,20),this.dots.node.setPosition(0,-50,200),this.dots.node.setAlign(.5,1,0),this.dots.node.setMountPoint(.5,1,0),this.pager.node.setAlign(.5,.5,0),this.pager.node.setMountPoint(.5,.5,0)}function n(){this.root.addComponent({onReceive:function(t,e){if("pageChange"===t){var i=e.direction,s=e.amount;s=s||1;var r=this.currentIndex,n=r+i*s,o=0,a=this.pageData.length-1,h=n>a?a:o>n?o:n;this.currentIndex!==h&&(this.currentIndex=h,this.dots.pageChange(r,this.currentIndex),this.pager.pageChange(r,this.currentIndex))}}.bind(this)}),window.addEventListener("keydown",function(t){39===t.keyCode&&this.root.emit("pageChange",{direction:1,amount:1}),37===t.keyCode&&this.root.emit("pageChange",{direction:-1,amount:1})}.bind(this))}var o=t("famous/core/FamousEngine"),a=(t("famous/dom-renderables/DOMElement"),t("./Arrow.js")),h=t("./Pager.js"),u=t("./Dots.js"),c=t("famous/components/Camera");e.exports=s},{"./Arrow.js":87,"./Dots.js":89,"./Pager.js":90,"famous/components/Camera":1,"famous/core/FamousEngine":7,"famous/dom-renderables/DOMElement":12}],89:[function(t,e,i){"use strict";function s(t,e){this.node=t,this.dots=[],this.dotWidth=e.dotWidth||10,this.spacing=e.spacing||5,this.numPages=e.numPages;for(var i=0;i<this.numPages;i++){var s=t.addChild();s.setSizeMode(1,1),s.setAbsoluteSize(this.dotWidth,this.dotWidth),this.dots.push(new r(s,i))}this.dots[0].select();var n={onSizeChange:function(t){this.layoutDots(t)}.bind(this)};this.node.addComponent(n)}function r(t,e){this.node=t,this.el=new n(t),this.el.setProperty("borderRadius","5px"),this.el.setProperty("border","2px solid white"),this.el.setProperty("boxSizing","border-box")}var n=t("famous/dom-renderables/DOMElement");s.prototype.layoutDots=function(t){t&&(this.size=t);for(var e=this.dotWidth*this.numPages+this.spacing*(this.numPages-1),i=(this.size[0]-e)/2,s=0;s<this.numPages;s++)this.dots[s].node.setPosition(i+(this.dotWidth+this.spacing)*s,0,0)},s.prototype.pageChange=function(t,e){this.dots[t].deselect(),this.dots[e].select()},r.prototype.select=function(){this.el.setProperty("backgroundColor","white")},r.prototype.deselect=function(){this.el.setProperty("backgroundColor","transparent")},e.exports=s},{"famous/dom-renderables/DOMElement":12}],90:[function(t,e,i){"use strict";function s(t,e){this.node=t,this.currentIndex=0,this.threshold=4e3,this.pageWidth=0;var i={onSizeChange:function(t){this.defineWidth(t)}.bind(this)};this.node.addComponent(i),this.simulation=new o,a.requestUpdate(this),this.threshold=4e3,this.force=new m,this.pages=r.call(this,t,e.pageData)}function r(t,e){for(var i=[],s=0;s<e.length;s++){var r=t.addChild();r.setSizeMode(1,1,1),r.setAbsoluteSize(this.pageWidth/4,this.pageWidth/4,0),r.setAlign(.5,.5,-1),r.setMountPoint(.5,.5),r.setOrigin(.5,.5);var o=new h(r);o.on("drag",function(t,e){this.force.set(e.centerDelta.x,0,0),this.force.scale(20),this.pages[t].box.applyForce(this.force),e.centerVelocity.x>this.threshold?this.draggedIndex===t&&this.currentIndex===t&&this.node.emit("pageChange",{direction:-1,amount:1}):e.centerVelocity.x<-this.threshold&&this.draggedIndex===t&&this.currentIndex===t&&this.node.emit("pageChange",{direction:1,amount:1}),"start"===e.status&&(this.draggedIndex=t)}.bind(this,s));var a=new n(r);a.setProperty("backgroundImage","url("+e[s]+")"),a.setProperty("background-repeat","no-repeat"),a.setProperty("background-size","cover");var u=new p({mass:100,size:[100,100,100]}),c=0===s?new m(0,0,0):new m(1,0,0),y=new l(null,u,{period:.6,dampingRatio:.5,anchor:c}),v=0===s?new f:(new f).fromEuler(0,-Math.PI/2,0),g=new d(null,u,{period:1,dampingRatio:.2,anchor:v});this.simulation.add(u,y,g),i.push({node:r,el:a,box:u,spring:y,quaternion:v,rotationalSpring:g,anchor:c})}return i}var n=t("famous/dom-renderables/DOMElement"),o=t("famous/physics/PhysicsEngine"),a=t("famous/core/FamousEngine"),h=t("famous/components/GestureHandler"),u=t("famous/physics"),c=t("famous/math"),p=u.Box,l=u.Spring,d=u.RotationalSpring,f=(u.RotationalDrag,c.Quaternion),m=c.Vec3;s.prototype.defineWidth=function(t){this.pageWidth=t[0],this.pages.forEach(function(t){t.node.setAbsoluteSize(this.pageWidth/4,this.pageWidth/4)}.bind(this))},s.prototype.onUpdate=function(t){this.simulation.update(t);for(var e,i,s,r,n=0,o=this.pages.length;o>n;n++)e=this.pages[n],i=this.simulation.getTransform(e.box),s=i.position,r=i.rotation,e.node.setPosition(s[0]*this.pageWidth,0,0),e.node.setRotation(r[0],r[1],r[2],r[3]);a.requestUpdateOnNextTick(this)},s.prototype.pageChange=function(t,e){e>t?(this.pages[t].anchor.set(-1,0,0),this.pages[t].quaternion.fromEuler(0,Math.PI/2,0),this.pages[e].anchor.set(0,0,0),this.pages[e].quaternion.set(1,0,0,0)):(this.pages[t].anchor.set(1,0,0),this.pages[t].quaternion.fromEuler(0,-Math.PI/2,0),this.pages[e].anchor.set(0,0,0),this.pages[e].quaternion.set(1,0,0,0)),this.currentIndex=e},e.exports=s},{"famous/components/GestureHandler":2,"famous/core/FamousEngine":7,"famous/dom-renderables/DOMElement":12,"famous/math":30,"famous/physics":60,"famous/physics/PhysicsEngine":34}],91:[function(t,e,i){e.exports=["http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._01_-_Autorretrato._Francisco_Goya_y_Lucientes2C_pintor_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._02_-_El_si_pronuncian_y_la_mano_alargan_al_primero_que_llega_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._03_-_Que_viene_el_Coco_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._04_-_El_de_la_rollona_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._05_-_Tal_para_qual_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._06_-_Nadie_se_conoce_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._07_-_Ni_asi_la_distingue_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._09_-_Tantalo_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._10_-_El_amor_y_la_muerte_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._11_-_Muchachos_al_avC3ADo_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._12_-_A_caza_de_dientes_thumb.jpg","http://demo.famo.us.s3.amazonaws.com/hub/apps/carousel/Museo_del_Prado_-_Goya_-_Caprichos_-_No._13_-_Estan_calientes_thumb.jpg"]},{}],92:[function(t,e,i){"use strict";var s=t("famous/core/FamousEngine");s.init();var r=t("./carousel/Carousel"),n=t("./data/data");new r("body",{pageData:n})},{"./carousel/Carousel":88,"./data/data":91,"famous/core/FamousEngine":7}]},{},[92]);
